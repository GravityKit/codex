<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>GravityView: upgrade.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom-doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GravityView
   &#160;<span id="projectnumber">1.16.1</span>
   </div>
   <div id="projectbrief">Beautifully display your Gravity Forms data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f202f45fd139109afdc6cee542e9540d.html">tmp</a></li><li class="navelem"><a class="el" href="dir_bab4839c1ebfd97cab4362c92e1efb01.html">wordpress</a></li><li class="navelem"><a class="el" href="dir_6befe1ce5953e76db4cf235d50144e4d.html">wp-admin</a></li><li class="navelem"><a class="el" href="dir_5f7e0c6af6da142503046b2ffe3240cd.html">includes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">includes/upgrade.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="includes_2upgrade_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<a class="code" href="namespacephp.html">php</a><span class="comment"></span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * WordPress Upgrade API</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Most of the functions are pluggable and can be overwritten.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * @package WordPress</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * @subpackage Administration</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/** Include user install customize script. */</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordflow">if</span> ( file_exists(<a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&#39;/install.php&#39;</span>) )</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    require (<a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&#39;/install.php&#39;</span>);</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/** WordPress Administration API */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;require_once(<a class="code" href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a> . <span class="stringliteral">&#39;wp-admin/includes/admin.php&#39;</span>);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/** WordPress Schema API */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;require_once(<a class="code" href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a> . <span class="stringliteral">&#39;wp-admin/includes/schema.php&#39;</span>);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">   21</a></span>&#160;<span class="keywordflow">if</span> ( !function_exists(<span class="stringliteral">&#39;wp_install&#39;</span>) ) :<span class="comment"></span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * Installs the site.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Runs the required functions to set up and populate the database,</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * including primary admin user and initial options.</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * @since 2.1.0</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * @param string $blog_title    Blog title.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * @param string $user_name     User&#39;s username.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * @param string $user_email    User&#39;s email.</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * @param bool   $public        Whether blog is public.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * @param string $deprecated    Optional. Not used.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * @param string $user_password Optional. User&#39;s chosen password. Default empty (random password).</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * @param string $language      Optional. Language chosen. Default empty.</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * @return array Array keys &#39;url&#39;, &#39;user_id&#39;, &#39;password&#39;, and &#39;password_message&#39;.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">function</span> wp_install( $blog_title, $user_name, $user_email, $public, <a class="code" href="other__entries_8php.html#a7ae192438b083bb6b6b8687dc86df3bb">$deprecated</a> = <span class="stringliteral">&#39;&#39;</span>, $user_password = <span class="stringliteral">&#39;&#39;</span>, <a class="code" href="wp-admin_2install_8php.html#a2ba769a382a3db95c4fc25db4b242429">$language</a> = <span class="stringliteral">&#39;&#39;</span> ) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordflow">if</span> ( !empty( <a class="code" href="other__entries_8php.html#a7ae192438b083bb6b6b8687dc86df3bb">$deprecated</a> ) )</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532">_deprecated_argument</a>( __FUNCTION__, <span class="stringliteral">&#39;2.6&#39;</span> );</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a2559abc904c6b5dacc954e4589d450a2">wp_check_mysql_version</a>();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="cache_8php.html#af4c681a8e4a0681345e7eec841780af6">wp_cache_flush</a>();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5">make_db_current_silent</a>();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545">populate_options</a>();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="schema_8php.html#ae0b4ae0516536093d825c83dbe0bf045">populate_roles</a>();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;blogname&#39;</span>, $blog_title);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;admin_email&#39;</span>, $user_email);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;blog_public&#39;</span>, $public);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="wp-admin_2install_8php.html#a2ba769a382a3db95c4fc25db4b242429">$language</a> ) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;WPLANG&#39;</span>, <a class="code" href="wp-admin_2install_8php.html#a2ba769a382a3db95c4fc25db4b242429">$language</a> );</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    $guessurl = <a class="code" href="noop_8php.html#a371846605f59defff0f8d8ef2bf0cc06">wp_guess_url</a>();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;siteurl&#39;</span>, $guessurl);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// If not a public blog, don&#39;t ping.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordflow">if</span> ( ! $public )</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;default_pingback_flag&#39;</span>, 0);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">     * Create default user. If the user already exists, the user tables are</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">     * being shared among blogs. Just set the role in that case.</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> = <a class="code" href="wp-includes_2user_8php.html#a94c479d8fff19b8a0462664346b64f66">username_exists</a>($user_name);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    $user_password = trim($user_password);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    $email_password = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> ( !<a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> &amp;&amp; empty($user_password) ) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        $user_password = wp_generate_password( 12, <span class="keyword">false</span> );</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a> = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;&lt;strong&gt;&lt;em&gt;Note that password&lt;/em&gt;&lt;/strong&gt; carefully! It is a &lt;em&gt;random&lt;/em&gt; password that was generated just for you.&#39;</span>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> = <a class="code" href="wp-includes_2user_8php.html#aa859bd62ab97dad7bd85ed1a968fd996">wp_create_user</a>($user_name, $user_password, $user_email);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="wp-includes_2user_8php.html#a51c82c9257936dea066761047d2dddba">update_user_option</a>(<a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>, <span class="stringliteral">&#39;default_password_nag&#39;</span>, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        $email_password = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( ! <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> ) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">// Password has been provided</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <a class="code" href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a> = <span class="stringliteral">&#39;&lt;em&gt;&#39;</span>.__(<span class="stringliteral">&#39;Your chosen password.&#39;</span>).<span class="stringliteral">&#39;&lt;/em&gt;&#39;</span>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> = <a class="code" href="wp-includes_2user_8php.html#aa859bd62ab97dad7bd85ed1a968fd996">wp_create_user</a>($user_name, $user_password, $user_email);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a> = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;User already exists. Password inherited.&#39;</span>);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = <span class="keyword">new</span> <a class="code" href="class_w_p___user.html">WP_User</a>(<a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>-&gt;set_role(<span class="stringliteral">&#39;administrator&#39;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    wp_install_defaults(<a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a13a6c748f12245d95d2139c388506b62">wp_install_maybe_enable_pretty_permalinks</a>();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="rewrite_8php.html#a0ee4a66b12c0b232789dc96925b5d263">flush_rewrite_rules</a>();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    wp_new_blog_notification($blog_title, $guessurl, <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>, ($email_password ? $user_password : <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;The password you chose during the install.&#39;</span>) ) );</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="cache_8php.html#af4c681a8e4a0681345e7eec841780af6">wp_cache_flush</a>();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">     * Fires after a site is fully installed.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">     * @since 3.9.0</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">     * @param WP_User $user The site owner.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc">do_action</a>( <span class="stringliteral">&#39;wp_install&#39;</span>, <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> );</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;url&#39;</span> =&gt; $guessurl, <span class="stringliteral">&#39;user_id&#39;</span> =&gt; <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>, <span class="stringliteral">&#39;password&#39;</span> =&gt; $user_password, <span class="stringliteral">&#39;password_message&#39;</span> =&gt; <a class="code" href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a>);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;}</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordflow">if</span> ( !function_exists(<span class="stringliteral">&#39;wp_install_defaults&#39;</span>) ) :<span class="comment"></span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> * Creates the initial content for a newly-installed site.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"> * Adds the default &quot;Uncategorized&quot; category, the first post (with comment),</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> * first page, and default widgets for default theme for the current version.</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> * @since 2.1.0</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> * @global wpdb       $wpdb</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"> * @global WP_Rewrite $wp_rewrite</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> * @global string     $table_prefix</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> * @param int $user_id User ID.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keyword">function</span> wp_install_defaults( <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> ) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, <a class="code" href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php.html#a85f604682d88dda16375d4dbd641df93">$wp_rewrite</a>, <a class="code" href="wp-config-sample_8php.html#a26794de5a8ff7fc61c2e05e0107e0135">$table_prefix</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// Default category</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    $cat_name = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Uncategorized&#39;</span>);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">/* translators: Default category slug */</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    $cat_slug = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="edit-form-advanced_8php.html#ada8efad85a9cd028503cbe55c37c890a">_x</a>(<span class="stringliteral">&#39;Uncategorized&#39;</span>, <span class="stringliteral">&#39;Default category slug&#39;</span>));</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="wordpress_2wp-includes_2functions_8php.html#aa755261d52d47bd5da5742b39afe166b">global_terms_enabled</a>() ) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        $cat_id = $wpdb-&gt;get_var( $wpdb-&gt;prepare( <span class="stringliteral">&quot;SELECT cat_ID FROM {$wpdb-&gt;sitecategories} WHERE category_nicename = %s&quot;</span>, $cat_slug ) );</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">if</span> ( $cat_id == <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a> ) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;sitecategories, array(<span class="stringliteral">&#39;cat_ID&#39;</span> =&gt; 0, <span class="stringliteral">&#39;cat_name&#39;</span> =&gt; $cat_name, <span class="stringliteral">&#39;category_nicename&#39;</span> =&gt; $cat_slug, <span class="stringliteral">&#39;last_updated&#39;</span> =&gt; <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a4dacfef72ebe1c7276f7d94fdbe93554">current_time</a>(<span class="stringliteral">&#39;mysql&#39;</span>, <span class="keyword">true</span>)) );</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            $cat_id = $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;default_category&#39;</span>, $cat_id);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        $cat_id = 1;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;terms, array(<span class="stringliteral">&#39;term_id&#39;</span> =&gt; $cat_id, <span class="stringliteral">&#39;name&#39;</span> =&gt; $cat_name, <span class="stringliteral">&#39;slug&#39;</span> =&gt; $cat_slug, <span class="stringliteral">&#39;term_group&#39;</span> =&gt; 0) );</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, array(<span class="stringliteral">&#39;term_id&#39;</span> =&gt; $cat_id, <span class="stringliteral">&#39;taxonomy&#39;</span> =&gt; <span class="stringliteral">&#39;category&#39;</span>, <span class="stringliteral">&#39;description&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span> =&gt; 0, <span class="stringliteral">&#39;count&#39;</span> =&gt; 1));</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    $cat_tt_id = $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// First post</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a> = <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a4dacfef72ebe1c7276f7d94fdbe93554">current_time</a>( <span class="stringliteral">&#39;mysql&#39;</span> );</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    $now_gmt = <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a4dacfef72ebe1c7276f7d94fdbe93554">current_time</a>( <span class="stringliteral">&#39;mysql&#39;</span>, 1 );</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    $first_post_guid = <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;home&#39;</span> ) . <span class="stringliteral">&#39;/?p=1&#39;</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        $first_post = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;first_post&#39;</span> );</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">if</span> ( ! $first_post ) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="comment">/* translators: %s: site link */</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            $first_post = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;Welcome to %s. This is your first post. Edit or delete it, then start blogging!&#39;</span> );</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        $first_post = sprintf( $first_post,</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            sprintf( <span class="stringliteral">&#39;&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;&#39;</span>, <a class="code" href="twentyfifteen_2content-link_8php.html#a4a6fb8865e1ae52faa29662b4087e629">esc_url</a>( <a class="code" href="link-template_8php.html#a3f2ddf18359777959ef1230ebdd5132c">network_home_url</a>() ), <a class="code" href="ms-functions_8php.html#a7a458e0f14af3efce48fb42d7ff4d6d9">get_current_site</a>()-&gt;site_name )</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        );</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">// Back-compat for pre-4.4</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        $first_post = <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>( <span class="stringliteral">&#39;SITE_URL&#39;</span>, <a class="code" href="twentyfifteen_2content-link_8php.html#a4a6fb8865e1ae52faa29662b4087e629">esc_url</a>( <a class="code" href="link-template_8php.html#a3f2ddf18359777959ef1230ebdd5132c">network_home_url</a>() ), $first_post );</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        $first_post = <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>( <span class="stringliteral">&#39;SITE_NAME&#39;</span>, <a class="code" href="ms-functions_8php.html#a7a458e0f14af3efce48fb42d7ff4d6d9">get_current_site</a>()-&gt;site_name, $first_post );</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        $first_post = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;Welcome to WordPress. This is your first post. Edit or delete it, then start writing!&#39;</span> );</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;posts, array(</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="stringliteral">&#39;post_author&#39;</span> =&gt; <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="stringliteral">&#39;post_date&#39;</span> =&gt; <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="stringliteral">&#39;post_date_gmt&#39;</span> =&gt; $now_gmt,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="stringliteral">&#39;post_content&#39;</span> =&gt; $first_post,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="stringliteral">&#39;post_excerpt&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="stringliteral">&#39;post_title&#39;</span> =&gt; <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Hello world!&#39;</span>),</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">/* translators: Default post slug */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="stringliteral">&#39;post_name&#39;</span> =&gt; <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>( <a class="code" href="edit-form-advanced_8php.html#ada8efad85a9cd028503cbe55c37c890a">_x</a>(<span class="stringliteral">&#39;hello-world&#39;</span>, <span class="stringliteral">&#39;Default post slug&#39;</span>) ),</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="stringliteral">&#39;post_modified&#39;</span> =&gt; <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a>,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="stringliteral">&#39;post_modified_gmt&#39;</span> =&gt; $now_gmt,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="stringliteral">&#39;guid&#39;</span> =&gt; $first_post_guid,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="stringliteral">&#39;comment_count&#39;</span> =&gt; 1,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="stringliteral">&#39;to_ping&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="stringliteral">&#39;pinged&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="stringliteral">&#39;post_content_filtered&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    ));</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $cat_tt_id, <span class="stringliteral">&#39;object_id&#39;</span> =&gt; 1) );</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// Default comment</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    $first_comment_author = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Mr WordPress&#39;</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    $first_comment_url = <span class="stringliteral">&#39;https://wordpress.org/&#39;</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    $first_comment = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Hi, this is a comment.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">To delete a comment, just log in and view the post&amp;#039;s comments. There you will have the option to edit or delete them.&#39;</span>);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        $first_comment_author = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;first_comment_author&#39;</span>, $first_comment_author );</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        $first_comment_url = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;first_comment_url&#39;</span>, <a class="code" href="link-template_8php.html#a3f2ddf18359777959ef1230ebdd5132c">network_home_url</a>() );</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        $first_comment = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;first_comment&#39;</span>, $first_comment );</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;comments, array(</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="stringliteral">&#39;comment_post_ID&#39;</span> =&gt; 1,</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="stringliteral">&#39;comment_author&#39;</span> =&gt; $first_comment_author,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="stringliteral">&#39;comment_author_email&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="stringliteral">&#39;comment_author_url&#39;</span> =&gt; $first_comment_url,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="stringliteral">&#39;comment_date&#39;</span> =&gt; <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a>,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="stringliteral">&#39;comment_date_gmt&#39;</span> =&gt; $now_gmt,</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="stringliteral">&#39;comment_content&#39;</span> =&gt; $first_comment</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    ));</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// First Page</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    $first_page = sprintf( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&quot;This is an example page. It&#39;s different from a blog post because it will stay in one place and will show up in your site navigation (in most themes). Most people start with an About page that introduces them to potential site visitors. It might say something like this:</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral">&lt;blockquote&gt;Hi there! I&#39;m a bike messenger by day, aspiring actor by night, and this is my website. I live in Los Angeles, have a great dog named Jack, and I like pi&amp;#241;a coladas. (And gettin&#39; caught in the rain.)&lt;/blockquote&gt;</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral">...or something like this:</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">&lt;blockquote&gt;The XYZ Doohickey Company was founded in 1971, and has been providing quality doohickeys to the public ever since. Located in Gotham City, XYZ employs over 2,000 people and does all kinds of awesome things for the Gotham community.&lt;/blockquote&gt;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">As a new WordPress user, you should go to &lt;a href=\&quot;%s\&quot;&gt;your dashboard&lt;/a&gt; to delete this page and create new pages for your content. Have fun!&quot;</span> ), <a class="code" href="noop_8php.html#a01815a0502df2442bbb063f4055c2194">admin_url</a>() );</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() )</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        $first_page = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;first_page&#39;</span>, $first_page );</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    $first_post_guid = <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>(<span class="stringliteral">&#39;home&#39;</span>) . <span class="stringliteral">&#39;/?page_id=2&#39;</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;posts, array(</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="stringliteral">&#39;post_author&#39;</span> =&gt; <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="stringliteral">&#39;post_date&#39;</span> =&gt; <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a>,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="stringliteral">&#39;post_date_gmt&#39;</span> =&gt; $now_gmt,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="stringliteral">&#39;post_content&#39;</span> =&gt; $first_page,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="stringliteral">&#39;post_excerpt&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="stringliteral">&#39;comment_status&#39;</span> =&gt; <span class="stringliteral">&#39;closed&#39;</span>,</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="stringliteral">&#39;post_title&#39;</span> =&gt; <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;Sample Page&#39;</span> ),</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="comment">/* translators: Default page slug */</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="stringliteral">&#39;post_name&#39;</span> =&gt; <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;sample-page&#39;</span> ),</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="stringliteral">&#39;post_modified&#39;</span> =&gt; <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a>,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="stringliteral">&#39;post_modified_gmt&#39;</span> =&gt; $now_gmt,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="stringliteral">&#39;guid&#39;</span> =&gt; $first_post_guid,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="stringliteral">&#39;post_type&#39;</span> =&gt; <span class="stringliteral">&#39;page&#39;</span>,</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="stringliteral">&#39;to_ping&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="stringliteral">&#39;pinged&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="stringliteral">&#39;post_content_filtered&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    ));</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    $wpdb-&gt;insert( $wpdb-&gt;postmeta, array( <span class="stringliteral">&#39;post_id&#39;</span> =&gt; 2, <span class="stringliteral">&#39;meta_key&#39;</span> =&gt; <span class="stringliteral">&#39;_wp_page_template&#39;</span>, <span class="stringliteral">&#39;meta_value&#39;</span> =&gt; <span class="stringliteral">&#39;default&#39;</span> ) );</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// Set up default widgets for default theme.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;widget_search&#39;</span>, array ( 2 =&gt; array ( <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span> ), <span class="stringliteral">&#39;_multiwidget&#39;</span> =&gt; 1 ) );</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;widget_recent-posts&#39;</span>, array ( 2 =&gt; array ( <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;number&#39;</span> =&gt; 5 ), <span class="stringliteral">&#39;_multiwidget&#39;</span> =&gt; 1 ) );</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;widget_recent-comments&#39;</span>, array ( 2 =&gt; array ( <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;number&#39;</span> =&gt; 5 ), <span class="stringliteral">&#39;_multiwidget&#39;</span> =&gt; 1 ) );</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;widget_archives&#39;</span>, array ( 2 =&gt; array ( <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;count&#39;</span> =&gt; 0, <span class="stringliteral">&#39;dropdown&#39;</span> =&gt; 0 ), <span class="stringliteral">&#39;_multiwidget&#39;</span> =&gt; 1 ) );</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;widget_categories&#39;</span>, array ( 2 =&gt; array ( <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;count&#39;</span> =&gt; 0, <span class="stringliteral">&#39;hierarchical&#39;</span> =&gt; 0, <span class="stringliteral">&#39;dropdown&#39;</span> =&gt; 0 ), <span class="stringliteral">&#39;_multiwidget&#39;</span> =&gt; 1 ) );</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;widget_meta&#39;</span>, array ( 2 =&gt; array ( <span class="stringliteral">&#39;title&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span> ), <span class="stringliteral">&#39;_multiwidget&#39;</span> =&gt; 1 ) );</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;sidebars_widgets&#39;</span>, array ( <span class="stringliteral">&#39;wp_inactive_widgets&#39;</span> =&gt; array (), <span class="stringliteral">&#39;sidebar-1&#39;</span> =&gt; array ( 0 =&gt; <span class="stringliteral">&#39;search-2&#39;</span>, 1 =&gt; <span class="stringliteral">&#39;recent-posts-2&#39;</span>, 2 =&gt; <span class="stringliteral">&#39;recent-comments-2&#39;</span>, 3 =&gt; <span class="stringliteral">&#39;archives-2&#39;</span>, 4 =&gt; <span class="stringliteral">&#39;categories-2&#39;</span>, 5 =&gt; <span class="stringliteral">&#39;meta-2&#39;</span>, ), <span class="stringliteral">&#39;array_version&#39;</span> =&gt; 3 ) );</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">if</span> ( ! <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() )</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>, <span class="stringliteral">&#39;show_welcome_panel&#39;</span>, 1 );</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( ! <a class="code" href="capabilities_8php.html#a99845439f6f1db111622e0b684512ba7">is_super_admin</a>( <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a> ) &amp;&amp; ! <a class="code" href="meta_8php.html#a1e6585c1d4aae863e98eed45cf290ae0">metadata_exists</a>( <span class="stringliteral">&#39;user&#39;</span>, <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>, <span class="stringliteral">&#39;show_welcome_panel&#39;</span> ) )</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( <a class="code" href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a>, &#39;show_welcome_panel&#39;, 2 );</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <a class="code" href="search-field-date_8php.html#ab0fb235c4acb6fcb8c0d565d101505a4">if</a> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">// Flush rules to pick up the new page.</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        $wp_rewrite-&gt;init();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        $wp_rewrite-&gt;flush_rules();</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = <span class="keyword">new</span> <a class="code" href="class_w_p___user.html">WP_User</a>($user_id);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        $wpdb-&gt;update( $wpdb-&gt;options, array(<span class="stringliteral">&#39;option_value&#39;</span> =&gt; <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>-&gt;user_email), array(<span class="stringliteral">&#39;option_name&#39;</span> =&gt; <span class="stringliteral">&#39;admin_email&#39;</span>) );</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="comment">// Remove all perms except for the login user.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE user_id != %d AND meta_key = %s&quot;</span>, $user_id, $table_prefix.<span class="stringliteral">&#39;user_level&#39;</span>) );</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE user_id != %d AND meta_key = %s&quot;</span>, $user_id, $table_prefix.<span class="stringliteral">&#39;capabilities&#39;</span>) );</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment">// Delete any caps that snuck into the previously active blog. (Hardcoded to blog 1 for now.) TODO: Get previous_blog_id.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="capabilities_8php.html#a99845439f6f1db111622e0b684512ba7">is_super_admin</a>( $user_id ) &amp;&amp; $user_id != 1 )</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            $wpdb-&gt;delete( $wpdb-&gt;usermeta, array( <span class="stringliteral">&#39;user_id&#39;</span> =&gt; $user_id , <span class="stringliteral">&#39;meta_key&#39;</span> =&gt; $wpdb-&gt;base_prefix.<span class="stringliteral">&#39;1_capabilities&#39;</span> ) );</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;}</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"> * Maybe enable pretty permalinks on install.</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"> * If after enabling pretty permalinks don&#39;t work, fallback to query-string permalinks.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"> * @since 4.2.0</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"> * @global WP_Rewrite $wp_rewrite WordPress rewrite component.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment"> * @return bool Whether pretty permalinks are enabled. False otherwise.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a13a6c748f12245d95d2139c388506b62">  290</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a13a6c748f12245d95d2139c388506b62">wp_install_maybe_enable_pretty_permalinks</a>() {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    global <a class="code" href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php.html#a85f604682d88dda16375d4dbd641df93">$wp_rewrite</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// Bail if a permalink structure is already enabled.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;permalink_structure&#39;</span> ) ) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">     * The Permalink structures to attempt.</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">     * The first is designed for mod_rewrite or nginx rewriting.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">     * The second is PATHINFO-based permalinks for web server configurations</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">     * without a true rewrite module enabled.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    $permalink_structures = array(</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="stringliteral">&#39;/%year%/%monthnum%/%day%/%postname%/&#39;</span>,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="stringliteral">&#39;/index.php/%year%/%monthnum%/%day%/%postname%/&#39;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    );</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">foreach</span> ( (array) $permalink_structures as <a class="code" href="options-permalink_8php.html#a1b46ea8949d396a93da5d6e63bdae52c">$permalink_structure</a> ) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        $wp_rewrite-&gt;set_permalink_structure( $permalink_structure );</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">         * Flush rules with the hard option to force refresh of the web-server&#39;s</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">         * rewrite config file (e.g. .htaccess or web.config).</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        $wp_rewrite-&gt;flush_rules( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="comment">// Test against a real WordPress Post, or if none were created, a random 404 page.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        $test_url = <a class="code" href="link-template_8php.html#ad47f4e06de824d65bd5b1b1e92057a0b">get_permalink</a>( 1 );</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> ( ! $test_url ) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            $test_url = <a class="code" href="noop_8php.html#a2d2cbc03d92d4736569cab661c417c22">home_url</a>( <span class="stringliteral">&#39;/wordpress-check-for-rewrites/&#39;</span> );</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">         * Send a request to the site, and check whether</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">         * the &#39;x-pingback&#39; header is returned as expected.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">         * Uses wp_remote_get() instead of wp_remote_head() because web servers</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">         * can block head requests.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        $response          = <a class="code" href="wordpress_2wp-includes_2http_8php.html#a620a87b24dd30feca1f786b6dbd24b24">wp_remote_get</a>( $test_url, array( <span class="stringliteral">&#39;timeout&#39;</span> =&gt; 5 ) );</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        $x_pingback_header = <a class="code" href="wordpress_2wp-includes_2http_8php.html#ae46c3829a8339ff06623dc1dcd0fc878">wp_remote_retrieve_header</a>( $response, <span class="stringliteral">&#39;x-pingback&#39;</span> );</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        $pretty_permalinks = $x_pingback_header &amp;&amp; $x_pingback_header === <a class="code" href="noop_8php.html#a472b5d168d122332c7e23553b87d7d5d">get_bloginfo</a>( <span class="stringliteral">&#39;pingback_url&#39;</span> );</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keywordflow">if</span> ( $pretty_permalinks ) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">     * If it makes it this far, pretty permalinks failed.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">     * Fallback to query-string permalinks.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    $wp_rewrite-&gt;set_permalink_structure( <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    $wp_rewrite-&gt;flush_rules( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordflow">if</span> ( !function_exists(<span class="stringliteral">&#39;wp_new_blog_notification&#39;</span>) ) :<span class="comment"></span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"> * Notifies the site admin that the setup is complete.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"> * Sends an email with wp_mail to the new administrator that the site setup is complete,</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"> * and provides them with a record of their login credentials.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"> * @since 2.1.0</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> * @param string $blog_title Blog title.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"> * @param string $blog_url   Blog url.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"> * @param int    $user_id    User ID.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"> * @param string $password   User&#39;s Password.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keyword">function</span> wp_new_blog_notification($blog_title, $blog_url, $user_id, $password) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> = <span class="keyword">new</span> <a class="code" href="class_w_p___user.html">WP_User</a>( $user_id );</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    $email = <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>-&gt;user_email;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>-&gt;user_login;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    $login_url = <a class="code" href="general-template_8php.html#ac3a568d96fe29ca2a8aefd1d016abd0b">wp_login_url</a>();</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a> = sprintf( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&quot;Your new WordPress site has been successfully set up at:</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">%1\$s</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">You can log in to the administrator account with the following information:</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">Username: %2\$s</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">Password: %3\$s</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">Log in here: %4\$s</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">We hope you enjoy your new site. Thanks!</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="stringliteral">--The WordPress Team</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="stringliteral">https://wordpress.org/</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="stringliteral">&quot;</span>), $blog_url, <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>, $password, $login_url );</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    @wp_mail($email, <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;New WordPress Site&#39;</span>), <a class="code" href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a>);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;}</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordflow">if</span> ( !function_exists(<span class="stringliteral">&#39;wp_upgrade&#39;</span>) ) :<span class="comment"></span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"> * Runs WordPress Upgrade functions.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"> * Upgrades the database if needed during a site update.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment"> * @since 2.1.0</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"> * @global int  $wp_db_version</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keyword">function</span> wp_upgrade() {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    global $wp_current_db_version, <a class="code" href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a>, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    $wp_current_db_version = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;db_version&#39;</span>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// We are up-to-date. Nothing to do.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> ( $wp_db_version == $wp_current_db_version )</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">if</span> ( ! <a class="code" href="wordpress_2wp-includes_2functions_8php.html#aaabb0089dc684c60f65958a5cd928908">is_blog_installed</a>() )</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a2559abc904c6b5dacc954e4589d450a2">wp_check_mysql_version</a>();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="cache_8php.html#af4c681a8e4a0681345e7eec841780af6">wp_cache_flush</a>();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a4123a7eed5c3db1e2e471e636e7f4019">pre_schema_upgrade</a>();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5">make_db_current_silent</a>();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75">upgrade_all</a>();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <a class="code" href="wordpress_2wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() )</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ab30e0db0ffe1bede090b8e6b8f116db9">upgrade_network</a>();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="cache_8php.html#af4c681a8e4a0681345e7eec841780af6">wp_cache_flush</a>();</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="keywordflow">if</span> ( $wpdb-&gt;get_row( <span class="stringliteral">&quot;SELECT blog_id FROM {$wpdb-&gt;blog_versions} WHERE blog_id = &#39;{$wpdb-&gt;blogid}&#39;&quot;</span> ) )</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;UPDATE {$wpdb-&gt;blog_versions} SET db_version = &#39;{$wp_db_version}&#39; WHERE blog_id = &#39;{$wpdb-&gt;blogid}&#39;&quot;</span> );</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;INSERT INTO {$wpdb-&gt;blog_versions} ( `blog_id` , `db_version` , `last_updated` ) VALUES ( &#39;{$wpdb-&gt;blogid}&#39;, &#39;{$wp_db_version}&#39;, NOW());&quot;</span> );</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">     * Fires after a site is fully upgraded.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">     * @since 3.9.0</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">     * @param int $wp_db_version         The new $wp_db_version.</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">     * @param int $wp_current_db_version The old (current) $wp_db_version.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc">do_action</a>( <span class="stringliteral">&#39;wp_upgrade&#39;</span>, $wp_db_version, $wp_current_db_version );</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment"> * Functions to be called in install and upgrade scripts.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment"> * Contains conditional checks to determine which upgrade scripts to run,</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment"> * based on database version and WP version being updated-to.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> * @since 1.0.1</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment"> * @global int $wp_db_version</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75">  456</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75">upgrade_all</a>() {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    global $wp_current_db_version, <a class="code" href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a>;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    $wp_current_db_version = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;db_version&#39;</span>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// We are up-to-date. Nothing to do.</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">if</span> ( $wp_db_version == $wp_current_db_version )</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// If the version is not set in the DB, try to guess the version.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">if</span> ( empty($wp_current_db_version) ) {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        $wp_current_db_version = 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="comment">// If the template option exists, we have 1.5.</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a> = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;template&#39;</span>);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">if</span> ( !empty(<a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>) )</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            $wp_current_db_version = 2541;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 6039 )</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b">upgrade_230_options_table</a>();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545">populate_options</a>();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 2541 ) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">upgrade_100</a>();</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">upgrade_101</a>();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">upgrade_110</a>();</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">upgrade_130</a>();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3308 )</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">upgrade_160</a>();</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 4772 )</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">upgrade_210</a>();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 4351 )</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7">upgrade_old_slugs</a>();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 5539 )</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">upgrade_230</a>();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 6124 )</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5">upgrade_230_old_tables</a>();</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 7499 )</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31">upgrade_250</a>();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 7935 )</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6">upgrade_252</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8201 )</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b">upgrade_260</a>();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8989 )</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3">upgrade_270</a>();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 10360 )</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9">upgrade_280</a>();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11958 )</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3">upgrade_290</a>();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 15260 )</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04">upgrade_300</a>();</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19389 )</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e">upgrade_330</a>();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20080 )</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e">upgrade_340</a>();</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 22422 )</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b">upgrade_350</a>();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 25824 )</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a149a4a6a39985eeb606346e7569b1a4e">upgrade_370</a>();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 26148 )</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a547d60672205f0f6b4f4523837959ad5">upgrade_372</a>();</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 26691 )</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#af35f0dd4765f8bcd73a00866b270d6c5">upgrade_380</a>();</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 29630 )</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aadfa550ecd8c271a4106e8572267a667">upgrade_400</a>();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 33055 )</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#abfca0b6119ad903eaef624ef833f4272">upgrade_430</a>();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 33056 )</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a4196a0788a22c00429b67df81d3db465">upgrade_431</a>();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 35700 )</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ac825208abc4b5cca86e38718afadebe1">upgrade_440</a>();</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 36180 )</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#ad54b23bafca162f7b1d8ee3536826a1e">upgrade_450</a>();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7">maybe_disable_link_manager</a>();</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3">maybe_disable_automattic_widgets</a>();</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;db_version&#39;</span>, $wp_db_version );</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;db_upgraded&#39;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;}</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment"> * Execute changes made in WordPress 1.0.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment"> * @since 1.0.0</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00571"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">  571</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">upgrade_100</a>() {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// Get the title and ID of every post, post_name to check if it already has a value</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_title, post_name FROM $wpdb-&gt;posts WHERE post_name = &#39;&#39;&quot;</span>);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> ($posts) {</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">foreach</span> ($posts as <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $post-&gt;post_name) {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                $newtitle = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($post-&gt;post_title);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_name = %s WHERE ID = %d&quot;</span>, $newtitle, $post-&gt;ID) );</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    $categories = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT cat_ID, cat_name, category_nicename FROM $wpdb-&gt;categories&quot;</span>);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">foreach</span> ($categories as $category) {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $category-&gt;category_nicename) {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            $newtitle = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($category-&gt;cat_name);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;categories, array(<span class="stringliteral">&#39;category_nicename&#39;</span> =&gt; $newtitle), array(<span class="stringliteral">&#39;cat_ID&#39;</span> =&gt; $category-&gt;cat_ID) );</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    $sql = <span class="stringliteral">&quot;UPDATE $wpdb-&gt;options</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="stringliteral">        SET option_value = REPLACE(option_value, &#39;wp-links/links-images/&#39;, &#39;wp-images/links/&#39;)</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="stringliteral">        WHERE option_name LIKE %s</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="stringliteral">        AND option_value LIKE %s&quot;</span>;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    $wpdb-&gt;query( $wpdb-&gt;prepare( $sql, $wpdb-&gt;esc_like( <span class="stringliteral">&#39;links_rating_image&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span>, $wpdb-&gt;esc_like( <span class="stringliteral">&#39;wp-links/links-images/&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span> ) );</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    $done_ids = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT DISTINCT post_id FROM $wpdb-&gt;post2cat&quot;</span>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> ($done_ids) :</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        $done_posts = array();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">foreach</span> ($done_ids as $done_id) :</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            $done_posts[] = $done_id-&gt;post_id;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <a class="code" href="search-field-multiselect_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        $catwhere = <span class="stringliteral">&#39; AND ID NOT IN (&#39;</span> . implode(<span class="charliteral">&#39;,&#39;</span>, $done_posts) . <span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        $catwhere = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    $allposts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_category FROM $wpdb-&gt;posts WHERE post_category != &#39;0&#39; $catwhere&quot;</span>);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> ($allposts) :</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">foreach</span> ($allposts as <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="comment">// Check to see if it&#39;s already been imported</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            $cat = $wpdb-&gt;get_row( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT * FROM $wpdb-&gt;post2cat WHERE post_id = %d AND category_id = %d&quot;</span>, $post-&gt;ID, $post-&gt;post_category) );</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordflow">if</span> (!$cat &amp;&amp; 0 != $post-&gt;post_category) { <span class="comment">// If there&#39;s no result</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                $wpdb-&gt;insert( $wpdb-&gt;post2cat, array(<span class="stringliteral">&#39;post_id&#39;</span> =&gt; $post-&gt;ID, <span class="stringliteral">&#39;category_id&#39;</span> =&gt; $post-&gt;post_category) );</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;}</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * Execute changes made in WordPress 1.0.1.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> * @since 1.0.1</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00630"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">  630</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">upgrade_101</a>() {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">// Clean up indices, add a few</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;posts, <span class="stringliteral">&#39;post_name&#39;</span>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;posts, <span class="stringliteral">&#39;post_status&#39;</span>);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;categories, <span class="stringliteral">&#39;category_nicename&#39;</span>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;comments, <span class="stringliteral">&#39;comment_approved&#39;</span>);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;comments, <span class="stringliteral">&#39;comment_post_ID&#39;</span>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;links , <span class="stringliteral">&#39;link_category&#39;</span>);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($wpdb-&gt;links , <span class="stringliteral">&#39;link_visible&#39;</span>);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;}</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"> * Execute changes made in WordPress 1.2.</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment"> * @since 1.2.0</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">  651</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">upgrade_110</a>() {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// Set user_nicename.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    $users = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, user_nickname, user_nicename FROM $wpdb-&gt;users&quot;</span>);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">foreach</span> ($users as <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a>) {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> (<span class="stringliteral">&#39;&#39;</span> == $user-&gt;user_nicename) {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            $newname = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($user-&gt;user_nickname);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;users, array(<span class="stringliteral">&#39;user_nicename&#39;</span> =&gt; $newname), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $user-&gt;ID) );</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    $users = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, user_pass from $wpdb-&gt;users&quot;</span>);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">foreach</span> ($users as $row) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/^[A-Fa-f0-9]{32}$/&#39;</span>, $row-&gt;user_pass)) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;users, array(<span class="stringliteral">&#39;user_pass&#39;</span> =&gt; md5($row-&gt;user_pass)), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $row-&gt;ID) );</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="comment">// Get the GMT offset, we&#39;ll use that later on</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    $all_options = <a class="code" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483">get_alloptions_110</a>();</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    $time_difference = $all_options-&gt;time_difference;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        $server_time = time()+<a class="code" href="options-permalink_8php.html#a642d4aa9cec81e63ddf673048f68132d">date</a>(<span class="charliteral">&#39;Z&#39;</span>);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    $weblogger_time = $server_time + $time_difference * HOUR_IN_SECONDS;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <a class="code" href="wp-cron_8php.html#af9569cf1bd677c4e8b7cd58bac204a84">$gmt_time</a> = time();</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    $diff_gmt_server = (<a class="code" href="wp-cron_8php.html#af9569cf1bd677c4e8b7cd58bac204a84">$gmt_time</a> - $server_time) / HOUR_IN_SECONDS;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    $diff_weblogger_server = ($weblogger_time - $server_time) / HOUR_IN_SECONDS;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    $diff_gmt_weblogger = $diff_gmt_server - $diff_weblogger_server;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    $gmt_offset = -$diff_gmt_weblogger;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="comment">// Add a gmt_offset option, with value $gmt_offset</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a>(<span class="stringliteral">&#39;gmt_offset&#39;</span>, $gmt_offset);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="comment">// Check if we already set the GMT fields (if we did, then</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">// MAX(post_date_gmt) can&#39;t be &#39;0000-00-00 00:00:00&#39;</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// &lt;michel_v&gt; I just slapped myself silly for not thinking about it earlier</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    $got_gmt_fields = ! ($wpdb-&gt;get_var(<span class="stringliteral">&quot;SELECT MAX(post_date_gmt) FROM $wpdb-&gt;posts&quot;</span>) == <span class="stringliteral">&#39;0000-00-00 00:00:00&#39;</span>);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> (!$got_gmt_fields) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="comment">// Add or subtract time to all dates, to get GMT dates</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        $add_hours = intval($diff_gmt_weblogger);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        $add_minutes = intval(60 * ($diff_gmt_weblogger - $add_hours));</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_date_gmt = DATE_ADD(post_date, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE)&quot;</span>);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_modified = post_date&quot;</span>);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_modified_gmt = DATE_ADD(post_modified, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE) WHERE post_modified != &#39;0000-00-00 00:00:00&#39;&quot;</span>);</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;comments SET comment_date_gmt = DATE_ADD(comment_date, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE)&quot;</span>);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;users SET user_registered = DATE_ADD(user_registered, INTERVAL &#39;$add_hours:$add_minutes&#39; HOUR_MINUTE)&quot;</span>);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;}</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment"> * Execute changes made in WordPress 1.5.</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00714"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">  714</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">upgrade_130</a>() {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">// Remove extraneous backslashes.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_title, post_content, post_excerpt, guid, post_date, post_name, post_status, post_author FROM $wpdb-&gt;posts&quot;</span>);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">if</span> ($posts) {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">foreach</span> ($posts as <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>) {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            $post_content = addslashes(<a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($post-&gt;post_content));</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <a class="code" href="wp-content_2themes_2twentythirteen_2image_8php.html#a0415589279e7ed8917f2705200abea29">$post_title</a> = addslashes(<a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($post-&gt;post_title));</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            $post_excerpt = addslashes(<a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($post-&gt;post_excerpt));</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">if</span> ( empty($post-&gt;guid) )</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                $guid = <a class="code" href="link-template_8php.html#ad47f4e06de824d65bd5b1b1e92057a0b">get_permalink</a>($post-&gt;ID);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                $guid = $post-&gt;guid;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;posts, compact(<span class="stringliteral">&#39;post_title&#39;</span>, <span class="stringliteral">&#39;post_content&#39;</span>, <span class="stringliteral">&#39;post_excerpt&#39;</span>, <span class="stringliteral">&#39;guid&#39;</span>), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $post-&gt;ID) );</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// Remove extraneous backslashes.</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    $comments = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT comment_ID, comment_author, comment_content FROM $wpdb-&gt;comments&quot;</span>);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">if</span> ($comments) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">foreach</span> ($comments as <a class="code" href="wp-comments-post_8php.html#a536677acc0163c53c067316a97456e6c">$comment</a>) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            $comment_content = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($comment-&gt;comment_content);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            $comment_author = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($comment-&gt;comment_author);</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            $wpdb-&gt;update($wpdb-&gt;comments, compact(<span class="stringliteral">&#39;comment_content&#39;</span>, <span class="stringliteral">&#39;comment_author&#39;</span>), array(<span class="stringliteral">&#39;comment_ID&#39;</span> =&gt; $comment-&gt;comment_ID) );</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="comment">// Remove extraneous backslashes.</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    $links = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT link_id, link_name, link_description FROM $wpdb-&gt;links&quot;</span>);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span> ($links) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">foreach</span> ($links as <a class="code" href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a>) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            $link_name = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($link-&gt;link_name);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            $link_description = <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>($link-&gt;link_description);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;links, compact(<span class="stringliteral">&#39;link_name&#39;</span>, <span class="stringliteral">&#39;link_description&#39;</span>), array(<span class="stringliteral">&#39;link_id&#39;</span> =&gt; $link-&gt;link_id) );</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    $active_plugins = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;active_plugins&#39;</span>);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">     * If plugins are not stored in an array, they&#39;re stored in the old</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">     * newline separated format. Convert to new format.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">if</span> ( !is_array( $active_plugins ) ) {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        $active_plugins = explode(<span class="stringliteral">&quot;\n&quot;</span>, trim($active_plugins));</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;active_plugins&#39;</span>, $active_plugins);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="comment">// Obsolete tables</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optionvalues&#39;</span>);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optiontypes&#39;</span>);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optiongroups&#39;</span>);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;optiongroup_options&#39;</span>);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">// Update comments table to use comment_type</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;comments SET comment_type=&#39;trackback&#39;, comment_content = REPLACE(comment_content, &#39;&lt;trackback /&gt;&#39;, &#39;&#39;) WHERE comment_content LIKE &#39;&lt;trackback /&gt;%&#39;&quot;</span>);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;comments SET comment_type=&#39;pingback&#39;, comment_content = REPLACE(comment_content, &#39;&lt;pingback /&gt;&#39;, &#39;&#39;) WHERE comment_content LIKE &#39;&lt;pingback /&gt;%&#39;&quot;</span>);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// Some versions have multiple duplicate option_name rows with the same values</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <a class="code" href="wp-content_2themes_2twentyeleven_2sidebar_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT option_name, COUNT(option_name) AS dupes FROM `$wpdb-&gt;options` GROUP BY option_name&quot;</span>);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">foreach</span> ( <a class="code" href="wp-content_2themes_2twentyeleven_2sidebar_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> as <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> ) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="keywordflow">if</span> ( 1 != $option-&gt;dupes ) { <span class="comment">// Could this be done in the query?</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            $limit = $option-&gt;dupes - 1;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            $dupe_ids = $wpdb-&gt;get_col( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT option_id FROM $wpdb-&gt;options WHERE option_name = %s LIMIT %d&quot;</span>, $option-&gt;option_name, $limit) );</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">if</span> ( $dupe_ids ) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                $dupe_ids = join($dupe_ids, <span class="charliteral">&#39;,&#39;</span>);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                $wpdb-&gt;query(<span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;options WHERE option_id IN ($dupe_ids)&quot;</span>);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef">make_site_theme</a>();</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;}</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.0.</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> * @since 2.0.0</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00802"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">  802</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">upgrade_160</a>() {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $wp_current_db_version;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <a class="code" href="schema_8php.html#a27dc108eca74bf18d869661ef858f798">populate_roles_160</a>();</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    $users = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT * FROM $wpdb-&gt;users&quot;</span>);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">foreach</span> ( $users as <a class="code" href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a> ) :</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_firstname ) )</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;first_name&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_firstname) );</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_lastname ) )</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;last_name&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_lastname) );</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_nickname ) )</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;nickname&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_nickname) );</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_level ) )</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;user_level&#39;</span>, $user-&gt;user_level );</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_icq ) )</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;icq&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_icq) );</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_aim ) )</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;aim&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_aim) );</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_msn ) )</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;msn&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_msn) );</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_yim ) )</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;yim&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_icq) );</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">if</span> ( !empty( $user-&gt;user_description ) )</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, <span class="stringliteral">&#39;description&#39;</span>, <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($user-&gt;user_description) );</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keywordflow">if</span> ( isset( $user-&gt;user_idmode ) ):</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            $idmode = $user-&gt;user_idmode;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;nickname&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_nickname;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;login&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_login;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;firstname&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_firstname;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;lastname&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_lastname;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;namefl&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_firstname.<span class="charliteral">&#39; &#39;</span>.$user-&gt;user_lastname;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="keywordflow">if</span> ($idmode == <span class="stringliteral">&#39;namelf&#39;</span>) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_lastname.<span class="charliteral">&#39; &#39;</span>.$user-&gt;user_firstname;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keywordflow">if</span> (!$idmode) <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $user-&gt;user_nickname;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;users, array(<span class="stringliteral">&#39;display_name&#39;</span> =&gt; <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $user-&gt;ID) );</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">// FIXME: RESET_CAPS is temporary code to reset roles and caps if flag is set.</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        $caps = <a class="code" href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a">get_user_meta</a>( $user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;capabilities&#39;</span>);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordflow">if</span> ( empty($caps) || defined(<span class="stringliteral">&#39;RESET_CAPS&#39;</span>) ) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            $level = <a class="code" href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a">get_user_meta</a>($user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;user_level&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            $role = <a class="code" href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3">translate_level_to_role</a>($level);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <a class="code" href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a>( $user-&gt;ID, $wpdb-&gt;prefix . <span class="stringliteral">&#39;capabilities&#39;</span>, array($role =&gt; <span class="keyword">true</span>) );</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <a class="code" href="search-field-multiselect_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    $old_user_fields = array( <span class="stringliteral">&#39;user_firstname&#39;</span>, <span class="stringliteral">&#39;user_lastname&#39;</span>, <span class="stringliteral">&#39;user_icq&#39;</span>, <span class="stringliteral">&#39;user_aim&#39;</span>, <span class="stringliteral">&#39;user_msn&#39;</span>, <span class="stringliteral">&#39;user_yim&#39;</span>, <span class="stringliteral">&#39;user_idmode&#39;</span>, <span class="stringliteral">&#39;user_ip&#39;</span>, <span class="stringliteral">&#39;user_domain&#39;</span>, <span class="stringliteral">&#39;user_browser&#39;</span>, <span class="stringliteral">&#39;user_description&#39;</span>, <span class="stringliteral">&#39;user_nickname&#39;</span>, <span class="stringliteral">&#39;user_level&#39;</span> );</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">foreach</span> ( $old_user_fields as $old )</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;users DROP $old&quot;</span>);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// Populate comment_count field of posts table.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    $comments = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT comment_post_ID, COUNT(*) as c FROM $wpdb-&gt;comments WHERE comment_approved = &#39;1&#39; GROUP BY comment_post_ID&quot;</span> );</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordflow">if</span> ( is_array( $comments ) )</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keywordflow">foreach</span> ($comments as <a class="code" href="wp-comments-post_8php.html#a536677acc0163c53c067316a97456e6c">$comment</a>)</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;posts, array(<span class="stringliteral">&#39;comment_count&#39;</span> =&gt; $comment-&gt;c), array(<span class="stringliteral">&#39;ID&#39;</span> =&gt; $comment-&gt;comment_post_ID) );</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">     * Some alpha versions used a post status of object instead of attachment</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">     * and put the mime type in post_type instead of post_mime_type.</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &gt; 2541 &amp;&amp; $wp_current_db_version &lt;= 3091 ) {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        $objects = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_type FROM $wpdb-&gt;posts WHERE post_status = &#39;object&#39;&quot;</span>);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">foreach</span> ($objects as $object) {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            $wpdb-&gt;update( $wpdb-&gt;posts, array( <span class="stringliteral">&#39;post_status&#39;</span> =&gt; <span class="stringliteral">&#39;attachment&#39;</span>,</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                                <span class="stringliteral">&#39;post_mime_type&#39;</span> =&gt; $object-&gt;post_type,</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                                <span class="stringliteral">&#39;post_type&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>),</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                         array( <span class="stringliteral">&#39;ID&#39;</span> =&gt; $object-&gt;ID ) );</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            $meta = <a class="code" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a>($object-&gt;ID, <span class="stringliteral">&#39;imagedata&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            <span class="keywordflow">if</span> ( ! empty($meta[<span class="stringliteral">&#39;file&#39;</span>]) )</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                <a class="code" href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a>( $object-&gt;ID, $meta[<span class="stringliteral">&#39;file&#39;</span>] );</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.1.</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment"> * @since 2.1.0</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00889"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">  889</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">upgrade_210</a>() {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $wp_current_db_version;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3506 ) {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="comment">// Update status and type.</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_status FROM $wpdb-&gt;posts&quot;</span>);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">if</span> ( ! empty($posts) ) <span class="keywordflow">foreach</span> ($posts as <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>) {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            $status = $post-&gt;post_status;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            $type = <span class="stringliteral">&#39;post&#39;</span>;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;static&#39;</span> == $status ) {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                $status = <span class="stringliteral">&#39;publish&#39;</span>;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                $type = <span class="stringliteral">&#39;page&#39;</span>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( <span class="stringliteral">&#39;attachment&#39;</span> == $status ) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                $status = <span class="stringliteral">&#39;inherit&#39;</span>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                $type = <span class="stringliteral">&#39;attachment&#39;</span>;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_status = %s, post_type = %s WHERE ID = %d&quot;</span>, $status, $type, $post-&gt;ID) );</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        }</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3845 ) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <a class="code" href="schema_8php.html#ad2ea188fe277219078755911b899cf78">populate_roles_210</a>();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3531 ) {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="comment">// Give future posts a post_status of future.</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <a class="code" href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a> = gmdate(<span class="stringliteral">&#39;Y-m-d H:i:59&#39;</span>);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        $wpdb-&gt;query (<span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_status = &#39;future&#39; WHERE post_status = &#39;publish&#39; AND post_date_gmt &gt; &#39;$now&#39;&quot;</span>);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT ID, post_date FROM $wpdb-&gt;posts WHERE post_status =&#39;future&#39;&quot;</span>);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">if</span> ( !empty($posts) )</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <span class="keywordflow">foreach</span> ( $posts as <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a> )</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                <a class="code" href="cron_8php.html#aa1513c794ed209ff01c44928a64f6752">wp_schedule_single_event</a>(<a class="code" href="wordpress_2wp-includes_2functions_8php.html#af7ccbb4fe49b4877219cbdbddecd7f77">mysql2date</a>(<span class="charliteral">&#39;U&#39;</span>, $post-&gt;post_date, <span class="keyword">false</span>), <span class="stringliteral">&#39;publish_future_post&#39;</span>, array($post-&gt;ID));</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.3.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"> * @since 2.3.0</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">  937</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">upgrade_230</a>() {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 5200 ) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <a class="code" href="schema_8php.html#aecf1b5847c533f7633e26d20e9c37d71">populate_roles_230</a>();</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">// Convert categories to terms.</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    $tt_ids = array();</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    $have_tags = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    $categories = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT * FROM $wpdb-&gt;categories ORDER BY cat_ID&quot;</span>);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">foreach</span> ($categories as $category) {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        $term_id = (int) $category-&gt;cat_ID;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = $category-&gt;cat_name;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <a class="code" href="post__image_8php.html#a166882b9613466de882dd8727762f2db">$description</a> = $category-&gt;category_description;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        $slug = $category-&gt;category_nicename;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        $parent = $category-&gt;category_parent;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        $term_group = 0;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment">// Associate terms with the same slug in a term group and make slugs unique.</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <a class="code" href="search-field-date_8php.html#ab0fb235c4acb6fcb8c0d565d101505a4">if</a> ( $exists = $wpdb-&gt;get_results( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT term_id, term_group FROM $wpdb-&gt;terms WHERE slug = %s&quot;</span>, $slug) ) ) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            $term_group = $exists[0]-&gt;term_group;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = $exists[0]-&gt;term_id;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            $num = 2;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                $alt_slug = $slug . <span class="stringliteral">&quot;-$num&quot;</span>;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                $num++;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                $slug_check = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT slug FROM $wpdb-&gt;terms WHERE slug = %s&quot;</span>, $alt_slug) );</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            } <span class="keywordflow">while</span> ( $slug_check );</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            $slug = $alt_slug;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">if</span> ( empty( $term_group ) ) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                $term_group = $wpdb-&gt;get_var(<span class="stringliteral">&quot;SELECT MAX(term_group) FROM $wpdb-&gt;terms GROUP BY term_group&quot;</span>) + 1;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;terms SET term_group = %d WHERE term_id = %d&quot;</span>, $term_group, <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>) );</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            }</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;INSERT INTO $wpdb-&gt;terms (term_id, name, slug, term_group) VALUES</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="stringliteral">        (%d, %s, %s, %d)&quot;</span>, $term_id, <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>, $slug, $term_group) );</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = 0;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">if</span> ( !empty($category-&gt;category_count) ) {</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = (int) $category-&gt;category_count;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            $taxonomy = <span class="stringliteral">&#39;category&#39;</span>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;INSERT INTO $wpdb-&gt;term_taxonomy (term_id, taxonomy, description, parent, count) VALUES ( %d, %s, %s, %d, %d)&quot;</span>, $term_id, $taxonomy, <a class="code" href="post__image_8php.html#a166882b9613466de882dd8727762f2db">$description</a>, $parent, <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a>) );</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">if</span> ( !empty($category-&gt;link_count) ) {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = (int) $category-&gt;link_count;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            $taxonomy = <span class="stringliteral">&#39;link_category&#39;</span>;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            $wpdb-&gt;query( $wpdb-&gt;prepare(<span class="stringliteral">&quot;INSERT INTO $wpdb-&gt;term_taxonomy (term_id, taxonomy, description, parent, count) VALUES ( %d, %s, %s, %d, %d)&quot;</span>, $term_id, $taxonomy, <a class="code" href="post__image_8php.html#a166882b9613466de882dd8727762f2db">$description</a>, $parent, <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a>) );</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">if</span> ( !empty($category-&gt;tag_count) ) {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            $have_tags = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = (int) $category-&gt;tag_count;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            $taxonomy = <span class="stringliteral">&#39;post_tag&#39;</span>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, compact(<span class="stringliteral">&#39;term_id&#39;</span>, <span class="stringliteral">&#39;taxonomy&#39;</span>, <span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span>, <span class="stringliteral">&#39;count&#39;</span>) );</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordflow">if</span> ( empty(<a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a>) ) {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = 0;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            $taxonomy = <span class="stringliteral">&#39;category&#39;</span>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, compact(<span class="stringliteral">&#39;term_id&#39;</span>, <span class="stringliteral">&#39;taxonomy&#39;</span>, <span class="stringliteral">&#39;description&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span>, <span class="stringliteral">&#39;count&#39;</span>) );</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            $tt_ids[$term_id][$taxonomy] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    $select = <span class="stringliteral">&#39;post_id, category_id&#39;</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">if</span> ( $have_tags )</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        $select .= <span class="stringliteral">&#39;, rel_type&#39;</span>;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    $posts = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT $select FROM $wpdb-&gt;post2cat GROUP BY post_id, category_id&quot;</span>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">foreach</span> ( $posts as <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a> ) {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> = (int) $post-&gt;post_id;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        $term_id = (<span class="keywordtype">int</span>) $post-&gt;category_id;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        $taxonomy = <span class="stringliteral">&#39;category&#39;</span>;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">if</span> ( !empty($post-&gt;rel_type) &amp;&amp; <span class="stringliteral">&#39;tag&#39;</span> == $post-&gt;rel_type)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            $taxonomy = <span class="stringliteral">&#39;tag&#39;</span>;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        $tt_id = $tt_ids[$term_id][$taxonomy];</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordflow">if</span> ( empty($tt_id) )</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;object_id&#39;</span> =&gt; <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $tt_id) );</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="comment">// &lt; 3570 we used linkcategories. &gt;= 3570 we used categories and link2cat.</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 3570 ) {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">         * Create link_category terms for link categories. Create a map of link</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">         * cat IDs to link_category terms.</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        $link_cat_id_map = array();</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        $default_link_cat = 0;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        $tt_ids = array();</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        $link_cats = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT cat_id, cat_name FROM &quot;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;linkcategories&#39;</span>);</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="keywordflow">foreach</span> ( $link_cats as $category) {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            $cat_id = (int) $category-&gt;cat_id;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            $term_id = 0;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> = <a class="code" href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a>($category-&gt;cat_name);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            $slug = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            $term_group = 0;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="comment">// Associate terms with the same slug in a term group and make slugs unique.</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <span class="keywordflow">if</span> ( $exists = $wpdb-&gt;get_results( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT term_id, term_group FROM $wpdb-&gt;terms WHERE slug = %s&quot;</span>, $slug) ) ) {</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                $term_group = $exists[0]-&gt;term_group;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                $term_id = $exists[0]-&gt;term_id;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            }</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;            <span class="keywordflow">if</span> ( empty($term_id) ) {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                $wpdb-&gt;insert( $wpdb-&gt;terms, compact(<span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;slug&#39;</span>, <span class="stringliteral">&#39;term_group&#39;</span>) );</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                $term_id = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            $link_cat_id_map[$cat_id] = $term_id;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            $default_link_cat = $term_id;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_taxonomy, array(<span class="stringliteral">&#39;term_id&#39;</span> =&gt; $term_id, <span class="stringliteral">&#39;taxonomy&#39;</span> =&gt; <span class="stringliteral">&#39;link_category&#39;</span>, <span class="stringliteral">&#39;description&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;parent&#39;</span> =&gt; 0, <span class="stringliteral">&#39;count&#39;</span> =&gt; 0) );</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            $tt_ids[$term_id] = (int) $wpdb-&gt;insert_id;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="comment">// Associate links to cats.</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        $links = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT link_id, link_category FROM $wpdb-&gt;links&quot;</span>);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="keywordflow">if</span> ( !empty($links) ) <span class="keywordflow">foreach</span> ( $links as <a class="code" href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a> ) {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">if</span> ( 0 == $link-&gt;link_category )</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            <span class="keywordflow">if</span> ( ! isset($link_cat_id_map[$link-&gt;link_category]) )</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            $term_id = $link_cat_id_map[$link-&gt;link_category];</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            $tt_id = $tt_ids[$term_id];</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            <span class="keywordflow">if</span> ( empty($tt_id) )</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;object_id&#39;</span> =&gt; $link-&gt;link_id, <span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $tt_id) );</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        }</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="comment">// Set default to the last category we grabbed during the upgrade loop.</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;default_link_category&#39;</span>, $default_link_cat);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        $links = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT link_id, category_id FROM $wpdb-&gt;link2cat GROUP BY link_id, category_id&quot;</span>);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="keywordflow">foreach</span> ( $links as <a class="code" href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a> ) {</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            $link_id = (int) $link-&gt;link_id;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            $term_id = (<span class="keywordtype">int</span>) $link-&gt;category_id;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            $taxonomy = <span class="stringliteral">&#39;link_category&#39;</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            $tt_id = $tt_ids[$term_id][$taxonomy];</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <span class="keywordflow">if</span> ( empty($tt_id) )</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            $wpdb-&gt;insert( $wpdb-&gt;term_relationships, array(<span class="stringliteral">&#39;object_id&#39;</span> =&gt; $link_id, <span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $tt_id) );</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        }</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    }</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 4772 ) {</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="comment">// Obsolete linkcategories table</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;linkcategories&#39;</span>);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// Recalculate all counts</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    $terms = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SELECT term_taxonomy_id, taxonomy FROM $wpdb-&gt;term_taxonomy&quot;</span>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">foreach</span> ( (array) $terms as $term ) {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <span class="keywordflow">if</span> ( (<span class="stringliteral">&#39;post_tag&#39;</span> == $term-&gt;taxonomy) || (<span class="stringliteral">&#39;category&#39;</span> == $term-&gt;taxonomy) )</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT COUNT(*) FROM $wpdb-&gt;term_relationships, $wpdb-&gt;posts WHERE $wpdb-&gt;posts.ID = $wpdb-&gt;term_relationships.object_id AND post_status = &#39;publish&#39; AND post_type = &#39;post&#39; AND term_taxonomy_id = %d&quot;</span>, $term-&gt;term_taxonomy_id) );</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a> = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT COUNT(*) FROM $wpdb-&gt;term_relationships WHERE term_taxonomy_id = %d&quot;</span>, $term-&gt;term_taxonomy_id) );</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        $wpdb-&gt;update( $wpdb-&gt;term_taxonomy, array(<span class="stringliteral">&#39;count&#39;</span> =&gt; <a class="code" href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a>), array(<span class="stringliteral">&#39;term_taxonomy_id&#39;</span> =&gt; $term-&gt;term_taxonomy_id) );</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;}</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment"> * Remove old options from the database.</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment"> * @since 2.3.0</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b"> 1116</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b">upgrade_230_options_table</a>() {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    $old_options_fields = array( <span class="stringliteral">&#39;option_can_override&#39;</span>, <span class="stringliteral">&#39;option_type&#39;</span>, <span class="stringliteral">&#39;option_width&#39;</span>, <span class="stringliteral">&#39;option_height&#39;</span>, <span class="stringliteral">&#39;option_description&#39;</span>, <span class="stringliteral">&#39;option_admin_level&#39;</span> );</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">foreach</span> ( $old_options_fields as $old )</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP $old&quot;</span>);</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;}</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment"> * Remove old categories, link2cat, and post2cat database tables.</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment"> * @since 2.3.0</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5"> 1133</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5">upgrade_230_old_tables</a>() {</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;categories&#39;</span>);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;link2cat&#39;</span>);</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&#39;DROP TABLE IF EXISTS &#39;</span> . $wpdb-&gt;prefix . <span class="stringliteral">&#39;post2cat&#39;</span>);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;}</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment"> * Upgrade old slugs made in version 2.2.</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"> * @since 2.2.0</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7"> 1148</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7">upgrade_old_slugs</a>() {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="comment">// Upgrade people who were using the Redirect Old Slugs plugin.</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;postmeta SET meta_key = &#39;_wp_old_slug&#39; WHERE meta_key = &#39;old_slug&#39;&quot;</span>);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;}</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.5.0.</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment"> * @since 2.5.0</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31"> 1162</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31">upgrade_250</a>() {</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 6689 ) {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <a class="code" href="schema_8php.html#afce90368b01f472eb9bb1985ad8bf516">populate_roles_250</a>();</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;}</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.5.2.</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment"> * @since 2.5.2</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6"> 1179</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6">upgrade_252</a>() {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;UPDATE $wpdb-&gt;users SET user_activation_key = &#39;&#39;&quot;</span>);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;}</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.6.</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"> * @since 2.6.0</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b"> 1193</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b">upgrade_260</a>() {</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8000 )</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <a class="code" href="schema_8php.html#aa8757d0a593613e9355764eed6e4d2bd">populate_roles_260</a>();</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;}</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.7.</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment"> * @since 2.7.0</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3"> 1209</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3">upgrade_270</a>() {</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, $wp_current_db_version;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8980 )</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <a class="code" href="schema_8php.html#a8bc8d01445e862efd317a5a8091515f4">populate_roles_270</a>();</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    <span class="comment">// Update post_date for unpublished posts with empty timestamp</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 8921 )</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;UPDATE $wpdb-&gt;posts SET post_date = post_modified WHERE post_date = &#39;0000-00-00 00:00:00&#39;&quot;</span> );</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;}</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.8.</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment"> * @since 2.8.0</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9"> 1229</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9">upgrade_280</a>() {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 10360 )</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <a class="code" href="schema_8php.html#a9e635badc4aab288965ee64bd2a8a607">populate_roles_280</a>();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        $start = 0;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">while</span>( $rows = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT option_name, option_value FROM $wpdb-&gt;options ORDER BY option_id LIMIT $start, 20&quot;</span> ) ) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="keywordflow">foreach</span> ( $rows as $row ) {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> = $row-&gt;option_value;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                <span class="keywordflow">if</span> ( !@unserialize( <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> ) )</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                    <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> = stripslashes( <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> );</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> !== $row-&gt;option_value ) {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                    <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( $row-&gt;option_name, <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> );</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                }</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            }</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            $start += 20;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        }</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <a class="code" href="ms-blogs_8php.html#aa610d04d0c26b5c800cecb2381896747">refresh_blog_details</a>( $wpdb-&gt;blogid );</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;}</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment"> * Execute changes made in WordPress 2.9.</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3"> 1259</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3">upgrade_290</a>() {</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11958 ) {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        <span class="comment">// Previously, setting depth to 1 would redundantly disable threading, but now 2 is the minimum depth to avoid confusion</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;thread_comments_depth&#39;</span> ) == <span class="charliteral">&#39;1&#39;</span> ) {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;            <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;thread_comments_depth&#39;</span>, 2 );</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;            <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;thread_comments&#39;</span>, 0 );</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    }</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;}</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.0.</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment"> * @since 3.0.0</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04"> 1280</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04">upgrade_300</a>() {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 15093 )</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        <a class="code" href="schema_8php.html#a1960b9961b3d8f38c5af16ae7317548d">populate_roles_300</a>();</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 14139 &amp;&amp; <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <a class="code" href="wordpress_2wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() &amp;&amp; ! defined( <span class="stringliteral">&#39;MULTISITE&#39;</span> ) &amp;&amp; <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;siteurl&#39;</span> ) === <span class="keyword">false</span> )</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <a class="code" href="option_8php.html#a2c2c039acbd1f0ddc4063fbcfb11b3a2">add_site_option</a>( <span class="stringliteral">&#39;siteurl&#39;</span>, <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="comment">// 3.0 screen options key name changes.</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        $sql = <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="stringliteral">            WHERE meta_key LIKE %s</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="stringliteral">            OR meta_key LIKE %s</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="stringliteral">            OR meta_key LIKE %s</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="stringliteral">            OR meta_key LIKE %s</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="stringliteral">            OR meta_key LIKE %s</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="stringliteral">            OR meta_key LIKE %s</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="stringliteral">            OR meta_key = &#39;manageedittagscolumnshidden&#39;</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="stringliteral">            OR meta_key = &#39;managecategoriescolumnshidden&#39;</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="stringliteral">            OR meta_key = &#39;manageedit-tagscolumnshidden&#39;</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="stringliteral">            OR meta_key = &#39;manageeditcolumnshidden&#39;</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="stringliteral">            OR meta_key = &#39;categories_per_page&#39;</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="stringliteral">            OR meta_key = &#39;edit_tags_per_page&#39;&quot;</span>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> = $wpdb-&gt;esc_like( $wpdb-&gt;base_prefix );</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        $wpdb-&gt;query( $wpdb-&gt;prepare( $sql,</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;meta-box-hidden&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span>,</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;closedpostboxes&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span>,</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;manage-&#39;</span>     ) . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;-columns-hidden&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span>,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;meta-box-order&#39;</span>  ) . <span class="charliteral">&#39;%&#39;</span>,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;metaboxorder&#39;</span>    ) . <span class="charliteral">&#39;%&#39;</span>,</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <a class="code" href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> . <span class="charliteral">&#39;%&#39;</span> . $wpdb-&gt;esc_like( <span class="stringliteral">&#39;screen_layout&#39;</span>   ) . <span class="charliteral">&#39;%&#39;</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        ) );</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;}</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.3.</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment"> * @since 3.3.0</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment"> * @global int   $wp_current_db_version</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment"> * @global array $wp_registered_widgets</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment"> * @global array $sidebars_widgets</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e"> 1328</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e">upgrade_330</a>() {</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, <a class="code" href="wp-includes_2widgets_8php.html#a24c1fc3a7e94da5ac9b3846b6d93f2a7">$wp_registered_widgets</a>, <a class="code" href="wp-admin_2widgets_8php.html#a233259fe7379e46b62e0a6d786f8f921">$sidebars_widgets</a>;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19061 &amp;&amp; <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key IN (&#39;show_admin_bar_admin&#39;, &#39;plugins_last_view&#39;)&quot;</span> );</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &gt;= 11548 )</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    $sidebars_widgets = <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;sidebars_widgets&#39;</span>, array() );</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    $_sidebars_widgets = array();</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">if</span> ( isset($sidebars_widgets[<span class="stringliteral">&#39;wp_inactive_widgets&#39;</span>]) || empty($sidebars_widgets) )</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        $sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 3;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( !isset($sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>]) )</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        $sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 1;</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">switch</span> ( $sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] ) {</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        <span class="keywordflow">case</span> 1 :</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            <span class="keywordflow">foreach</span> ( (array) $sidebars_widgets as $index =&gt; $sidebar )</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            <span class="keywordflow">if</span> ( is_array($sidebar) )</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            <span class="keywordflow">foreach</span> ( (array) $sidebar as <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> =&gt; <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> ) {</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a> = strtolower(<a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                <span class="keywordflow">if</span> ( isset($wp_registered_widgets[<a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>]) ) {</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                    $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                }</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                $id = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                <span class="keywordflow">if</span> ( isset($wp_registered_widgets[$id]) ) {</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                    $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = <a class="code" href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                $found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                <span class="keywordflow">foreach</span> ( $wp_registered_widgets as $widget_id =&gt; $widget ) {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                    <span class="keywordflow">if</span> ( strtolower($widget[<span class="stringliteral">&#39;name&#39;</span>]) == strtolower(<a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) ) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                        $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $widget[<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                        $found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($widget[<span class="stringliteral">&#39;name&#39;</span>]) == <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>(<a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a>) ) {</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                        $_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $widget[<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                        $found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                    }</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                }</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                <span class="keywordflow">if</span> ( $found )</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                unset($_sidebars_widgets[$index][<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>]);</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            }</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            $_sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 2;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            $sidebars_widgets = $_sidebars_widgets;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            unset($_sidebars_widgets);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <span class="keywordflow">case</span> 2 :</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            $sidebars_widgets = <a class="code" href="wp-includes_2widgets_8php.html#a0696ef1f645f9f4ab0b6b67023d21bba">retrieve_widgets</a>();</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            $sidebars_widgets[<span class="stringliteral">&#39;array_version&#39;</span>] = 3;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;sidebars_widgets&#39;</span>, $sidebars_widgets );</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;}</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.4.</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment"> * @since 3.4.0</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment"> * @global int   $wp_current_db_version</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e"> 1401</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e">upgrade_340</a>() {</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19798 ) {</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP COLUMN blog_id&quot;</span> );</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19799 ) {</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;comments DROP INDEX comment_approved&quot;</span>);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20022 &amp;&amp; <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key = &#39;themes_last_view&#39;&quot;</span> );</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20080 ) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;yes&#39;</span> == $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT autoload FROM $wpdb-&gt;options WHERE option_name = &#39;uninstall_plugins&#39;&quot;</span> ) ) {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            $uninstall_plugins = <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;uninstall_plugins&#39;</span> );</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;            <a class="code" href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714">delete_option</a>( <span class="stringliteral">&#39;uninstall_plugins&#39;</span> );</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            <a class="code" href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a>( <span class="stringliteral">&#39;uninstall_plugins&#39;</span>, $uninstall_plugins, <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a>, <span class="stringliteral">&#39;no&#39;</span> );</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        }</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    }</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;}</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.5.</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment"> * @since 3.5.0</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment"> * @global int   $wp_current_db_version</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b"> 1438</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b">upgrade_350</a>() {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 22006 &amp;&amp; $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT link_id FROM $wpdb-&gt;links LIMIT 1&quot;</span> ) )</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;link_manager_enabled&#39;</span>, 1 ); <span class="comment">// Previously set to 0 by populate_options()</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 21811 &amp;&amp; <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        $meta_keys = array();</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <span class="keywordflow">foreach</span> ( array_merge( <a class="code" href="wp-includes_2post_8php.html#a608a82c55bc57d0bc9b34888b92212e1">get_post_types</a>(), <a class="code" href="wp-includes_2taxonomy_8php.html#a2564bddeb1e0131321dbaf7e14087265">get_taxonomies</a>() ) as <a class="code" href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a> ) {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            <span class="keywordflow">if</span> ( <span class="keyword">false</span> !== strpos( $name, <span class="charliteral">&#39;-&#39;</span> ) )</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            $meta_keys[] = <span class="stringliteral">&#39;edit_&#39;</span> . <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>( <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, $name ) . <span class="stringliteral">&#39;_per_page&#39;</span>;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        }</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">if</span> ( $meta_keys ) {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            $meta_keys = implode( <span class="stringliteral">&quot;&#39;, &#39;&quot;</span>, $meta_keys );</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;DELETE FROM $wpdb-&gt;usermeta WHERE meta_key IN (&#39;$meta_keys&#39;)&quot;</span> );</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        }</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    }</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 22422 &amp;&amp; $term = <a class="code" href="wp-includes_2taxonomy_8php.html#a35e551b4e66f77cb9f0e8c060d120e5a">get_term_by</a>( <span class="stringliteral">&#39;slug&#39;</span>, <span class="stringliteral">&#39;post-format-standard&#39;</span>, <span class="stringliteral">&#39;post_format&#39;</span> ) )</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <a class="code" href="wp-includes_2taxonomy_8php.html#ad28d62c01fc8952379351022b765987e">wp_delete_term</a>( $term-&gt;term_id, <span class="stringliteral">&#39;post_format&#39;</span> );</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;}</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.7.</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment"> * @since 3.7.0</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a149a4a6a39985eeb606346e7569b1a4e"> 1468</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a149a4a6a39985eeb606346e7569b1a4e">upgrade_370</a>() {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 25824 )</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <a class="code" href="cron_8php.html#a86c1ec51457365db2bbcf9d92218dfb7">wp_clear_scheduled_hook</a>( <span class="stringliteral">&#39;wp_auto_updates_maybe_update&#39;</span> );</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;}</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.7.2.</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment"> * @since 3.7.2</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment"> * @since 3.8.0</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a547d60672205f0f6b4f4523837959ad5"> 1483</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a547d60672205f0f6b4f4523837959ad5">upgrade_372</a>() {</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 26148 )</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <a class="code" href="cron_8php.html#a86c1ec51457365db2bbcf9d92218dfb7">wp_clear_scheduled_hook</a>( <span class="stringliteral">&#39;wp_maybe_auto_update&#39;</span> );</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;}</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="comment"> * Execute changes made in WordPress 3.8.0.</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment"> * @since 3.8.0</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#af35f0dd4765f8bcd73a00866b270d6c5"> 1497</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#af35f0dd4765f8bcd73a00866b270d6c5">upgrade_380</a>() {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 26691 ) {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        <a class="code" href="wp-admin_2includes_2plugin_8php.html#a10a4cc7247cf0cb722062baf35784b8a">deactivate_plugins</a>( array( <span class="stringliteral">&#39;mp6/mp6.php&#39;</span> ), <span class="keyword">true</span> );</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    }</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;}</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment"> * Execute changes made in WordPress 4.0.0.</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment"> * @since 4.0.0</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aadfa550ecd8c271a4106e8572267a667"> 1512</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#aadfa550ecd8c271a4106e8572267a667">upgrade_400</a>() {</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 29630 ) {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <span class="keywordflow">if</span> ( ! <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <span class="keyword">false</span> === <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;WPLANG&#39;</span> ) ) {</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            <span class="keywordflow">if</span> ( defined( <span class="stringliteral">&#39;WPLANG&#39;</span> ) &amp;&amp; ( <span class="stringliteral">&#39;&#39;</span> !== <a class="code" href="wp-tests-config_8php.html#a40d0e1a61d6ee8d066bea2fcfcd2ff6c">WPLANG</a> ) &amp;&amp; in_array( <a class="code" href="wp-tests-config_8php.html#a40d0e1a61d6ee8d066bea2fcfcd2ff6c">WPLANG</a>, <a class="code" href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332">get_available_languages</a>() ) ) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;WPLANG&#39;</span>, <a class="code" href="wp-tests-config_8php.html#a40d0e1a61d6ee8d066bea2fcfcd2ff6c">WPLANG</a> );</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;WPLANG&#39;</span>, <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            }</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;}</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment"> * Execute changes made in WordPress 4.2.0.</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment"> * @since 4.2.0</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment"> * @global int   $wp_current_db_version</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a149ec7eac4fec633411ed814e4e43132"> 1534</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a149ec7eac4fec633411ed814e4e43132">upgrade_420</a>() {}</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment"> * Executes changes made in WordPress 4.3.0.</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="comment"> * @since 4.3.0</span></div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment"> * @global int  $wp_current_db_version Current version.</span></div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment"> * @global wpdb $wpdb                  WordPress database abstraction object.</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#abfca0b6119ad903eaef624ef833f4272"> 1545</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#abfca0b6119ad903eaef624ef833f4272">upgrade_430</a>() {</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 32364 ) {</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <a class="code" href="includes_2upgrade_8php.html#a63e624fc4a828d92c8322a071e395e9d">upgrade_430_fix_comments</a>();</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    }</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="comment">// Shared terms are split in a separate process.</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 32814 ) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;finished_splitting_shared_terms&#39;</span>, 0 );</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <a class="code" href="cron_8php.html#aa1513c794ed209ff01c44928a64f6752">wp_schedule_single_event</a>( time() + ( 1 * MINUTE_IN_SECONDS ), <span class="stringliteral">&#39;wp_split_shared_term_batch&#39;</span> );</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 33055 &amp;&amp; &#39;utf8mb4&#39; === $wpdb-&gt;charset ) {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() ) {</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            $tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;blog&#39;</span> );</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            $tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;all&#39;</span> );</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            <span class="keywordflow">if</span> ( ! <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                $global_tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;global&#39;</span> );</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                $tables = array_diff_assoc( $tables, $global_tables );</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        }</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <span class="keywordflow">foreach</span> ( $tables as $table ) {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            <a class="code" href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a">maybe_convert_table_to_utf8mb4</a>( $table );</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    }</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;}</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment"> * Executes comments changes made in WordPress 4.3.0.</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment"> * @since 4.3.0</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment"> * @global int  $wp_current_db_version Current version.</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment"> * @global wpdb $wpdb                  WordPress database abstraction object.</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a63e624fc4a828d92c8322a071e395e9d"> 1584</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a63e624fc4a828d92c8322a071e395e9d">upgrade_430_fix_comments</a>() {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    $content_length = $wpdb-&gt;get_col_length( $wpdb-&gt;comments, <span class="stringliteral">&#39;comment_content&#39;</span> );</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( $content_length ) ) {</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    }</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $content_length ) {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        $content_length = array(</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="stringliteral">&#39;type&#39;</span>   =&gt; <span class="stringliteral">&#39;byte&#39;</span>,</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            <span class="stringliteral">&#39;length&#39;</span> =&gt; 65535,</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        );</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( ! is_array( $content_length ) ) {</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        $length = (int) $content_length &gt; 0 ? (<span class="keywordtype">int</span>) $content_length : 65535;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        $content_length = array(</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;            <span class="stringliteral">&#39;type&#39;</span>   =&gt; <span class="stringliteral">&#39;byte&#39;</span>,</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            <span class="stringliteral">&#39;length&#39;</span> =&gt; $length</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        );</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    }</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;byte&#39;</span> !== $content_length[<span class="stringliteral">&#39;type&#39;</span>] || 0 === $content_length[<span class="stringliteral">&#39;length&#39;</span>] ) {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <span class="comment">// Sites with malformed DB schemas are on their own.</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    $allowed_length = intval( $content_length[<span class="stringliteral">&#39;length&#39;</span>] ) - 10;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    $comments = $wpdb-&gt;get_results(</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <span class="stringliteral">&quot;SELECT `comment_ID` FROM `{$wpdb-&gt;comments}`</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="stringliteral">            WHERE `comment_date_gmt` &gt; &#39;2015-04-26&#39;</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="stringliteral">            AND LENGTH( `comment_content` ) &gt;= {$allowed_length}</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="stringliteral">            AND ( `comment_content` LIKE &#39;%&lt;%&#39; OR `comment_content` LIKE &#39;%&gt;%&#39; )&quot;</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    );</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordflow">foreach</span> ( $comments as <a class="code" href="wp-comments-post_8php.html#a536677acc0163c53c067316a97456e6c">$comment</a> ) {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <a class="code" href="wp-includes_2comment_8php.html#a7754633416dca78a36ef5b4722e654b5">wp_delete_comment</a>( $comment-&gt;comment_ID, <span class="keyword">true</span> );</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;}</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment"> * Executes changes made in WordPress 4.3.1.</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment"> * @since 4.3.1</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a4196a0788a22c00429b67df81d3db465"> 1631</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a4196a0788a22c00429b67df81d3db465">upgrade_431</a>() {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="comment">// Fix incorrect cron entries for term splitting</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    $cron_array = <a class="code" href="cron_8php.html#ab5d2461d83cac30242eda86bd7f95cd8">_get_cron_array</a>();</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    <span class="keywordflow">if</span> ( isset( $cron_array[<span class="stringliteral">&#39;wp_batch_split_terms&#39;</span>] ) ) {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        unset( $cron_array[<span class="stringliteral">&#39;wp_batch_split_terms&#39;</span>] );</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        <a class="code" href="cron_8php.html#ae54ce0a72e466757f23228d3ef1d0d6f">_set_cron_array</a>( $cron_array );</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    }</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;}</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment"> * Executes changes made in WordPress 4.4.0.</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="comment"> * @since 4.4.0</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment"> * @global int  $wp_current_db_version Current version.</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment"> * @global wpdb $wpdb                  WordPress database abstraction object.</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ac825208abc4b5cca86e38718afadebe1"> 1649</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ac825208abc4b5cca86e38718afadebe1">upgrade_440</a>() {</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 34030 ) {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE {$wpdb-&gt;options} MODIFY option_name VARCHAR(191)&quot;</span> );</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    }</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// Remove the unused &#39;add_users&#39; role.</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    $roles = <a class="code" href="capabilities_8php.html#a8c86f267da09c8b69f85e8a53614bd06">wp_roles</a>();</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordflow">foreach</span> ( $roles-&gt;role_objects as $role ) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">if</span> ( $role-&gt;has_cap( <span class="stringliteral">&#39;add_users&#39;</span> ) ) {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            $role-&gt;remove_cap( <span class="stringliteral">&#39;add_users&#39;</span> );</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        }</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    }</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;}</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment"> * Execute changes made in WordPress 4.5.0</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment"> * @since 4.5.0</span></div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment"> * @global int $wp_current_db_version</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ad54b23bafca162f7b1d8ee3536826a1e"> 1673</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ad54b23bafca162f7b1d8ee3536826a1e">upgrade_450</a>() {</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    global $wp_current_db_version;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 36180 )</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <a class="code" href="cron_8php.html#a86c1ec51457365db2bbcf9d92218dfb7">wp_clear_scheduled_hook</a>( <span class="stringliteral">&#39;wp_maybe_auto_update&#39;</span> );</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;}</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment"> * Executes network-level upgrade routines.</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment"> * @since 3.0.0</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="comment"> * @global int   $wp_current_db_version</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ab30e0db0ffe1bede090b8e6b8f116db9"> 1687</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ab30e0db0ffe1bede090b8e6b8f116db9">upgrade_network</a>() {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <span class="comment">// Always.</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178">is_main_network</a>() ) {</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment">         * Deletes all expired transients. The multi-table delete syntax is used</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">         * to delete the transient record from table a, and the corresponding</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">         * transient_timeout record from table b.</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        $time = time();</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        $sql = <span class="stringliteral">&quot;DELETE a, b FROM $wpdb-&gt;sitemeta a, $wpdb-&gt;sitemeta b</span></div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="stringliteral">            WHERE a.meta_key LIKE %s</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="stringliteral">            AND a.meta_key NOT LIKE %s</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="stringliteral">            AND b.meta_key = CONCAT( &#39;_site_transient_timeout_&#39;, SUBSTRING( a.meta_key, 17 ) )</span></div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="stringliteral">            AND b.meta_value &lt; %d&quot;</span>;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        $wpdb-&gt;query( $wpdb-&gt;prepare( $sql, $wpdb-&gt;esc_like( <span class="stringliteral">&#39;_site_transient_&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span>, $wpdb-&gt;esc_like ( <span class="stringliteral">&#39;_site_transient_timeout_&#39;</span> ) . <span class="charliteral">&#39;%&#39;</span>, $time ) );</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    }</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="comment">// 2.8.</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11549 ) {</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        $wpmu_sitewide_plugins = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;wpmu_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        $active_sitewide_plugins = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        <span class="keywordflow">if</span> ( $wpmu_sitewide_plugins ) {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            <span class="keywordflow">if</span> ( !$active_sitewide_plugins )</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                $sitewide_plugins = (array) $wpmu_sitewide_plugins;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                $sitewide_plugins = array_merge( (array) $active_sitewide_plugins, (array) $wpmu_sitewide_plugins );</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span>, $sitewide_plugins );</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        }</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <a class="code" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a>( <span class="stringliteral">&#39;wpmu_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        <a class="code" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a>( <span class="stringliteral">&#39;deactivated_sitewide_plugins&#39;</span> );</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        $start = 0;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="keywordflow">while</span>( $rows = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT meta_key, meta_value FROM {$wpdb-&gt;sitemeta} ORDER BY meta_id LIMIT $start, 20&quot;</span> ) ) {</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            <span class="keywordflow">foreach</span> ( $rows as $row ) {</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> = $row-&gt;meta_value;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                <span class="keywordflow">if</span> ( !@unserialize( <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> ) )</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                    <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> = stripslashes( <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> );</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> !== $row-&gt;meta_value ) {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                    <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( $row-&gt;meta_key, <a class="code" href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a> );</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                }</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            }</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            $start += 20;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        }</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="comment">// 3.0</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 13576 )</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;global_terms_enabled&#39;</span>, <span class="charliteral">&#39;1&#39;</span> );</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <span class="comment">// 3.3</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19390 )</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;initial_db_version&#39;</span>, $wp_current_db_version );</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 19470 ) {</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="keywordflow">if</span> ( <span class="keyword">false</span> === <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span> ) )</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;active_sitewide_plugins&#39;</span>, array() );</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="comment">// 3.4</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 20148 ) {</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        <span class="comment">// &#39;allowedthemes&#39; keys things by stylesheet. &#39;allowed_themes&#39; keyed things by name.</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;        $allowedthemes  = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;allowedthemes&#39;</span>  );</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        $allowed_themes = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;allowed_themes&#39;</span> );</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $allowedthemes &amp;&amp; is_array( $allowed_themes ) &amp;&amp; $allowed_themes ) {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            $converted = array();</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            $themes = <a class="code" href="wp-includes_2theme_8php.html#ad028eec53a1a467937aedb9b38db9524">wp_get_themes</a>();</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            <span class="keywordflow">foreach</span> ( $themes as $stylesheet =&gt; $theme_data ) {</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                <span class="keywordflow">if</span> ( isset( $allowed_themes[ $theme_data-&gt;get(<span class="stringliteral">&#39;Name&#39;</span>) ] ) )</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                    $converted[ $stylesheet ] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            }</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;allowedthemes&#39;</span>, $converted );</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;            <a class="code" href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a>( <span class="stringliteral">&#39;allowed_themes&#39;</span> );</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    }</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="comment">// 3.5</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 21823 )</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;ms_files_rewriting&#39;</span>, <span class="charliteral">&#39;1&#39;</span> );</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="comment">// 3.5.2</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 24448 ) {</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        $illegal_names = <a class="code" href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a>( <span class="stringliteral">&#39;illegal_names&#39;</span> );</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        <span class="keywordflow">if</span> ( is_array( $illegal_names ) &amp;&amp; count( $illegal_names ) === 1 ) {</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            $illegal_name = reset( $illegal_names );</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            $illegal_names = explode( <span class="charliteral">&#39; &#39;</span>, $illegal_name );</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            <a class="code" href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a>( <span class="stringliteral">&#39;illegal_names&#39;</span>, $illegal_names );</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        }</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    }</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <span class="comment">// 4.2</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 31351 &amp;&amp; $wpdb-&gt;charset === <span class="stringliteral">&#39;utf8mb4&#39;</span> ) {</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;usermeta DROP INDEX meta_key, ADD INDEX meta_key(meta_key(191))&quot;</span> );</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;site DROP INDEX domain, ADD INDEX domain(domain(140),path(51))&quot;</span> );</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;sitemeta DROP INDEX meta_key, ADD INDEX meta_key(meta_key(191))&quot;</span> );</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;signups DROP INDEX domain_path, ADD INDEX domain_path(domain(140),path(51))&quot;</span> );</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            $tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;global&#39;</span> );</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            <span class="comment">// sitecategories may not exist.</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            <span class="keywordflow">if</span> ( ! $wpdb-&gt;get_var( <span class="stringliteral">&quot;SHOW TABLES LIKE &#39;{$tables[&#39;sitecategories&#39;]}&#39;&quot;</span> ) ) {</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                unset( $tables[<span class="stringliteral">&#39;sitecategories&#39;</span>] );</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;            }</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            <span class="keywordflow">foreach</span> ( $tables as $table ) {</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                <a class="code" href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a">maybe_convert_table_to_utf8mb4</a>( $table );</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            }</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        }</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    }</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="comment">// 4.3</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 33055 &amp;&amp; &#39;utf8mb4&#39; === $wpdb-&gt;charset ) {</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            $upgrade = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            $indexes = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SHOW INDEXES FROM $wpdb-&gt;signups&quot;</span> );</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            <span class="keywordflow">foreach</span> ( $indexes as $index ) {</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;domain_path&#39;</span> == $index-&gt;Key_name &amp;&amp; <span class="stringliteral">&#39;domain&#39;</span> == $index-&gt;Column_name &amp;&amp; 140 != $index-&gt;Sub_part ) {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                    $upgrade = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            }</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            <span class="keywordflow">if</span> ( $upgrade ) {</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;signups DROP INDEX domain_path, ADD INDEX domain_path(domain(140),path(51))&quot;</span> );</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            }</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            $tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;global&#39;</span> );</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            <span class="comment">// sitecategories may not exist.</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            <span class="keywordflow">if</span> ( ! $wpdb-&gt;get_var( <span class="stringliteral">&quot;SHOW TABLES LIKE &#39;{$tables[&#39;sitecategories&#39;]}&#39;&quot;</span> ) ) {</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                unset( $tables[<span class="stringliteral">&#39;sitecategories&#39;</span>] );</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;            }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;            <span class="keywordflow">foreach</span> ( $tables as $table ) {</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                <a class="code" href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a">maybe_convert_table_to_utf8mb4</a>( $table );</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        }</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    }</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;}</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">// General functions we use to actually do stuff</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment"> * Creates a table in the database if it doesn&#39;t already exist.</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment"> * This method checks for an existing database and creates a new one if it&#39;s not</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment"> * already present. It doesn&#39;t rely on MySQL&#39;s &quot;IF NOT EXISTS&quot; statement, but chooses</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment"> * to query all tables first and then run the SQL statement creating the table.</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment"> * @since 1.0.0</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment"> * @param string $table_name Database table name to create.</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment"> * @param string $create_ddl SQL statement to create table.</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment"> * @return bool If table already exists or was created by function.</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ac900ebb6c033deed947b02120cea6f98"> 1849</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ac900ebb6c033deed947b02120cea6f98">maybe_create_table</a>($table_name, $create_ddl) {</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    $query = $wpdb-&gt;prepare( <span class="stringliteral">&quot;SHOW TABLES LIKE %s&quot;</span>, $wpdb-&gt;esc_like( $table_name ) );</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    <span class="keywordflow">if</span> ( $wpdb-&gt;get_var( $query ) == $table_name ) {</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    }</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="comment">// Didn&#39;t find it try to create it..</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    $wpdb-&gt;query($create_ddl);</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="comment">// We cannot directly tell that whether this succeeded!</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordflow">if</span> ( $wpdb-&gt;get_var( $query ) == $table_name ) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    }</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;}</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;<span class="comment"> * Drops a specified index from a table.</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment"> * @since 1.0.1</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment"> * @param string $table Database table name.</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment"> * @param string $index Index name to drop.</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment"> * @return true True, when finished.</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab"> 1879</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab">drop_index</a>($table, $index) {</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    $wpdb-&gt;hide_errors();</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE `$table` DROP INDEX `$index`&quot;</span>);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="comment">// Now we need to take out all the extra ones we may have created</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; 25; <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE `$table` DROP INDEX `{$index}_$i`&quot;</span>);</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    }</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    $wpdb-&gt;show_errors();</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;}</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment"> * Adds an index to a specified table.</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment"> * @since 1.0.1</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="comment"> * @param string $table Database table name.</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment"> * @param string $index Database table index column.</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment"> * @return true True, when done with execution.</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4"> 1902</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a>($table, $index) {</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab">drop_index</a>($table, $index);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE `$table` ADD INDEX ( `$index` )&quot;</span>);</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;}</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment"> * Adds column to a database table if it doesn&#39;t already exist.</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment"> * @since 1.3.0</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment"> * @param string $table_name  The table name to modify.</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="comment"> * @param string $column_name The column name to add to the table.</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="comment"> * @param string $create_ddl  The SQL statement used to add the column.</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment"> * @return bool True if already exists or on successful completion, false on error.</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a4af9a7ccd99686b9d07aa3e0aa9e2444"> 1921</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a4af9a7ccd99686b9d07aa3e0aa9e2444">maybe_add_column</a>($table_name, $column_name, $create_ddl) {</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="keywordflow">foreach</span> ($wpdb-&gt;get_col(<span class="stringliteral">&quot;DESC $table_name&quot;</span>, 0) as $column ) {</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        <span class="keywordflow">if</span> ($column == $column_name) {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        }</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;    }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    <span class="comment">// Didn&#39;t find it try to create it.</span></div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    $wpdb-&gt;query($create_ddl);</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="comment">// We cannot directly tell that whether this succeeded!</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">foreach</span> ($wpdb-&gt;get_col(<span class="stringliteral">&quot;DESC $table_name&quot;</span>, 0) as $column ) {</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        <span class="keywordflow">if</span> ($column == $column_name) {</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        }</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    }</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;}</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment"> * If a table only contains utf8 or utf8mb4 columns, convert it to utf8mb4.</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment"> * @since 4.2.0</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;<span class="comment"> * @param string $table The table to convert.</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;<span class="comment"> * @return bool true if the table was converted, false if it wasn&#39;t.</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a"> 1951</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a">maybe_convert_table_to_utf8mb4</a>( $table ) {</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    $results = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SHOW FULL COLUMNS FROM `$table`&quot;</span> );</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <span class="keywordflow">if</span> ( ! $results ) {</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    }</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <span class="keywordflow">foreach</span> ( $results as $column ) {</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keywordflow">if</span> ( $column-&gt;Collation ) {</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;            <a class="code" href="namespacelist.html">list</a>( <a class="code" href="wp-trackback_8php.html#a7834352ede0750defe2d05c17b4f3815">$charset</a> ) = explode( <span class="charliteral">&#39;_&#39;</span>, $column-&gt;Collation );</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;            <a class="code" href="wp-trackback_8php.html#a7834352ede0750defe2d05c17b4f3815">$charset</a> = strtolower( <a class="code" href="wp-trackback_8php.html#a7834352ede0750defe2d05c17b4f3815">$charset</a> );</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;            <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;utf8&#39;</span> !== <a class="code" href="wp-trackback_8php.html#a7834352ede0750defe2d05c17b4f3815">$charset</a> &amp;&amp; <span class="stringliteral">&#39;utf8mb4&#39;</span> !== <a class="code" href="wp-trackback_8php.html#a7834352ede0750defe2d05c17b4f3815">$charset</a> ) {</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                <span class="comment">// Don&#39;t upgrade tables that have non-utf8 columns.</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;            }</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        }</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    }</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    $table_details = $wpdb-&gt;get_row( <span class="stringliteral">&quot;SHOW TABLE STATUS LIKE &#39;$table&#39;&quot;</span> );</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="keywordflow">if</span> ( ! $table_details ) {</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    }</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <a class="code" href="namespacelist.html">list</a>( $table_charset ) = explode( <span class="charliteral">&#39;_&#39;</span>, $table_details-&gt;Collation );</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    $table_charset = strtolower( $table_charset );</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;utf8mb4&#39;</span> === $table_charset ) {</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    }</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keywordflow">return</span> $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $table CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci&quot;</span> );</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;}</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment"> * Retrieve all options as it was for 1.2.</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment"> * @since 1.2.0</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment"> * @return stdClass List of options.</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483"> 1993</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483">get_alloptions_110</a>() {</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    $all_options = <span class="keyword">new</span> stdClass;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="wp-content_2themes_2twentyeleven_2sidebar_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = $wpdb-&gt;get_results( <span class="stringliteral">&quot;SELECT option_name, option_value FROM $wpdb-&gt;options&quot;</span> ) ) {</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        <span class="keywordflow">foreach</span> ( <a class="code" href="wp-content_2themes_2twentyeleven_2sidebar_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> as <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> ) {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;siteurl&#39;</span> == $option-&gt;option_name || <span class="stringliteral">&#39;home&#39;</span> == $option-&gt;option_name || <span class="stringliteral">&#39;category_base&#39;</span> == $option-&gt;option_name )</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                $option-&gt;option_value = <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( $option-&gt;option_value );</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            $all_options-&gt;{$option-&gt;option_name} = stripslashes( $option-&gt;option_value );</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        }</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    }</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    <span class="keywordflow">return</span> $all_options;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;}</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="comment"> * Utility version of get_option that is private to install/upgrade.</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment"> * @since 1.5.1</span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment"> * @access private</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment"> * @param string $setting Option name.</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment"> * @return mixed</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1"> 2018</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>($setting) {</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <span class="keywordflow">if</span> ( $setting == <span class="stringliteral">&#39;home&#39;</span> &amp;&amp; defined( <span class="stringliteral">&#39;WP_HOME&#39;</span> ) )</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( WP_HOME );</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">if</span> ( $setting == <span class="stringliteral">&#39;siteurl&#39;</span> &amp;&amp; defined( <span class="stringliteral">&#39;WP_SITEURL&#39;</span> ) )</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( WP_SITEURL );</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> = $wpdb-&gt;get_var( $wpdb-&gt;prepare(<span class="stringliteral">&quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s&quot;</span>, $setting ) );</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;home&#39;</span> == $setting &amp;&amp; <span class="stringliteral">&#39;&#39;</span> == <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> )</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>( <span class="stringliteral">&#39;siteurl&#39;</span> );</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;siteurl&#39;</span> == $setting || <span class="stringliteral">&#39;home&#39;</span> == $setting || <span class="stringliteral">&#39;category_base&#39;</span> == $setting || <span class="stringliteral">&#39;tag_base&#39;</span> == $setting )</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> = <a class="code" href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a>( <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> );</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4">maybe_unserialize</a>( <a class="code" href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a> );</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;}</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment"> * Filters for content to remove unnecessary slashes.</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment"> * @param string $content The content to modify.</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment"> * @return string The de-slashed content.</span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336"> 2046</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a>(<a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a>) {</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="comment">// Note: \\\ inside a regex denotes a single backslash.</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">     * Replace one or more backslashes followed by a single quote with</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">     * a single quote.</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a> = preg_replace(<span class="stringliteral">&quot;/\\\+&#39;/&quot;</span>, <span class="stringliteral">&quot;&#39;&quot;</span>, <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a>);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">     * Replace one or more backslashes followed by a double quote with</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment">     * a double quote.</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a> = preg_replace(<span class="stringliteral">&#39;/\\\+&quot;/&#39;</span>, <span class="charliteral">&#39;&quot;&#39;</span>, <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a>);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    <span class="comment">// Replace one or more backslashes with one backslash.</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a> = preg_replace(<span class="stringliteral">&quot;/\\\+/&quot;</span>, <span class="stringliteral">&quot;\\&quot;</span>, <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a>);</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a>;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;}</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment"> * Modifies the database based on specified SQL statements.</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="comment"> * Useful for creating new tables and updating existing tables to a new structure.</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment"> * @param string|array $queries Optional. The query to run. Can be multiple queries</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment"> *                              in an array, or a string of queries separated by</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment"> *                              semicolons. Default empty.</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment"> * @param bool         $execute Optional. Whether or not to execute the query right away.</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment"> *                              Default true.</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment"> * @return array Strings containing the results of the various update queries.</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7"> 2083</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $queries = <span class="stringliteral">&#39;&#39;</span>, $execute = <span class="keyword">true</span> ) {</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="keywordflow">if</span> ( in_array( $queries, array( <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;all&#39;</span>, <span class="stringliteral">&#39;blog&#39;</span>, <span class="stringliteral">&#39;global&#39;</span>, <span class="stringliteral">&#39;ms_global&#39;</span> ), <span class="keyword">true</span> ) )</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        $queries = <a class="code" href="schema_8php.html#a69d44db5129b85c08fa02666649039b1">wp_get_db_schema</a>( $queries );</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    <span class="comment">// Separate individual queries into an array</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="keywordflow">if</span> ( !is_array($queries) ) {</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        $queries = explode( <span class="charliteral">&#39;;&#39;</span>, $queries );</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        $queries = array_filter( $queries );</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    }</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">     * Filter the dbDelta SQL queries.</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">     * @since 3.3.0</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;<span class="comment">     * @param array $queries An array of dbDelta SQL queries.</span></div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    $queries = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;dbdelta_queries&#39;</span>, $queries );</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    $cqueries = array(); <span class="comment">// Creation Queries</span></div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    $iqueries = array(); <span class="comment">// Insertion Queries</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    $for_update = array();</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    <span class="comment">// Create a tablename index for an array ($cqueries) of queries</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keywordflow">foreach</span> ($queries as $qry) {</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="keywordflow">if</span> ( preg_match( <span class="stringliteral">&quot;|CREATE TABLE ([^ ]*)|&quot;</span>, $qry, $matches ) ) {</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            $cqueries[ trim( $matches[1], <span class="charliteral">&#39;`&#39;</span> ) ] = $qry;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            $for_update[$matches[1]] = <span class="stringliteral">&#39;Created table &#39;</span>.$matches[1];</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( preg_match( <span class="stringliteral">&quot;|CREATE DATABASE ([^ ]*)|&quot;</span>, $qry, $matches ) ) {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;            array_unshift( $cqueries, $qry );</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( preg_match( <span class="stringliteral">&quot;|INSERT INTO ([^ ]*)|&quot;</span>, $qry, $matches ) ) {</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;            $iqueries[] = $qry;</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;        } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( preg_match( <span class="stringliteral">&quot;|UPDATE ([^ ]*)|&quot;</span>, $qry, $matches ) ) {</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            $iqueries[] = $qry;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            <span class="comment">// Unrecognized query type</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        }</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    }</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">     * Filter the dbDelta SQL queries for creating tables and/or databases.</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">     * Queries filterable via this hook contain &quot;CREATE TABLE&quot; or &quot;CREATE DATABASE&quot;.</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">     * @since 3.3.0</span></div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">     * @param array $cqueries An array of dbDelta create SQL queries.</span></div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    $cqueries = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;dbdelta_create_queries&#39;</span>, $cqueries );</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment">     * Filter the dbDelta SQL queries for inserting or updating.</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="comment">     * Queries filterable via this hook contain &quot;INSERT INTO&quot; or &quot;UPDATE&quot;.</span></div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">     * @since 3.3.0</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment">     * @param array $iqueries An array of dbDelta insert or update SQL queries.</span></div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;    $iqueries = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;dbdelta_insert_queries&#39;</span>, $iqueries );</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    $global_tables = $wpdb-&gt;tables( <span class="stringliteral">&#39;global&#39;</span> );</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    <span class="keywordflow">foreach</span> ( $cqueries as $table =&gt; $qry ) {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        <span class="comment">// Upgrade global tables only for the main site. Don&#39;t upgrade at all if conditions are not optimal.</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        <span class="keywordflow">if</span> ( in_array( $table, $global_tables ) &amp;&amp; ! <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            unset( $cqueries[ $table ], $for_update[ $table ] );</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        }</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        <span class="comment">// Fetch the table column structure from the database</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        $suppress = $wpdb-&gt;suppress_errors();</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        $tablefields = $wpdb-&gt;get_results(<span class="stringliteral">&quot;DESCRIBE {$table};&quot;</span>);</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        $wpdb-&gt;suppress_errors( $suppress );</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">if</span> ( ! $tablefields )</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        <span class="comment">// Clear the field and index arrays.</span></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        $cfields = $indices = array();</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <span class="comment">// Get all of the field names in the query from between the parentheses.</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;        preg_match(<span class="stringliteral">&quot;|\((.*)\)|ms&quot;</span>, $qry, $match2);</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        $qryline = trim($match2[1]);</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        <span class="comment">// Separate field lines into an array.</span></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        $flds = explode(<span class="stringliteral">&quot;\n&quot;</span>, $qryline);</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        <span class="comment">// todo: Remove this?</span></div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        <span class="comment">//echo &quot;&lt;hr/&gt;&lt;pre&gt;\n&quot;.print_r(strtolower($table), true).&quot;:\n&quot;.print_r($cqueries, true).&quot;&lt;/pre&gt;&lt;hr/&gt;&quot;;</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;        <span class="comment">// For every field line specified in the query.</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        <span class="keywordflow">foreach</span> ($flds as $fld) {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;            <span class="comment">// Extract the field name.</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;            preg_match(<span class="stringliteral">&quot;|^([^ ]*)|&quot;</span>, trim($fld), $fvals);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;            $fieldname = trim( $fvals[1], <span class="charliteral">&#39;`&#39;</span> );</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;            <span class="comment">// Verify the found field name.</span></div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;            $validfield = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;            <span class="keywordflow">switch</span> (strtolower($fieldname)) {</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;&#39;</span>:</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;primary&#39;</span>:</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;index&#39;</span>:</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;fulltext&#39;</span>:</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;unique&#39;</span>:</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;key&#39;</span>:</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                $validfield = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                $indices[] = trim(trim($fld), <span class="stringliteral">&quot;, \n&quot;</span>);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            }</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;            $fld = trim($fld);</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            <span class="comment">// If it&#39;s a valid field, add it to the field array.</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            <span class="keywordflow">if</span> ($validfield) {</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                $cfields[strtolower($fieldname)] = trim($fld, <span class="stringliteral">&quot;, \n&quot;</span>);</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;            }</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        }</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <span class="comment">// For every field in the table.</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        <span class="keywordflow">foreach</span> ($tablefields as $tablefield) {</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;            <span class="comment">// If the table field exists in the field array ...</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;            <span class="keywordflow">if</span> (array_key_exists(strtolower($tablefield-&gt;Field), $cfields)) {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                <span class="comment">// Get the field type from the query.</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                preg_match(<span class="stringliteral">&quot;|&quot;</span>.$tablefield-&gt;Field.<span class="stringliteral">&quot; ([^ ]*( unsigned)?)|i&quot;</span>, $cfields[strtolower($tablefield-&gt;Field)], $matches);</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                $fieldtype = $matches[1];</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                <span class="comment">// Is actual field type different from the field type in query?</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                <span class="keywordflow">if</span> ($tablefield-&gt;Type != $fieldtype) {</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                    <span class="comment">// Add a query to change the column type</span></div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                    $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} CHANGE COLUMN {$tablefield-&gt;Field} &quot;</span> . $cfields[strtolower($tablefield-&gt;Field)];</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                    $for_update[$table.<span class="charliteral">&#39;.&#39;</span>.$tablefield-&gt;Field] = <span class="stringliteral">&quot;Changed type of {$table}.{$tablefield-&gt;Field} from {$tablefield-&gt;Type} to {$fieldtype}&quot;</span>;</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                }</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                <span class="comment">// Get the default value from the array</span></div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                    <span class="comment">// todo: Remove this?</span></div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                    <span class="comment">//echo &quot;{$cfields[strtolower($tablefield-&gt;Field)]}&lt;br&gt;&quot;;</span></div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;| DEFAULT &#39;(.*?)&#39;|i&quot;</span>, $cfields[strtolower($tablefield-&gt;Field)], $matches)) {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                    $default_value = $matches[1];</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                    <span class="keywordflow">if</span> ($tablefield-&gt;Default != $default_value) {</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                        <span class="comment">// Add a query to change the column&#39;s default value</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                        $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} ALTER COLUMN {$tablefield-&gt;Field} SET DEFAULT &#39;{$default_value}&#39;&quot;</span>;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                        $for_update[$table.<span class="charliteral">&#39;.&#39;</span>.$tablefield-&gt;Field] = <span class="stringliteral">&quot;Changed default value of {$table}.{$tablefield-&gt;Field} from {$tablefield-&gt;Default} to {$default_value}&quot;</span>;</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                    }</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                }</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                <span class="comment">// Remove the field from the array (so it&#39;s not added).</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                unset($cfields[strtolower($tablefield-&gt;Field)]);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                <span class="comment">// This field exists in the table, but not in the creation queries?</span></div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;            }</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="comment">// For every remaining field specified for the table.</span></div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        <span class="keywordflow">foreach</span> ($cfields as $fieldname =&gt; $fielddef) {</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;            <span class="comment">// Push a query line into $cqueries that adds the field to that table.</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} ADD COLUMN $fielddef&quot;</span>;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;            $for_update[$table.<span class="charliteral">&#39;.&#39;</span>.$fieldname] = <span class="stringliteral">&#39;Added column &#39;</span>.$table.<span class="charliteral">&#39;.&#39;</span>.$fieldname;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        }</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        <span class="comment">// Index stuff goes here. Fetch the table index structure from the database.</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        $tableindices = $wpdb-&gt;get_results(<span class="stringliteral">&quot;SHOW INDEX FROM {$table};&quot;</span>);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">if</span> ($tableindices) {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;            <span class="comment">// Clear the index array.</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;            $index_ary = array();</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;            <span class="comment">// For every index in the table.</span></div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            <span class="keywordflow">foreach</span> ($tableindices as $tableindex) {</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                <span class="comment">// Add the index to the index data array.</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                $keyname = $tableindex-&gt;Key_name;</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                $index_ary[$keyname][<span class="stringliteral">&#39;columns&#39;</span>][] = array(<span class="stringliteral">&#39;fieldname&#39;</span> =&gt; $tableindex-&gt;Column_name, <span class="stringliteral">&#39;subpart&#39;</span> =&gt; $tableindex-&gt;Sub_part);</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                $index_ary[$keyname][<span class="stringliteral">&#39;unique&#39;</span>] = ($tableindex-&gt;Non_unique == 0)?<span class="keyword">true</span>:<span class="keyword">false</span>;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                $index_ary[$keyname][<span class="stringliteral">&#39;index_type&#39;</span>] = $tableindex-&gt;Index_type;</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;            }</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;            <span class="comment">// For each actual index in the index array.</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;            <span class="keywordflow">foreach</span> ($index_ary as $index_name =&gt; $index_data) {</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                <span class="comment">// Build a create string to compare to the query.</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                $index_string = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                <span class="keywordflow">if</span> ($index_name == <span class="stringliteral">&#39;PRIMARY&#39;</span>) {</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                    $index_string .= <span class="stringliteral">&#39;PRIMARY &#39;</span>;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( $index_data[<span class="stringliteral">&#39;unique&#39;</span>] ) {</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                    $index_string .= <span class="stringliteral">&#39;UNIQUE &#39;</span>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                }</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;FULLTEXT&#39;</span> === strtoupper( $index_data[<span class="stringliteral">&#39;index_type&#39;</span>] ) ) {</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                    $index_string .= <span class="stringliteral">&#39;FULLTEXT &#39;</span>;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                }</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                $index_string .= <span class="stringliteral">&#39;KEY &#39;</span>;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                <span class="keywordflow">if</span> ($index_name != <span class="stringliteral">&#39;PRIMARY&#39;</span>) {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                    $index_string .= $index_name;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                }</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                $index_columns = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                <span class="comment">// For each column in the index.</span></div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                <span class="keywordflow">foreach</span> ($index_data[<span class="stringliteral">&#39;columns&#39;</span>] as $column_data) {</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                    <span class="keywordflow">if</span> ($index_columns != <span class="stringliteral">&#39;&#39;</span>) $index_columns .= <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                    <span class="comment">// Add the field to the column list string.</span></div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                    $index_columns .= $column_data[<span class="stringliteral">&#39;fieldname&#39;</span>];</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                    <span class="keywordflow">if</span> ($column_data[<span class="stringliteral">&#39;subpart&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                        $index_columns .= <span class="charliteral">&#39;(&#39;</span>.$column_data[<span class="stringliteral">&#39;subpart&#39;</span>].<span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                    }</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                <span class="comment">// The alternative index string doesn&#39;t care about subparts</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                $alt_index_columns = preg_replace( <span class="stringliteral">&#39;/\([^)]*\)/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $index_columns );</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                <span class="comment">// Add the column list to the index create string.</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                $index_strings = array(</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                    <span class="stringliteral">&quot;$index_string ($index_columns)&quot;</span>,</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                    <span class="stringliteral">&quot;$index_string ($alt_index_columns)&quot;</span>,</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                );</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                <span class="keywordflow">foreach</span> ( $index_strings as $index_string ) {</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                    <span class="keywordflow">if</span> ( ! ( ( $aindex = array_search( $index_string, $indices ) ) === <span class="keyword">false</span> ) ) {</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                        unset( $indices[ $aindex ] );</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                        <span class="comment">// todo: Remove this?</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                        <span class="comment">//echo &quot;&lt;pre style=\&quot;border:1px solid #ccc;margin-top:5px;\&quot;&gt;{$table}:&lt;br /&gt;Found index:&quot;.$index_string.&quot;&lt;/pre&gt;\n&quot;;</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                    }</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                }</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                <span class="comment">// todo: Remove this?</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;                <span class="comment">//else echo &quot;&lt;pre style=\&quot;border:1px solid #ccc;margin-top:5px;\&quot;&gt;{$table}:&lt;br /&gt;&lt;b&gt;Did not find index:&lt;/b&gt;&quot;.$index_string.&quot;&lt;br /&gt;&quot;.print_r($indices, true).&quot;&lt;/pre&gt;\n&quot;;</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            }</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;        }</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        <span class="comment">// For every remaining index specified for the table.</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        <span class="keywordflow">foreach</span> ( (array) $indices as $index ) {</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;            <span class="comment">// Push a query line into $cqueries that adds the index to that table.</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;            $cqueries[] = <span class="stringliteral">&quot;ALTER TABLE {$table} ADD $index&quot;</span>;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;            $for_update[] = <span class="stringliteral">&#39;Added index &#39;</span> . $table . <span class="charliteral">&#39; &#39;</span> . $index;</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        }</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="comment">// Remove the original table creation query from processing.</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        unset( $cqueries[ $table ], $for_update[ $table ] );</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    }</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    $allqueries = array_merge($cqueries, $iqueries);</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="keywordflow">if</span> ($execute) {</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <span class="keywordflow">foreach</span> ($allqueries as $query) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;            <span class="comment">// todo: Remove this?</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            <span class="comment">//echo &quot;&lt;pre style=\&quot;border:1px solid #ccc;margin-top:5px;\&quot;&gt;&quot;.print_r($query, true).&quot;&lt;/pre&gt;\n&quot;;</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            $wpdb-&gt;query($query);</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        }</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    }</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <span class="keywordflow">return</span> $for_update;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;}</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment"> * Updates the database tables to a new schema.</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;<span class="comment"> * By default, updates all the tables to use the latest defined schema, but can also</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;<span class="comment"> * be used to update a specific set of tables in wp_get_db_schema().</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;<span class="comment"> * @uses dbDelta</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment"> * @param string $tables Optional. Which set of tables to update. Default is &#39;all&#39;.</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#ab68f6b47e715e99c6e5664a41e4a2333"> 2350</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#ab68f6b47e715e99c6e5664a41e4a2333">make_db_current</a>( $tables = <span class="stringliteral">&#39;all&#39;</span> ) {</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    $alterations = <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $tables );</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    echo <span class="stringliteral">&quot;&lt;ol&gt;\n&quot;</span>;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <span class="keywordflow">foreach</span> ($alterations as $alteration) echo <span class="stringliteral">&quot;&lt;li&gt;$alteration&lt;/li&gt;\n&quot;</span>;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    echo <span class="stringliteral">&quot;&lt;/ol&gt;\n&quot;</span>;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;}</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment"> * Updates the database tables to a new schema, but without displaying results.</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="comment"> * By default, updates all the tables to use the latest defined schema, but can</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="comment"> * also be used to update a specific set of tables in wp_get_db_schema().</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment"> * @see make_db_current()</span></div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="comment"> * @param string $tables Optional. Which set of tables to update. Default is &#39;all&#39;.</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02369"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5"> 2369</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5">make_db_current_silent</a>( $tables = <span class="stringliteral">&#39;all&#39;</span> ) {</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $tables );</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;}</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment"> * Creates a site theme from an existing theme.</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;<span class="comment"> * {@internal Missing Long Description}}</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment"> * @param string $theme_name The name of the theme.</span></div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment"> * @param string $template   The directory name of the theme.</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="comment"> * @return bool</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2"> 2384</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2">make_site_theme_from_oldschool</a>($theme_name, <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>) {</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <a class="code" href="options-permalink_8php.html#ae6a00c5418f0bef00d8fc6e3eab08037">$home_path</a> = <a class="code" href="wp-admin_2includes_2file_8php.html#aefba71100e8eaa464359f61a4081a210">get_home_path</a>();</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    $site_dir = <a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes/$template&quot;</span>;</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    <span class="keywordflow">if</span> (! file_exists(<span class="stringliteral">&quot;$home_path/index.php&quot;</span>))</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">     * Copy files from the old locations to the site theme.</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">     * TODO: This does not copy arbitrary include dependencies. Only the standard WP files are copied.</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    $files = array(<span class="stringliteral">&#39;index.php&#39;</span> =&gt; <span class="stringliteral">&#39;index.php&#39;</span>, <span class="stringliteral">&#39;wp-layout.css&#39;</span> =&gt; <span class="stringliteral">&#39;style.css&#39;</span>, <span class="stringliteral">&#39;wp-comments.php&#39;</span> =&gt; <span class="stringliteral">&#39;comments.php&#39;</span>, <span class="stringliteral">&#39;wp-comments-popup.php&#39;</span> =&gt; <span class="stringliteral">&#39;comments-popup.php&#39;</span>);</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;    <span class="keywordflow">foreach</span> ($files as $oldfile =&gt; $newfile) {</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;        <span class="keywordflow">if</span> ($oldfile == <span class="stringliteral">&#39;index.php&#39;</span>)</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            $oldpath = <a class="code" href="options-permalink_8php.html#ae6a00c5418f0bef00d8fc6e3eab08037">$home_path</a>;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;            $oldpath = <a class="code" href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a>;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        <span class="comment">// Check to make sure it&#39;s not a new index.</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        <span class="keywordflow">if</span> ($oldfile == <span class="stringliteral">&#39;index.php&#39;</span>) {</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            $index = implode(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="namespacefile.html">file</a>(<span class="stringliteral">&quot;$oldpath/$oldfile&quot;</span>));</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;            <span class="keywordflow">if</span> (strpos($index, <span class="stringliteral">&#39;WP_USE_THEMES&#39;</span>) !== <span class="keyword">false</span>) {</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                <span class="keywordflow">if</span> (! @copy(<a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&#39;/themes/&#39;</span> . WP_DEFAULT_THEME . <span class="stringliteral">&#39;/index.php&#39;</span>, <span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>))</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                <span class="comment">// Don&#39;t copy anything.</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;            }</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        }</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;        <span class="keywordflow">if</span> (! @copy(<span class="stringliteral">&quot;$oldpath/$oldfile&quot;</span>, <span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>))</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        chmod(<span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>, 0777);</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;        <span class="comment">// Update the blog header include in each file.</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        $lines = explode(<span class="stringliteral">&quot;\n&quot;</span>, implode(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="namespacefile.html">file</a>(<span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>)));</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        <span class="keywordflow">if</span> ($lines) {</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            $f = fopen(<span class="stringliteral">&quot;$site_dir/$newfile&quot;</span>, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;            <span class="keywordflow">foreach</span> ($lines as $line) {</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/require.*wp-blog-header/&#39;</span>, $line))</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                    $line = <span class="stringliteral">&#39;//&#39;</span> . $line;</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                <span class="comment">// Update stylesheet references.</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                $line = <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>(<span class="stringliteral">&quot;&lt;?php echo __get_option(&#39;siteurl&#39;); ?&gt;/wp-layout.css&quot;</span>, <span class="stringliteral">&quot;&lt;?php bloginfo(&#39;stylesheet_url&#39;); ?&gt;&quot;</span>, $line);</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                <span class="comment">// Update comments template inclusion.</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                $line = <a class="code" href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a>(<span class="stringliteral">&quot;&lt;?php include(ABSPATH . &#39;wp-comments.php&#39;); ?&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;?php comments_template(); ?&gt;&quot;</span>, $line);</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                fwrite($f, <span class="stringliteral">&quot;{$line}\n&quot;</span>);</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;            }</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;            fclose($f);</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        }</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    }</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    <span class="comment">// Add a theme header.</span></div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;    $header = <span class="stringliteral">&quot;/*\nTheme Name: $theme_name\nTheme URI: &quot;</span> . <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;siteurl&#39;</span>) . <span class="stringliteral">&quot;\nDescription: A theme automatically created by the update.\nVersion: 1.0\nAuthor: Moi\n*/\n&quot;</span>;</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    $stylelines = file_get_contents(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>);</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;    <span class="keywordflow">if</span> ($stylelines) {</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        $f = fopen(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        fwrite($f, $header);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        fwrite($f, $stylelines);</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        fclose($f);</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    }</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;}</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="comment"> * Creates a site theme from the default theme.</span></div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="comment"> * {@internal Missing Long Description}}</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="comment"> * @param string $theme_name The name of the theme.</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="comment"> * @param string $template   The directory name of the theme.</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="comment"> * @return false|void</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93"> 2467</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93">make_site_theme_from_default</a>($theme_name, <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>) {</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    $site_dir = <a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes/$template&quot;</span>;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;    $default_dir = <a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&#39;/themes/&#39;</span> . WP_DEFAULT_THEME;</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    <span class="comment">// Copy files from the default theme to the site theme.</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <span class="comment">//$files = array(&#39;index.php&#39;, &#39;comments.php&#39;, &#39;comments-popup.php&#39;, &#39;footer.php&#39;, &#39;header.php&#39;, &#39;sidebar.php&#39;, &#39;style.css&#39;);</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    $theme_dir = @ opendir($default_dir);</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="keywordflow">if</span> ($theme_dir) {</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="keywordflow">while</span>(($theme_file = readdir( $theme_dir )) !== <span class="keyword">false</span>) {</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            <span class="keywordflow">if</span> (is_dir(<span class="stringliteral">&quot;$default_dir/$theme_file&quot;</span>))</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            <span class="keywordflow">if</span> (! @copy(<span class="stringliteral">&quot;$default_dir/$theme_file&quot;</span>, <span class="stringliteral">&quot;$site_dir/$theme_file&quot;</span>))</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;            chmod(<span class="stringliteral">&quot;$site_dir/$theme_file&quot;</span>, 0777);</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;        }</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;    }</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    @closedir($theme_dir);</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    <span class="comment">// Rewrite the theme header.</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    $stylelines = explode(<span class="stringliteral">&quot;\n&quot;</span>, implode(<span class="stringliteral">&#39;&#39;</span>, <a class="code" href="namespacefile.html">file</a>(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>)));</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keywordflow">if</span> ($stylelines) {</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        $f = fopen(<span class="stringliteral">&quot;$site_dir/style.css&quot;</span>, <span class="charliteral">&#39;w&#39;</span>);</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="keywordflow">foreach</span> ($stylelines as $line) {</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;            <span class="keywordflow">if</span> (strpos($line, <span class="stringliteral">&#39;Theme Name:&#39;</span>) !== <span class="keyword">false</span>) $line = <span class="stringliteral">&#39;Theme Name: &#39;</span> . $theme_name;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, <span class="stringliteral">&#39;Theme URI:&#39;</span>) !== <span class="keyword">false</span>) $line = <span class="stringliteral">&#39;Theme URI: &#39;</span> . <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;url&#39;</span>);</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, <span class="stringliteral">&#39;Description:&#39;</span>) !== <span class="keyword">false</span>) $line = <span class="stringliteral">&#39;Description: Your theme.&#39;</span>;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, <span class="stringliteral">&#39;Version:&#39;</span>) !== <span class="keyword">false</span>) $line = <span class="stringliteral">&#39;Version: 1&#39;</span>;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;            <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> (strpos($line, <span class="stringliteral">&#39;Author:&#39;</span>) !== <span class="keyword">false</span>) $line = <span class="stringliteral">&#39;Author: You&#39;</span>;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;            fwrite($f, $line . <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        }</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        fclose($f);</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    }</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="comment">// Copy the images.</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    umask(0);</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="keywordflow">if</span> (! mkdir(<span class="stringliteral">&quot;$site_dir/images&quot;</span>, 0777)) {</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    }</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    $images_dir = @ opendir(<span class="stringliteral">&quot;$default_dir/images&quot;</span>);</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="keywordflow">if</span> ($images_dir) {</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        <span class="keywordflow">while</span>((<a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = readdir($images_dir)) !== <span class="keyword">false</span>) {</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            <span class="keywordflow">if</span> (is_dir(<span class="stringliteral">&quot;$default_dir/images/$image&quot;</span>))</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <span class="keywordflow">if</span> (! @copy(<span class="stringliteral">&quot;$default_dir/images/$image&quot;</span>, <span class="stringliteral">&quot;$site_dir/images/$image&quot;</span>))</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            chmod(<span class="stringliteral">&quot;$site_dir/images/$image&quot;</span>, 0777);</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        }</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    }</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    @closedir($images_dir);</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;}</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="comment"> * Creates a site theme.</span></div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment"> * {@internal Missing Long Description}}</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment"> * @since 1.5.0</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="comment"> * @return false|string</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef"> 2530</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef">make_site_theme</a>() {</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="comment">// Name the theme after the blog.</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    $theme_name = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;blogname&#39;</span>);</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a> = <a class="code" href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a>($theme_name);</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    $site_dir = <a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes/$template&quot;</span>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    <span class="comment">// If the theme already exists, nothing to do.</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    <span class="keywordflow">if</span> ( is_dir($site_dir)) {</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="comment">// We must be able to write to the themes dir.</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">if</span> (! is_writable(<a class="code" href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a> . <span class="stringliteral">&quot;/themes&quot;</span>)) {</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    }</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    umask(0);</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    <span class="keywordflow">if</span> (! mkdir($site_dir, 0777)) {</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    }</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="keywordflow">if</span> (file_exists(<a class="code" href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a> . <span class="stringliteral">&#39;wp-layout.css&#39;</span>)) {</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        <span class="keywordflow">if</span> (! <a class="code" href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2">make_site_theme_from_oldschool</a>($theme_name, <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>)) {</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;            <span class="comment">// TODO: rm -rf the site theme directory.</span></div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        }</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;        <span class="keywordflow">if</span> (! <a class="code" href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93">make_site_theme_from_default</a>($theme_name, <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>))</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;            <span class="comment">// TODO: rm -rf the site theme directory.</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    }</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="comment">// Make the new site theme active.</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    <a class="code" href="select-template_8php.html#ac68a0d7fea5ecfec9da99f4464af104e">$current_template</a> = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>(<span class="stringliteral">&#39;template&#39;</span>);</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="select-template_8php.html#ac68a0d7fea5ecfec9da99f4464af104e">$current_template</a> == WP_DEFAULT_THEME) {</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;template&#39;</span>, <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>);</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>(<span class="stringliteral">&#39;stylesheet&#39;</span>, <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>);</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    }</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a>;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;}</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="comment"> * Translate user level to user role name.</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="comment"> * @since 2.0.0</span></div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;<span class="comment"> * @param int $level User level.</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;<span class="comment"> * @return string User role name.</span></div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3"> 2579</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3">translate_level_to_role</a>($level) {</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordflow">switch</span> ($level) {</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;    <span class="keywordflow">case</span> 10:</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;    <span class="keywordflow">case</span> 9:</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="keywordflow">case</span> 8:</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;administrator&#39;</span>;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    <span class="keywordflow">case</span> 7:</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    <span class="keywordflow">case</span> 6:</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;    <span class="keywordflow">case</span> 5:</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;editor&#39;</span>;</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;    <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;author&#39;</span>;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;contributor&#39;</span>;</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;subscriber&#39;</span>;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    }</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;}</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;<span class="comment"> * Checks the version of the installed MySQL binary.</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;<span class="comment"> * @since 2.1.0</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="comment"> * @global wpdb  $wpdb</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02607"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a2559abc904c6b5dacc954e4589d450a2"> 2607</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a2559abc904c6b5dacc954e4589d450a2">wp_check_mysql_version</a>() {</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    $result = $wpdb-&gt;check_database_version();</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( $result ) )</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;        die( $result-&gt;get_error_message() );</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;}</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="comment"> * Disables the Automattic widgets plugin, which was merged into core.</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment"> * @since 2.2.0</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3"> 2619</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3">maybe_disable_automattic_widgets</a>() {</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> = <a class="code" href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a>( <span class="stringliteral">&#39;active_plugins&#39;</span> );</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <span class="keywordflow">foreach</span> ( (array) <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> as <a class="code" href="plugins_8php.html#ada8a7130088351710bb02ed622d6bf65">$plugin</a> ) {</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        <span class="keywordflow">if</span> ( basename( $plugin ) == <span class="stringliteral">&#39;widgets.php&#39;</span> ) {</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;            array_splice( <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a>, array_search( $plugin, <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> ), 1 );</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;            <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;active_plugins&#39;</span>, <a class="code" href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a> );</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        }</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    }</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;}</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;<span class="comment"> * Disables the Link Manager on upgrade if, at the time of upgrade, no links exist in the DB.</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="comment"> * @since 3.5.0</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7"> 2639</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7">maybe_disable_link_manager</a>() {</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &gt;= 22006 &amp;&amp; <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&#39;link_manager_enabled&#39;</span> ) &amp;&amp; ! $wpdb-&gt;get_var( <span class="stringliteral">&quot;SELECT link_id FROM $wpdb-&gt;links LIMIT 1&quot;</span> ) )</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        <a class="code" href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a>( <span class="stringliteral">&#39;link_manager_enabled&#39;</span>, 0 );</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;}</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;<span class="comment"> * Runs before the schema is upgraded.</span></div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;<span class="comment"> * @global int  $wp_current_db_version</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;<span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span></div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a4123a7eed5c3db1e2e471e636e7f4019"> 2654</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a4123a7eed5c3db1e2e471e636e7f4019">pre_schema_upgrade</a>() {</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    global $wp_current_db_version, <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    <span class="comment">// Upgrade versions prior to 2.9</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 11557 ) {</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        <span class="comment">// Delete duplicate options. Keep the option with the highest option_id.</span></div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;DELETE o1 FROM $wpdb-&gt;options AS o1 JOIN $wpdb-&gt;options AS o2 USING (`option_name`) WHERE o2.option_id &gt; o1.option_id&quot;</span>);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        <span class="comment">// Drop the old primary key and add the new.</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP PRIMARY KEY, ADD PRIMARY KEY(option_id)&quot;</span>);</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <span class="comment">// Drop the old option_name index. dbDelta() doesn&#39;t do the drop.</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        $wpdb-&gt;query(<span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;options DROP INDEX option_name&quot;</span>);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    }</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    <span class="comment">// Multisite schema upgrades.</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 25448 &amp;&amp; <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;        <span class="comment">// Upgrade verions prior to 3.7</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 25179 ) {</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;            <span class="comment">// New primary key for signups.</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;signups ADD signup_id BIGINT(20) NOT NULL AUTO_INCREMENT PRIMARY KEY FIRST&quot;</span> );</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;signups DROP INDEX domain&quot;</span> );</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;        }</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 25448 ) {</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;            <span class="comment">// Convert archived from enum to tinyint.</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;blogs CHANGE COLUMN archived archived varchar(1) NOT NULL default &#39;0&#39;&quot;</span> );</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;blogs CHANGE COLUMN archived archived tinyint(2) NOT NULL default 0&quot;</span> );</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    }</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="comment">// Upgrade versions prior to 4.2.</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 31351 ) {</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="keywordflow">if</span> ( ! <a class="code" href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a>() &amp;&amp; <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() ) {</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;usermeta DROP INDEX meta_key, ADD INDEX meta_key(meta_key(191))&quot;</span> );</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        }</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;terms DROP INDEX slug, ADD INDEX slug(slug(191))&quot;</span> );</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;terms DROP INDEX name, ADD INDEX name(name(191))&quot;</span> );</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;commentmeta DROP INDEX meta_key, ADD INDEX meta_key(meta_key(191))&quot;</span> );</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;postmeta DROP INDEX meta_key, ADD INDEX meta_key(meta_key(191))&quot;</span> );</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;        $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;posts DROP INDEX post_name, ADD INDEX post_name(post_name(191))&quot;</span> );</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    }</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <span class="comment">// Upgrade versions prior to 4.4.</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;    <span class="keywordflow">if</span> ( $wp_current_db_version &lt; 34978 ) {</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;        <span class="comment">// If compatible termmeta table is found, use it, but enforce a proper index and update collation.</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;        <span class="keywordflow">if</span> ( $wpdb-&gt;get_var( <span class="stringliteral">&quot;SHOW TABLES LIKE &#39;{$wpdb-&gt;termmeta}&#39;&quot;</span> ) &amp;&amp; $wpdb-&gt;get_results( <span class="stringliteral">&quot;SHOW INDEX FROM {$wpdb-&gt;termmeta} WHERE Column_name = &#39;meta_key&#39;&quot;</span> ) ) {</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;            $wpdb-&gt;query( <span class="stringliteral">&quot;ALTER TABLE $wpdb-&gt;termmeta DROP INDEX meta_key, ADD INDEX meta_key(meta_key(191))&quot;</span> );</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;            <a class="code" href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a">maybe_convert_table_to_utf8mb4</a>( $wpdb-&gt;termmeta );</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        }</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    }</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;}</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment"> * Install global terms.</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;<span class="comment"> * @since 3.0.0</span></div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;<span class="comment"> * @global wpdb   $wpdb</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<span class="comment"> * @global string $charset_collate</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="keywordflow">if</span> ( !function_exists( <span class="stringliteral">&#39;install_global_terms&#39;</span> ) ) :</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="keyword">function</span> install_global_terms() {</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    global <a class="code" href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a>, <a class="code" href="schema_8php.html#a4c63261ce2e93e0e25a13073aa748b53">$charset_collate</a>;</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    $ms_queries = <span class="stringliteral">&quot;</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="stringliteral">CREATE TABLE $wpdb-&gt;sitecategories (</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="stringliteral">  cat_ID bigint(20) NOT NULL auto_increment,</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;<span class="stringliteral">  cat_name varchar(55) NOT NULL default &#39;&#39;,</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="stringliteral">  category_nicename varchar(200) NOT NULL default &#39;&#39;,</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="stringliteral">  last_updated timestamp NOT NULL,</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="stringliteral">  PRIMARY KEY  (cat_ID),</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="stringliteral">  KEY category_nicename (category_nicename),</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="stringliteral">  KEY last_updated (last_updated)</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="stringliteral">) $charset_collate;</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="stringliteral">&quot;</span>;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">// now create tables</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    <a class="code" href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a>( $ms_queries );</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;}</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<a class="code" href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a>;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="comment"> * Determine if global tables should be upgraded.</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="comment"> * This function performs a series of checks to ensure the environment allows</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="comment"> * for the safe upgrading of global WordPress database tables. It is necessary</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment"> * because global tables will commonly grow to millions of rows on large</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="comment"> * installations, and the ability to control their upgrade routines can be</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="comment"> * critical to the operation of large networks.</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment"> * In a future iteration, this function may use `wp_is_large_network()` to more-</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment"> * intelligently prevent global table upgrades. Until then, we make sure</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="comment"> * WordPress is on the main site of the main network, to avoid running queries</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment"> * more than once in multi-site or multi-network environments.</span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="comment"> * @since 4.3.0</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment"> * @return bool Whether to run the upgrade routines on global tables.</span></div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"><a class="line" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807"> 2753</a></span>&#160;<span class="keyword">function</span> <a class="code" href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a>() {</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <span class="comment">// Return false early if explicitly not upgrading</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    <span class="keywordflow">if</span> ( defined( <span class="stringliteral">&#39;DO_NOT_UPGRADE_GLOBAL_TABLES&#39;</span> ) ) {</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    }</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <span class="comment">// Assume global tables should be upgraded</span></div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    $should_upgrade = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <span class="comment">// Set to false if not on main network (does not matter if not multi-network)</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordflow">if</span> ( ! <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178">is_main_network</a>() ) {</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;        $should_upgrade = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    }</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <span class="comment">// Set to false if not on main site of current network (does not matter if not multi-site)</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    <span class="keywordflow">if</span> ( ! <a class="code" href="wordpress_2wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a>() ) {</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;        $should_upgrade = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;    }</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="comment">    /**</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="comment">     * Filter if upgrade routines should be run on global tables.</span></div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;<span class="comment">     * @param bool $should_upgrade Whether to run the upgrade routines on global tables.</span></div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;wp_should_upgrade_global_tables&#39;</span>, $should_upgrade );</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;}</div>
<div class="ttc" id="link-add_8php_html_a5d346e31b75d916e3bac9cb193bfc97f"><div class="ttname"><a href="link-add_8php.html#a5d346e31b75d916e3bac9cb193bfc97f">$link</a></div><div class="ttdeci">$link</div><div class="ttdef"><b>Definition:</b> <a href="link-add_8php_source.html#l00026">link-add.php:26</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_abcaf2c635c689728811b6cadec1ba7c7"><div class="ttname"><a href="includes_2upgrade_8php.html#abcaf2c635c689728811b6cadec1ba7c7">maybe_disable_link_manager</a></div><div class="ttdeci">maybe_disable_link_manager()</div><div class="ttdoc">Disables the Link Manager on upgrade if, at the time of upgrade, no links exist in the DB...</div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02639">includes/upgrade.php:2639</a></div></div>
<div class="ttc" id="schema_8php_html_aa8757d0a593613e9355764eed6e4d2bd"><div class="ttname"><a href="schema_8php.html#aa8757d0a593613e9355764eed6e4d2bd">populate_roles_260</a></div><div class="ttdeci">populate_roles_260()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 2.6. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00812">schema.php:812</a></div></div>
<div class="ttc" id="post__image_8php_html_aac6146b4cdec66c94263ddb55afd5946"><div class="ttname"><a href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a></div><div class="ttdeci">$image</div><div class="ttdef"><b>Definition:</b> <a href="post__image_8php_source.html#l00099">post_image.php:99</a></div></div>
<div class="ttc" id="wp-admin_2widgets_8php_html_a233259fe7379e46b62e0a6d786f8f921"><div class="ttname"><a href="wp-admin_2widgets_8php.html#a233259fe7379e46b62e0a6d786f8f921">$sidebars_widgets</a></div><div class="ttdeci">if(!current_theme_supports( 'widgets')) $sidebars_widgets</div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2widgets_8php_source.html#l00083">wp-admin/widgets.php:83</a></div></div>
<div class="ttc" id="wp-trackback_8php_html_a7834352ede0750defe2d05c17b4f3815"><div class="ttname"><a href="wp-trackback_8php.html#a7834352ede0750defe2d05c17b4f3815">$charset</a></div><div class="ttdeci">$charset</div><div class="ttdef"><b>Definition:</b> <a href="wp-trackback_8php_source.html#l00053">wp-trackback.php:53</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_a94c479d8fff19b8a0462664346b64f66"><div class="ttname"><a href="wp-includes_2user_8php.html#a94c479d8fff19b8a0462664346b64f66">username_exists</a></div><div class="ttdeci">username_exists($username)</div><div class="ttdoc">Checks whether the given username exists. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l01198">wp-includes/user.php:1198</a></div></div>
<div class="ttc" id="schema_8php_html_a27dc108eca74bf18d869661ef858f798"><div class="ttname"><a href="schema_8php.html#a27dc108eca74bf18d869661ef858f798">populate_roles_160</a></div><div class="ttdeci">populate_roles_160()</div><div class="ttdoc">Create the roles for WordPress 2.0. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00634">schema.php:634</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ad54593aefc766c0b0070e2d4d09d9b6b"><div class="ttname"><a href="includes_2upgrade_8php.html#ad54593aefc766c0b0070e2d4d09d9b6b">upgrade_260</a></div><div class="ttdeci">upgrade_260()</div><div class="ttdoc">Execute changes made in WordPress 2.6. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01193">includes/upgrade.php:1193</a></div></div>
<div class="ttc" id="wp-includes_2plugin_8php_html_aed75045b0b4572e55462b37b063a77cc"><div class="ttname"><a href="wp-includes_2plugin_8php.html#aed75045b0b4572e55462b37b063a77cc">do_action</a></div><div class="ttdeci">do_action($tag, $arg= '')</div><div class="ttdoc">Execute functions hooked on a specific action hook. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2plugin_8php_source.html#l00482">wp-includes/plugin.php:482</a></div></div>
<div class="ttc" id="post__image_8php_html_a166882b9613466de882dd8727762f2db"><div class="ttname"><a href="post__image_8php.html#a166882b9613466de882dd8727762f2db">$description</a></div><div class="ttdeci">$description</div><div class="ttdef"><b>Definition:</b> <a href="post__image_8php_source.html#l00028">post_image.php:28</a></div></div>
<div class="ttc" id="wp-comments-post_8php_html_a536677acc0163c53c067316a97456e6c"><div class="ttname"><a href="wp-comments-post_8php.html#a536677acc0163c53c067316a97456e6c">$comment</a></div><div class="ttdeci">$comment</div><div class="ttdef"><b>Definition:</b> <a href="wp-comments-post_8php_source.html#l00020">wp-comments-post.php:20</a></div></div>
<div class="ttc" id="formatting_8php_html_ab99d2b875428a3172f6ea9d4d2e33e72"><div class="ttname"><a href="formatting_8php.html#ab99d2b875428a3172f6ea9d4d2e33e72">untrailingslashit</a></div><div class="ttdeci">untrailingslashit($string)</div><div class="ttdoc">Removes trailing forward slashes and backslashes if they exist. </div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l01994">formatting.php:1994</a></div></div>
<div class="ttc" id="user-edit_8php_html_af0fcd925f00973e32f7214859dfb3c6b"><div class="ttname"><a href="user-edit_8php.html#af0fcd925f00973e32f7214859dfb3c6b">$user_id</a></div><div class="ttdeci">$user_id</div><div class="ttdef"><b>Definition:</b> <a href="user-edit_8php_source.html#l00014">user-edit.php:14</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a80fbc8c3883ba92927aebc7a131d2cc3"><div class="ttname"><a href="includes_2upgrade_8php.html#a80fbc8c3883ba92927aebc7a131d2cc3">translate_level_to_role</a></div><div class="ttdeci">translate_level_to_role($level)</div><div class="ttdoc">Translate user level to user role name. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02579">includes/upgrade.php:2579</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_abfca0b6119ad903eaef624ef833f4272"><div class="ttname"><a href="includes_2upgrade_8php.html#abfca0b6119ad903eaef624ef833f4272">upgrade_430</a></div><div class="ttdeci">upgrade_430()</div><div class="ttdoc">Executes changes made in WordPress 4.3.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01545">includes/upgrade.php:1545</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_aa755261d52d47bd5da5742b39afe166b"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#aa755261d52d47bd5da5742b39afe166b">global_terms_enabled</a></div><div class="ttdeci">global_terms_enabled()</div><div class="ttdoc">Determine whether global terms are enabled. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l04172">wordpress/wp-includes/functions.php:4172</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_afd6d5e27da310b6ded125a7ab130e336"><div class="ttname"><a href="includes_2upgrade_8php.html#afd6d5e27da310b6ded125a7ab130e336">deslash</a></div><div class="ttdeci">deslash($content)</div><div class="ttdoc">Filters for content to remove unnecessary slashes. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02046">includes/upgrade.php:2046</a></div></div>
<div class="ttc" id="schema_8php_html_a8bc8d01445e862efd317a5a8091515f4"><div class="ttname"><a href="schema_8php.html#a8bc8d01445e862efd317a5a8091515f4">populate_roles_270</a></div><div class="ttdeci">populate_roles_270()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 2.7. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00826">schema.php:826</a></div></div>
<div class="ttc" id="cache_8php_html_af4c681a8e4a0681345e7eec841780af6"><div class="ttname"><a href="cache_8php.html#af4c681a8e4a0681345e7eec841780af6">wp_cache_flush</a></div><div class="ttdeci">wp_cache_flush()</div><div class="ttdoc">Removes all cache items. </div><div class="ttdef"><b>Definition:</b> <a href="cache_8php_source.html#l00097">cache.php:97</a></div></div>
<div class="ttc" id="option_8php_html_a7e3ba182891821061bdf3aa08b0895fd"><div class="ttname"><a href="option_8php.html#a7e3ba182891821061bdf3aa08b0895fd">delete_site_option</a></div><div class="ttdeci">delete_site_option($option)</div><div class="ttdoc">Removes a option by name for the current network. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l01041">option.php:1041</a></div></div>
<div class="ttc" id="menu_8php_html_a83018d9153d17d91fbcf3bc10158d34f"><div class="ttname"><a href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a></div><div class="ttdeci">$i</div><div class="ttdef"><b>Definition:</b> <a href="menu_8php_source.html#l00053">menu.php:53</a></div></div>
<div class="ttc" id="cron_8php_html_aa1513c794ed209ff01c44928a64f6752"><div class="ttname"><a href="cron_8php.html#aa1513c794ed209ff01c44928a64f6752">wp_schedule_single_event</a></div><div class="ttdeci">wp_schedule_single_event($timestamp, $hook, $args=array())</div><div class="ttdoc">Schedules a hook to run only once. </div><div class="ttdef"><b>Definition:</b> <a href="cron_8php_source.html#l00023">cron.php:23</a></div></div>
<div class="ttc" id="option_8php_html_afacc3facc45e9b1cf03120755d40f494"><div class="ttname"><a href="option_8php.html#afacc3facc45e9b1cf03120755d40f494">add_option</a></div><div class="ttdeci">add_option($option, $value= '', $deprecated= '', $autoload= 'yes')</div><div class="ttdoc">Add a new option. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00398">option.php:398</a></div></div>
<div class="ttc" id="plugin-editor_8php_html_a4ab51386acb82cd0a0066eac2567b2bd"><div class="ttname"><a href="plugin-editor_8php.html#a4ab51386acb82cd0a0066eac2567b2bd">$plugins</a></div><div class="ttdeci">$plugins</div><div class="ttdef"><b>Definition:</b> <a href="plugin-editor_8php_source.html#l00025">plugin-editor.php:25</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a2559abc904c6b5dacc954e4589d450a2"><div class="ttname"><a href="includes_2upgrade_8php.html#a2559abc904c6b5dacc954e4589d450a2">wp_check_mysql_version</a></div><div class="ttdeci">wp_check_mysql_version()</div><div class="ttdoc">Checks the version of the installed MySQL binary. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02607">includes/upgrade.php:2607</a></div></div>
<div class="ttc" id="capabilities_8php_html_a99845439f6f1db111622e0b684512ba7"><div class="ttname"><a href="capabilities_8php.html#a99845439f6f1db111622e0b684512ba7">is_super_admin</a></div><div class="ttdeci">is_super_admin($user_id=false)</div><div class="ttdoc">Determine if user is a site admin. </div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8php_source.html#l00598">capabilities.php:598</a></div></div>
<div class="ttc" id="rewrite_8php_html_a0ee4a66b12c0b232789dc96925b5d263"><div class="ttname"><a href="rewrite_8php.html#a0ee4a66b12c0b232789dc96925b5d263">flush_rewrite_rules</a></div><div class="ttdeci">flush_rewrite_rules($hard=true)</div><div class="ttdoc">Remove rewrite rules and then recreate rewrite rules. </div><div class="ttdef"><b>Definition:</b> <a href="rewrite_8php_source.html#l00271">rewrite.php:271</a></div></div>
<div class="ttc" id="async-upload_8php_html_a2717aea9720d8d0b37b32fede52333b6"><div class="ttname"><a href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a></div><div class="ttdeci">$post_id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00084">async-upload.php:84</a></div></div>
<div class="ttc" id="wp-includes_2comment_8php_html_a7754633416dca78a36ef5b4722e654b5"><div class="ttname"><a href="wp-includes_2comment_8php.html#a7754633416dca78a36ef5b4722e654b5">wp_delete_comment</a></div><div class="ttdeci">wp_delete_comment($comment_id, $force_delete=false)</div><div class="ttdoc">Trashes or deletes a comment. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2comment_8php_source.html#l01108">wp-includes/comment.php:1108</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a278f8eaf153a74f3348fe92d16e044d2"><div class="ttname"><a href="includes_2upgrade_8php.html#a278f8eaf153a74f3348fe92d16e044d2">make_site_theme_from_oldschool</a></div><div class="ttdeci">make_site_theme_from_oldschool($theme_name, $template)</div><div class="ttdoc">Creates a site theme from an existing theme. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02384">includes/upgrade.php:2384</a></div></div>
<div class="ttc" id="noop_8php_html_a2d2cbc03d92d4736569cab661c417c22"><div class="ttname"><a href="noop_8php.html#a2d2cbc03d92d4736569cab661c417c22">home_url</a></div><div class="ttdeci">home_url()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00076">noop.php:76</a></div></div>
<div class="ttc" id="wp-admin_2includes_2file_8php_html_aefba71100e8eaa464359f61a4081a210"><div class="ttname"><a href="wp-admin_2includes_2file_8php.html#aefba71100e8eaa464359f61a4081a210">get_home_path</a></div><div class="ttdeci">get_home_path()</div><div class="ttdoc">Get the absolute filesystem path to the root of the WordPress installation. </div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2includes_2file_8php_source.html#l00095">wp-admin/includes/file.php:95</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a913d174175f69bd5da3dba3288acc2b1"><div class="ttname"><a href="includes_2upgrade_8php.html#a913d174175f69bd5da3dba3288acc2b1">__get_option</a></div><div class="ttdeci">__get_option($setting)</div><div class="ttdoc">Utility version of get_option that is private to install/upgrade. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02018">includes/upgrade.php:2018</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a1a4ddf27527646308447391e3ac4dce3"><div class="ttname"><a href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a></div><div class="ttdeci">update_attached_file($attachment_id, $file)</div><div class="ttdoc">Update attachment file path based on attachment ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00218">wp-includes/post.php:218</a></div></div>
<div class="ttc" id="load-scripts_8php_html_a495f94983b95273ad267511b2411351f"><div class="ttname"><a href="load-scripts_8php.html#a495f94983b95273ad267511b2411351f">ABSPATH</a></div><div class="ttdeci">const ABSPATH</div><div class="ttdoc">Set ABSPATH for execution. </div><div class="ttdef"><b>Definition:</b> <a href="load-scripts_8php_source.html#l00011">load-scripts.php:11</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a4dacfef72ebe1c7276f7d94fdbe93554"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a4dacfef72ebe1c7276f7d94fdbe93554">current_time</a></div><div class="ttdeci">current_time($type, $gmt=0)</div><div class="ttdoc">Retrieve the current time based on specified type. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l00061">wordpress/wp-includes/functions.php:61</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a308cd978af2b74dfdf5ebfac83df9b3e"><div class="ttname"><a href="includes_2upgrade_8php.html#a308cd978af2b74dfdf5ebfac83df9b3e">upgrade_330</a></div><div class="ttdeci">upgrade_330()</div><div class="ttdoc">Execute changes made in WordPress 3.3. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01328">includes/upgrade.php:1328</a></div></div>
<div class="ttc" id="cron_8php_html_a86c1ec51457365db2bbcf9d92218dfb7"><div class="ttname"><a href="cron_8php.html#a86c1ec51457365db2bbcf9d92218dfb7">wp_clear_scheduled_hook</a></div><div class="ttdeci">wp_clear_scheduled_hook($hook, $args=array())</div><div class="ttdoc">Unschedule all cron jobs attached to a specific hook. </div><div class="ttdef"><b>Definition:</b> <a href="cron_8php_source.html#l00190">cron.php:190</a></div></div>
<div class="ttc" id="search-field-date_8php_html_ab0fb235c4acb6fcb8c0d565d101505a4"><div class="ttname"><a href="search-field-date_8php.html#ab0fb235c4acb6fcb8c0d565d101505a4">if</a></div><div class="ttdeci">if(!gv_empty($search_field['label'], false))</div><div class="ttdoc">Install global terms. </div><div class="ttdef"><b>Definition:</b> <a href="search-field-date_8php_source.html#l00014">search-field-date.php:14</a></div></div>
<div class="ttc" id="options-permalink_8php_html_a09e8cf95b9d29955a0bfabca9b420edc"><div class="ttname"><a href="options-permalink_8php.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a></div><div class="ttdeci">$prefix</div><div class="ttdef"><b>Definition:</b> <a href="options-permalink_8php_source.html#l00055">options-permalink.php:55</a></div></div>
<div class="ttc" id="option_8php_html_a2c2c039acbd1f0ddc4063fbcfb11b3a2"><div class="ttname"><a href="option_8php.html#a2c2c039acbd1f0ddc4063fbcfb11b3a2">add_site_option</a></div><div class="ttdeci">add_site_option($option, $value)</div><div class="ttdoc">Add a new option for the current network. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l01026">option.php:1026</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a494c188ad4536ef708f4d684cc1a8178"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a494c188ad4536ef708f4d684cc1a8178">is_main_network</a></div><div class="ttdeci">is_main_network($network_id=null)</div><div class="ttdoc">Determine whether a network is the main network of the Multisite install. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l04107">wordpress/wp-includes/functions.php:4107</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_ada8efad85a9cd028503cbe55c37c890a"><div class="ttname"><a href="edit-form-advanced_8php.html#ada8efad85a9cd028503cbe55c37c890a">_x</a></div><div class="ttdeci">if(current_theme_supports( 'post-formats')&amp;&amp;post_type_supports($post_type, 'post-formats')) add_meta_box( 'formatdiv' _x( 'Format', 'post format')</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00244">edit-form-advanced.php:244</a></div></div>
<div class="ttc" id="admin_8php_html_af1c9ecf26c0cfd247c0760dd4b594a6d"><div class="ttname"><a href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a></div><div class="ttdeci">if(get_option('db_upgraded')) elseif(get_option('db_version')!=$wp_db_version &amp;&amp;empty($_POST))</div><div class="ttdef"><b>Definition:</b> <a href="admin_8php_source.html#l00045">admin.php:45</a></div></div>
<div class="ttc" id="other__entries_8php_html_a7ae192438b083bb6b6b8687dc86df3bb"><div class="ttname"><a href="other__entries_8php.html#a7ae192438b083bb6b6b8687dc86df3bb">$deprecated</a></div><div class="ttdeci">$deprecated</div><div class="ttdef"><b>Definition:</b> <a href="other__entries_8php_source.html#l00081">other_entries.php:81</a></div></div>
<div class="ttc" id="link-template_8php_html_ad47f4e06de824d65bd5b1b1e92057a0b"><div class="ttname"><a href="link-template_8php.html#ad47f4e06de824d65bd5b1b1e92057a0b">get_permalink</a></div><div class="ttdeci">get_permalink($post=0, $leavename=false)</div><div class="ttdoc">Retrieve full permalink for current post or post ID. </div><div class="ttdef"><b>Definition:</b> <a href="link-template_8php_source.html#l00117">link-template.php:117</a></div></div>
<div class="ttc" id="meta_8php_html_a1e6585c1d4aae863e98eed45cf290ae0"><div class="ttname"><a href="meta_8php.html#a1e6585c1d4aae863e98eed45cf290ae0">metadata_exists</a></div><div class="ttdeci">metadata_exists($meta_type, $object_id, $meta_key)</div><div class="ttdoc">Determine if a meta key is set for a given object. </div><div class="ttdef"><b>Definition:</b> <a href="meta_8php_source.html#l00525">meta.php:525</a></div></div>
<div class="ttc" id="schema_8php_html_a4c63261ce2e93e0e25a13073aa748b53"><div class="ttname"><a href="schema_8php.html#a4c63261ce2e93e0e25a13073aa748b53">$charset_collate</a></div><div class="ttdeci">global $charset_collate</div><div class="ttdoc">The database character collate. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00018">schema.php:18</a></div></div>
<div class="ttc" id="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php_html_a85f604682d88dda16375d4dbd641df93"><div class="ttname"><a href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php.html#a85f604682d88dda16375d4dbd641df93">$wp_rewrite</a></div><div class="ttdeci">global $wp_rewrite</div><div class="ttdef"><b>Definition:</b> <a href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php_source.html#l00019">tmp/wordpress-tests-lib/includes/bootstrap.php:19</a></div></div>
<div class="ttc" id="formatting_8php_html_aa5eab0fce35c72689998f801b8fc7dfe"><div class="ttname"><a href="formatting_8php.html#aa5eab0fce35c72689998f801b8fc7dfe">wp_slash</a></div><div class="ttdeci">wp_slash($value)</div><div class="ttdoc">Add slashes to a string or array of strings. </div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l04393">formatting.php:4393</a></div></div>
<div class="ttc" id="noop_8php_html_a472b5d168d122332c7e23553b87d7d5d"><div class="ttname"><a href="noop_8php.html#a472b5d168d122332c7e23553b87d7d5d">get_bloginfo</a></div><div class="ttdeci">get_bloginfo()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00056">noop.php:56</a></div></div>
<div class="ttc" id="wp-includes_2taxonomy_8php_html_a2564bddeb1e0131321dbaf7e14087265"><div class="ttname"><a href="wp-includes_2taxonomy_8php.html#a2564bddeb1e0131321dbaf7e14087265">get_taxonomies</a></div><div class="ttdeci">get_taxonomies($args=array(), $output= 'names', $operator= 'and')</div><div class="ttdoc">Retrieves a list of registered taxonomy names or objects. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2taxonomy_8php_source.html#l00150">wp-includes/taxonomy.php:150</a></div></div>
<div class="ttc" id="noop_8php_html_a54639394aa645a2277ea41f3cbd23247"><div class="ttname"><a href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a></div><div class="ttdeci">apply_filters()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00026">noop.php:26</a></div></div>
<div class="ttc" id="option_8php_html_aadb234e9fde76b878f50351325bab9fb"><div class="ttname"><a href="option_8php.html#aadb234e9fde76b878f50351325bab9fb">get_site_option</a></div><div class="ttdeci">get_site_option($option, $default=false, $deprecated=true)</div><div class="ttdoc">Retrieve an option value for the current network based on name of option. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l01008">option.php:1008</a></div></div>
<div class="ttc" id="tmp_2wordpress_2wp-admin_2index_8php_html_a3691fb4ac25261a9b1efa1fd6d58923b"><div class="ttname"><a href="tmp_2wordpress_2wp-admin_2index_8php.html#a3691fb4ac25261a9b1efa1fd6d58923b">$option</a></div><div class="ttdeci">if(has_action( 'welcome_panel')&amp;&amp;current_user_can( 'edit_theme_options')) $option</div><div class="ttdef"><b>Definition:</b> <a href="tmp_2wordpress_2wp-admin_2index_8php_source.html#l00101">tmp/wordpress/wp-admin/index.php:101</a></div></div>
<div class="ttc" id="schema_8php_html_aecf1b5847c533f7633e26d20e9c37d71"><div class="ttname"><a href="schema_8php.html#aecf1b5847c533f7633e26d20e9c37d71">populate_roles_230</a></div><div class="ttdeci">populate_roles_230()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 2.3. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00786">schema.php:786</a></div></div>
<div class="ttc" id="schema_8php_html_ae0b4ae0516536093d825c83dbe0bf045"><div class="ttname"><a href="schema_8php.html#ae0b4ae0516536093d825c83dbe0bf045">populate_roles</a></div><div class="ttdeci">populate_roles()</div><div class="ttdoc">Execute WordPress role creation for the various WordPress versions. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00618">schema.php:618</a></div></div>
<div class="ttc" id="async-upload_8php_html_ad69de186eb69f332f105ae157136192e"><div class="ttname"><a href="async-upload_8php.html#ad69de186eb69f332f105ae157136192e">$id</a></div><div class="ttdeci">if(isset($_REQUEST['post_id'])) $id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00091">async-upload.php:91</a></div></div>
<div class="ttc" id="menu_8php_html_af789423037bbc89dc7c850e761177570"><div class="ttname"><a href="menu_8php.html#af789423037bbc89dc7c850e761177570">$count</a></div><div class="ttdeci">$count</div><div class="ttdef"><b>Definition:</b> <a href="menu_8php_source.html#l00192">menu.php:192</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_aa867ddb4cac7504b879d2706b939fe5a"><div class="ttname"><a href="wp-includes_2user_8php.html#aa867ddb4cac7504b879d2706b939fe5a">get_user_meta</a></div><div class="ttdeci">get_user_meta($user_id, $key= '', $single=false)</div><div class="ttdoc">Retrieve user meta field for a user. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l00703">wp-includes/user.php:703</a></div></div>
<div class="ttc" id="noop_8php_html_aaf1220eff85fdd291725eabf743b2ed3"><div class="ttname"><a href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a></div><div class="ttdeci">get_option()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00031">noop.php:31</a></div></div>
<div class="ttc" id="class-wp-error_8php_html_a741b5ec807dbba8d2a0851e32e7d926c"><div class="ttname"><a href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a></div><div class="ttdeci">is_wp_error($thing)</div><div class="ttdoc">Check whether variable is a WordPress Error. </div><div class="ttdef"><b>Definition:</b> <a href="class-wp-error_8php_source.html#l00216">class-wp-error.php:216</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a036ba9e030cb4feddc2022ac115784f7"><div class="ttname"><a href="includes_2upgrade_8php.html#a036ba9e030cb4feddc2022ac115784f7">dbDelta</a></div><div class="ttdeci">dbDelta($queries= '', $execute=true)</div><div class="ttdoc">Modifies the database based on specified SQL statements. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02083">includes/upgrade.php:2083</a></div></div>
<div class="ttc" id="schema_8php_html_a1960b9961b3d8f38c5af16ae7317548d"><div class="ttname"><a href="schema_8php.html#a1960b9961b3d8f38c5af16ae7317548d">populate_roles_300</a></div><div class="ttdeci">populate_roles_300()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 3.0. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00853">schema.php:853</a></div></div>
<div class="ttc" id="wp-cron_8php_html_af9569cf1bd677c4e8b7cd58bac204a84"><div class="ttname"><a href="wp-cron_8php.html#af9569cf1bd677c4e8b7cd58bac204a84">$gmt_time</a></div><div class="ttdeci">$gmt_time</div><div class="ttdef"><b>Definition:</b> <a href="wp-cron_8php_source.html#l00062">wp-cron.php:62</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a0771fe384061bbaf9ab5c6ff7bff1f93"><div class="ttname"><a href="includes_2upgrade_8php.html#a0771fe384061bbaf9ab5c6ff7bff1f93">make_site_theme_from_default</a></div><div class="ttdeci">make_site_theme_from_default($theme_name, $template)</div><div class="ttdoc">Creates a site theme from the default theme. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02467">includes/upgrade.php:2467</a></div></div>
<div class="ttc" id="ms-blogs_8php_html_aa610d04d0c26b5c800cecb2381896747"><div class="ttname"><a href="ms-blogs_8php.html#aa610d04d0c26b5c800cecb2381896747">refresh_blog_details</a></div><div class="ttdeci">refresh_blog_details($blog_id=0)</div><div class="ttdoc">Clear the blog details cache. </div><div class="ttdef"><b>Definition:</b> <a href="ms-blogs_8php_source.html#l00257">ms-blogs.php:257</a></div></div>
<div class="ttc" id="cron_8php_html_ab5d2461d83cac30242eda86bd7f95cd8"><div class="ttname"><a href="cron_8php.html#ab5d2461d83cac30242eda86bd7f95cd8">_get_cron_array</a></div><div class="ttdeci">_get_cron_array()</div><div class="ttdoc">Retrieve cron info array option. </div><div class="ttdef"><b>Definition:</b> <a href="cron_8php_source.html#l00441">cron.php:441</a></div></div>
<div class="ttc" id="wp-config-sample_8php_html_a26794de5a8ff7fc61c2e05e0107e0135"><div class="ttname"><a href="wp-config-sample_8php.html#a26794de5a8ff7fc61c2e05e0107e0135">$table_prefix</a></div><div class="ttdeci">$table_prefix</div><div class="ttdoc">#@- </div><div class="ttdef"><b>Definition:</b> <a href="wp-config-sample_8php_source.html#l00066">wp-config-sample.php:66</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a547d60672205f0f6b4f4523837959ad5"><div class="ttname"><a href="includes_2upgrade_8php.html#a547d60672205f0f6b4f4523837959ad5">upgrade_372</a></div><div class="ttdeci">upgrade_372()</div><div class="ttdoc">Execute changes made in WordPress 3.7.2. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01483">includes/upgrade.php:1483</a></div></div>
<div class="ttc" id="wp-includes_2taxonomy_8php_html_ad28d62c01fc8952379351022b765987e"><div class="ttname"><a href="wp-includes_2taxonomy_8php.html#ad28d62c01fc8952379351022b765987e">wp_delete_term</a></div><div class="ttdeci">wp_delete_term($term, $taxonomy, $args=array())</div><div class="ttdoc">Removes a term from the database. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2taxonomy_8php_source.html#l02139">wp-includes/taxonomy.php:2139</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a4196a0788a22c00429b67df81d3db465"><div class="ttname"><a href="includes_2upgrade_8php.html#a4196a0788a22c00429b67df81d3db465">upgrade_431</a></div><div class="ttdeci">upgrade_431()</div><div class="ttdoc">Executes changes made in WordPress 4.3.1. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01631">includes/upgrade.php:1631</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_a414887490e946c7f6459d886b09e0e5a"><div class="ttname"><a href="wp-includes_2user_8php.html#a414887490e946c7f6459d886b09e0e5a">update_user_meta</a></div><div class="ttdeci">update_user_meta($user_id, $meta_key, $meta_value, $prev_value= '')</div><div class="ttdoc">Update user meta field based on user ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l00724">wp-includes/user.php:724</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aef14f769511df2c27368d9f7df68eaa4"><div class="ttname"><a href="includes_2upgrade_8php.html#aef14f769511df2c27368d9f7df68eaa4">add_clean_index</a></div><div class="ttdeci">add_clean_index($table, $index)</div><div class="ttdoc">Adds an index to a specified table. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01902">includes/upgrade.php:1902</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aabe08bc33812c096cbe094c1fa7c95ef"><div class="ttname"><a href="includes_2upgrade_8php.html#aabe08bc33812c096cbe094c1fa7c95ef">make_site_theme</a></div><div class="ttdeci">make_site_theme()</div><div class="ttdoc">Creates a site theme. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02530">includes/upgrade.php:2530</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aa1681e2b2e9fc1c0ebaa20a05c278067"><div class="ttname"><a href="includes_2upgrade_8php.html#aa1681e2b2e9fc1c0ebaa20a05c278067">upgrade_130</a></div><div class="ttdeci">upgrade_130()</div><div class="ttdoc">Execute changes made in WordPress 1.5. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00714">includes/upgrade.php:714</a></div></div>
<div class="ttc" id="namespacelist_html"><div class="ttname"><a href="namespacelist.html">list</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_af35f0dd4765f8bcd73a00866b270d6c5"><div class="ttname"><a href="includes_2upgrade_8php.html#af35f0dd4765f8bcd73a00866b270d6c5">upgrade_380</a></div><div class="ttdeci">upgrade_380()</div><div class="ttdoc">Execute changes made in WordPress 3.8.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01497">includes/upgrade.php:1497</a></div></div>
<div class="ttc" id="cron_8php_html_ae54ce0a72e466757f23228d3ef1d0d6f"><div class="ttname"><a href="cron_8php.html#ae54ce0a72e466757f23228d3ef1d0d6f">_set_cron_array</a></div><div class="ttdeci">_set_cron_array($cron)</div><div class="ttdoc">Updates the CRON option with the new CRON array. </div><div class="ttdef"><b>Definition:</b> <a href="cron_8php_source.html#l00462">cron.php:462</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ae0eef4b08c5be1d2a8d3cb9a4103d96a"><div class="ttname"><a href="includes_2upgrade_8php.html#ae0eef4b08c5be1d2a8d3cb9a4103d96a">maybe_convert_table_to_utf8mb4</a></div><div class="ttdeci">maybe_convert_table_to_utf8mb4($table)</div><div class="ttdoc">If a table only contains utf8 or utf8mb4 columns, convert it to utf8mb4. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01951">includes/upgrade.php:1951</a></div></div>
<div class="ttc" id="wp-includes_2taxonomy_8php_html_a35e551b4e66f77cb9f0e8c060d120e5a"><div class="ttname"><a href="wp-includes_2taxonomy_8php.html#a35e551b4e66f77cb9f0e8c060d120e5a">get_term_by</a></div><div class="ttdeci">get_term_by($field, $value, $taxonomy= '', $output=OBJECT, $filter= 'raw')</div><div class="ttdoc">Get all Term data from database by Term field and data. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2taxonomy_8php_source.html#l00901">wp-includes/taxonomy.php:901</a></div></div>
<div class="ttc" id="general-template_8php_html_ac3a568d96fe29ca2a8aefd1d016abd0b"><div class="ttname"><a href="general-template_8php.html#ac3a568d96fe29ca2a8aefd1d016abd0b">wp_login_url</a></div><div class="ttdeci">wp_login_url($redirect= '', $force_reauth=false)</div><div class="ttdoc">Returns the URL that allows the user to log in to the site. </div><div class="ttdef"><b>Definition:</b> <a href="general-template_8php_source.html#l00334">general-template.php:334</a></div></div>
<div class="ttc" id="wp-content_2themes_2twentyeleven_2sidebar_8php_html_a011800c63ece4cbbfa77136a20607023"><div class="ttname"><a href="wp-content_2themes_2twentyeleven_2sidebar_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a></div><div class="ttdeci">$options</div><div class="ttdef"><b>Definition:</b> <a href="wp-content_2themes_2twentyeleven_2sidebar_8php_source.html#l00010">wp-content/themes/twentyeleven/sidebar.php:10</a></div></div>
<div class="ttc" id="admin-ajax_8php_html_a7e2b5c5f59b53e18d1dc6bf6ff251ed2"><div class="ttname"><a href="admin-ajax_8php.html#a7e2b5c5f59b53e18d1dc6bf6ff251ed2">str_replace</a></div><div class="ttdeci">if(!empty($_GET['action'])&amp;&amp;in_array($_GET['action'], $core_actions_get)) add_action( 'wp_ajax_'.$_GET['action'] str_replace( '-', '_', $_GET['action'])</div><div class="ttdef"><b>Definition:</b> <a href="admin-ajax_8php_source.html#l00073">admin-ajax.php:73</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a5ac8d9eefeeb2ac8b45650a335971b81"><div class="ttname"><a href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a></div><div class="ttdeci">get_post_meta($post_id, $key= '', $single=false)</div><div class="ttdoc">Retrieve post meta field for a post. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l01711">wp-includes/post.php:1711</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ac900ebb6c033deed947b02120cea6f98"><div class="ttname"><a href="includes_2upgrade_8php.html#ac900ebb6c033deed947b02120cea6f98">maybe_create_table</a></div><div class="ttdeci">maybe_create_table($table_name, $create_ddl)</div><div class="ttdoc">Creates a table in the database if it doesn&#39;t already exist. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01849">includes/upgrade.php:1849</a></div></div>
<div class="ttc" id="template-loader_8php_html_a688dc4a465f5951bf1ec3713ecf761f7"><div class="ttname"><a href="template-loader_8php.html#a688dc4a465f5951bf1ec3713ecf761f7">$template</a></div><div class="ttdeci">elseif(is_embed()) $template</div><div class="ttdoc">Filter the template used for embedded posts. </div><div class="ttdef"><b>Definition:</b> <a href="template-loader_8php_source.html#l00052">template-loader.php:52</a></div></div>
<div class="ttc" id="wp-admin_2install_8php_html_a2ba769a382a3db95c4fc25db4b242429"><div class="ttname"><a href="wp-admin_2install_8php.html#a2ba769a382a3db95c4fc25db4b242429">$language</a></div><div class="ttdeci">if(!$mysql_compat||!$php_compat) if(!is_string($wpdb-&gt;base_prefix)|| ''===$wpdb-&gt;base_prefix) if(defined( 'DO_NOT_UPGRADE_GLOBAL_TABLES')) $language</div><div class="ttdoc">string $wp_local_package  WP_Locale $wp_locale </div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2install_8php_source.html#l00257">wp-admin/install.php:257</a></div></div>
<div class="ttc" id="search-field-multiselect_8php_html_a672d9707ef91db026c210f98cc601123"><div class="ttname"><a href="search-field-multiselect_8php.html#a672d9707ef91db026c210f98cc601123">endforeach</a></div><div class="ttdeci">endforeach</div><div class="ttdef"><b>Definition:</b> <a href="search-field-multiselect_8php_source.html#l00028">search-field-multiselect.php:28</a></div></div>
<div class="ttc" id="select-template_8php_html_ac68a0d7fea5ecfec9da99f4464af104e"><div class="ttname"><a href="select-template_8php.html#ac68a0d7fea5ecfec9da99f4464af104e">$current_template</a></div><div class="ttdeci">$current_template</div><div class="ttdef"><b>Definition:</b> <a href="select-template_8php_source.html#l00015">select-template.php:15</a></div></div>
<div class="ttc" id="options-general_8php_html_af1d5ccdee975b8f4d20aaffc5b28557c"><div class="ttname"><a href="options-general_8php.html#af1d5ccdee975b8f4d20aaffc5b28557c">$now</a></div><div class="ttdeci">$now</div><div class="ttdef"><b>Definition:</b> <a href="options-general_8php_source.html#l00174">options-general.php:174</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ac825208abc4b5cca86e38718afadebe1"><div class="ttname"><a href="includes_2upgrade_8php.html#ac825208abc4b5cca86e38718afadebe1">upgrade_440</a></div><div class="ttdeci">upgrade_440()</div><div class="ttdoc">Executes changes made in WordPress 4.4.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01649">includes/upgrade.php:1649</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a5b4be04ded870faab3352e69cb616b04"><div class="ttname"><a href="includes_2upgrade_8php.html#a5b4be04ded870faab3352e69cb616b04">upgrade_300</a></div><div class="ttdeci">upgrade_300()</div><div class="ttdoc">Execute changes made in WordPress 3.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01280">includes/upgrade.php:1280</a></div></div>
<div class="ttc" id="link-template_8php_html_a3f2ddf18359777959ef1230ebdd5132c"><div class="ttname"><a href="link-template_8php.html#a3f2ddf18359777959ef1230ebdd5132c">network_home_url</a></div><div class="ttdeci">network_home_url($path= '', $scheme=null)</div><div class="ttdoc">Retrieves the home url for the current network. </div><div class="ttdef"><b>Definition:</b> <a href="link-template_8php_source.html#l03265">link-template.php:3265</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a608a82c55bc57d0bc9b34888b92212e1"><div class="ttname"><a href="wp-includes_2post_8php.html#a608a82c55bc57d0bc9b34888b92212e1">get_post_types</a></div><div class="ttdeci">get_post_types($args=array(), $output= 'names', $operator= 'and')</div><div class="ttdoc">Get a list of all registered post type objects. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00870">wp-includes/post.php:870</a></div></div>
<div class="ttc" id="ms-delete-site_8php_html_a598ca4e71b15a1313ec95f0df1027ca5"><div class="ttname"><a href="ms-delete-site_8php.html#a598ca4e71b15a1313ec95f0df1027ca5">$user</a></div><div class="ttdeci">$user</div><div class="ttdef"><b>Definition:</b> <a href="ms-delete-site_8php_source.html#l00028">ms-delete-site.php:28</a></div></div>
<div class="ttc" id="ms-functions_8php_html_a7a458e0f14af3efce48fb42d7ff4d6d9"><div class="ttname"><a href="ms-functions_8php.html#a7a458e0f14af3efce48fb42d7ff4d6d9">get_current_site</a></div><div class="ttdeci">get_current_site()</div><div class="ttdoc">Get the current network. </div><div class="ttdef"><b>Definition:</b> <a href="ms-functions_8php_source.html#l01597">ms-functions.php:1597</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aadfa550ecd8c271a4106e8572267a667"><div class="ttname"><a href="includes_2upgrade_8php.html#aadfa550ecd8c271a4106e8572267a667">upgrade_400</a></div><div class="ttdeci">upgrade_400()</div><div class="ttdoc">Execute changes made in WordPress 4.0.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01512">includes/upgrade.php:1512</a></div></div>
<div class="ttc" id="wp-load_8php_html_a4071d2e3a68d8bf5d122d5080372b09e"><div class="ttname"><a href="wp-load_8php.html#a4071d2e3a68d8bf5d122d5080372b09e">WP_CONTENT_DIR</a></div><div class="ttdeci">const WP_CONTENT_DIR(false===strpos($_SERVER['REQUEST_URI'], 'setup-config'))</div><div class="ttdef"><b>Definition:</b> <a href="wp-load_8php_source.html#l00068">wp-load.php:68</a></div></div>
<div class="ttc" id="search-field-date__range_8php_html_a1334d61bbc340f973c09c7031f3c21f2"><div class="ttname"><a href="search-field-date__range_8php.html#a1334d61bbc340f973c09c7031f3c21f2">$value</a></div><div class="ttdeci">$value</div><div class="ttdef"><b>Definition:</b> <a href="search-field-date__range_8php_source.html#l00010">search-field-date_range.php:10</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a4af9a7ccd99686b9d07aa3e0aa9e2444"><div class="ttname"><a href="includes_2upgrade_8php.html#a4af9a7ccd99686b9d07aa3e0aa9e2444">maybe_add_column</a></div><div class="ttdeci">maybe_add_column($table_name, $column_name, $create_ddl)</div><div class="ttdoc">Adds column to a database table if it doesn&#39;t already exist. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01921">includes/upgrade.php:1921</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ac5fd71d697cebc747e03eb3f7159bb75"><div class="ttname"><a href="includes_2upgrade_8php.html#ac5fd71d697cebc747e03eb3f7159bb75">upgrade_all</a></div><div class="ttdeci">upgrade_all()</div><div class="ttdoc">Functions to be called in install and upgrade scripts. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00456">includes/upgrade.php:456</a></div></div>
<div class="ttc" id="schema_8php_html_afce90368b01f472eb9bb1985ad8bf516"><div class="ttname"><a href="schema_8php.html#afce90368b01f472eb9bb1985ad8bf516">populate_roles_250</a></div><div class="ttdeci">populate_roles_250()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 2.5. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00799">schema.php:799</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_adb3f1e7966cc172decd9b3f6d84d82b5"><div class="ttname"><a href="includes_2upgrade_8php.html#adb3f1e7966cc172decd9b3f6d84d82b5">make_db_current_silent</a></div><div class="ttdeci">make_db_current_silent($tables= 'all')</div><div class="ttdoc">Updates the database tables to a new schema, but without displaying results. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02369">includes/upgrade.php:2369</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a63e624fc4a828d92c8322a071e395e9d"><div class="ttname"><a href="includes_2upgrade_8php.html#a63e624fc4a828d92c8322a071e395e9d">upgrade_430_fix_comments</a></div><div class="ttdeci">upgrade_430_fix_comments()</div><div class="ttdoc">Executes comments changes made in WordPress 4.3.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01584">includes/upgrade.php:1584</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a27bc17575990d42ea587d1473b2344a5"><div class="ttname"><a href="includes_2upgrade_8php.html#a27bc17575990d42ea587d1473b2344a5">upgrade_230_old_tables</a></div><div class="ttdeci">upgrade_230_old_tables()</div><div class="ttdoc">Remove old categories, link2cat, and post2cat database tables. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01133">includes/upgrade.php:1133</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a657edc069a4c61d359944a04164a7ee3"><div class="ttname"><a href="includes_2upgrade_8php.html#a657edc069a4c61d359944a04164a7ee3">upgrade_290</a></div><div class="ttdeci">upgrade_290()</div><div class="ttdoc">Execute changes made in WordPress 2.9. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01259">includes/upgrade.php:1259</a></div></div>
<div class="ttc" id="options-permalink_8php_html_a642d4aa9cec81e63ddf673048f68132d"><div class="ttname"><a href="options-permalink_8php.html#a642d4aa9cec81e63ddf673048f68132d">date</a></div><div class="ttdeci">hence the name permalink&lt;/p &gt;&lt; p &gt; This screen allows you to choose your permalink structure You can choose from common settings or create custom URL structures&lt;/p &gt;&lt; p &gt; You must click the Save Changes button at the bottom of the screen for new settings to take effect&lt;/p &gt; id permalink settings title Permalink Settings content&lt; p &gt; Permalinks can contain useful such as the post date</div><div class="ttdef"><b>Definition:</b> <a href="options-permalink_8php_source.html#l00029">options-permalink.php:29</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_af56ce4c5410aedf5dda37e798124b74a"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#af56ce4c5410aedf5dda37e798124b74a">is_main_site</a></div><div class="ttdeci">is_main_site($site_id=null)</div><div class="ttdoc">Determine whether a site is the main site of the current network. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l04086">wordpress/wp-includes/functions.php:4086</a></div></div>
<div class="ttc" id="search-field-date__range_8php_html_ab2fc40d43824ea3e1ce5d86dee0d763b"><div class="ttname"><a href="search-field-date__range_8php.html#ab2fc40d43824ea3e1ce5d86dee0d763b">$name</a></div><div class="ttdeci">$name</div><div class="ttdef"><b>Definition:</b> <a href="search-field-date__range_8php_source.html#l00012">search-field-date_range.php:12</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a8de9897e7cf8de14bb1d857f63d7eb31"><div class="ttname"><a href="includes_2upgrade_8php.html#a8de9897e7cf8de14bb1d857f63d7eb31">upgrade_250</a></div><div class="ttdeci">upgrade_250()</div><div class="ttdoc">Execute changes made in WordPress 2.5.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01162">includes/upgrade.php:1162</a></div></div>
<div class="ttc" id="schema_8php_html_abcd0383676547c96be6f8bf8208cc545"><div class="ttname"><a href="schema_8php.html#abcd0383676547c96be6f8bf8208cc545">populate_options</a></div><div class="ttdeci">populate_options()</div><div class="ttdoc">Create WordPress options and set the default values. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00353">schema.php:353</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ad54b23bafca162f7b1d8ee3536826a1e"><div class="ttname"><a href="includes_2upgrade_8php.html#ad54b23bafca162f7b1d8ee3536826a1e">upgrade_450</a></div><div class="ttdeci">upgrade_450()</div><div class="ttdoc">Execute changes made in WordPress 4.5.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01673">includes/upgrade.php:1673</a></div></div>
<div class="ttc" id="formatting_8php_html_ac6495c47468fb816d78bb2d2b326d808"><div class="ttname"><a href="formatting_8php.html#ac6495c47468fb816d78bb2d2b326d808">sanitize_title</a></div><div class="ttdeci">sanitize_title($title, $fallback_title= '', $context= 'save')</div><div class="ttdoc">Sanitizes a title, or returns a fallback title. </div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l01520">formatting.php:1520</a></div></div>
<div class="ttc" id="option_8php_html_a7ffd65e258601322158dc39ee84b3121"><div class="ttname"><a href="option_8php.html#a7ffd65e258601322158dc39ee84b3121">update_site_option</a></div><div class="ttdeci">update_site_option($option, $value)</div><div class="ttdoc">Update the value of an option that was already added for the current network. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l01057">option.php:1057</a></div></div>
<div class="ttc" id="custom_8php_html_ab2cfd183a13283e6ee22f33f2713eac9"><div class="ttname"><a href="custom_8php.html#ab2cfd183a13283e6ee22f33f2713eac9">$content</a></div><div class="ttdeci">if(empty($field_settings['content'])) $content</div><div class="ttdef"><b>Definition:</b> <a href="custom_8php_source.html#l00037">custom.php:37</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a20411a224efbd955877d438c9bec9807"><div class="ttname"><a href="includes_2upgrade_8php.html#a20411a224efbd955877d438c9bec9807">wp_should_upgrade_global_tables</a></div><div class="ttdeci">wp_should_upgrade_global_tables()</div><div class="ttdoc">Determine if global tables should be upgraded. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02753">includes/upgrade.php:2753</a></div></div>
<div class="ttc" id="option_8php_html_a21f59332d7b293dca17bccd56c8c00eb"><div class="ttname"><a href="option_8php.html#a21f59332d7b293dca17bccd56c8c00eb">update_option</a></div><div class="ttdeci">update_option($option, $value, $autoload=null)</div><div class="ttdoc">Update the value of an option that was already added. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00253">option.php:253</a></div></div>
<div class="ttc" id="wp-content_2themes_2twentythirteen_2image_8php_html_a0415589279e7ed8917f2705200abea29"><div class="ttname"><a href="wp-content_2themes_2twentythirteen_2image_8php.html#a0415589279e7ed8917f2705200abea29">$post_title</a></div><div class="ttdeci">$post_title</div><div class="ttdef"><b>Definition:</b> <a href="wp-content_2themes_2twentythirteen_2image_8php_source.html#l00029">wp-content/themes/twentythirteen/image.php:29</a></div></div>
<div class="ttc" id="load_8php_html_a72e5386fcd7a5ce7526d208d0b03a0af"><div class="ttname"><a href="load_8php.html#a72e5386fcd7a5ce7526d208d0b03a0af">is_multisite</a></div><div class="ttdeci">is_multisite()</div><div class="ttdoc">If Multisite is enabled. </div><div class="ttdef"><b>Definition:</b> <a href="load_8php_source.html#l00753">load.php:753</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_af5d2c7b121d8c5a2936b991c31739be7"><div class="ttname"><a href="includes_2upgrade_8php.html#af5d2c7b121d8c5a2936b991c31739be7">upgrade_old_slugs</a></div><div class="ttdeci">upgrade_old_slugs()</div><div class="ttdoc">Upgrade old slugs made in version 2.2. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01148">includes/upgrade.php:1148</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2http_8php_html_a620a87b24dd30feca1f786b6dbd24b24"><div class="ttname"><a href="wordpress_2wp-includes_2http_8php.html#a620a87b24dd30feca1f786b6dbd24b24">wp_remote_get</a></div><div class="ttdeci">wp_remote_get($url, $args=array())</div><div class="ttdoc">Retrieve the raw response from the HTTP request using the GET method. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2http_8php_source.html#l00168">wordpress/wp-includes/http.php:168</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aab67ca7d2045305d3847acdc086ffae3"><div class="ttname"><a href="includes_2upgrade_8php.html#aab67ca7d2045305d3847acdc086ffae3">upgrade_210</a></div><div class="ttdeci">upgrade_210()</div><div class="ttdoc">Execute changes made in WordPress 2.1. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00889">includes/upgrade.php:889</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a368ab1a3cf990a5d56d850ebf43134e3"><div class="ttname"><a href="includes_2upgrade_8php.html#a368ab1a3cf990a5d56d850ebf43134e3">upgrade_270</a></div><div class="ttdeci">upgrade_270()</div><div class="ttdoc">Execute changes made in WordPress 2.7. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01209">includes/upgrade.php:1209</a></div></div>
<div class="ttc" id="twentyfifteen_2content-link_8php_html_a4a6fb8865e1ae52faa29662b4087e629"><div class="ttname"><a href="twentyfifteen_2content-link_8php.html#a4a6fb8865e1ae52faa29662b4087e629">esc_url</a></div><div class="ttdeci">else esc_url(twentyfifteen_get_link_url()))</div><div class="ttdef"><b>Definition:</b> <a href="twentyfifteen_2content-link_8php_source.html#l00021">twentyfifteen/content-link.php:21</a></div></div>
<div class="ttc" id="capabilities_8php_html_a8c86f267da09c8b69f85e8a53614bd06"><div class="ttname"><a href="capabilities_8php.html#a8c86f267da09c8b69f85e8a53614bd06">wp_roles</a></div><div class="ttdeci">wp_roles()</div><div class="ttdoc">Retrieves the global WP_Roles instance and instantiates it if necessary. </div><div class="ttdef"><b>Definition:</b> <a href="capabilities_8php_source.html#l00523">capabilities.php:523</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_aa859bd62ab97dad7bd85ed1a968fd996"><div class="ttname"><a href="wp-includes_2user_8php.html#aa859bd62ab97dad7bd85ed1a968fd996">wp_create_user</a></div><div class="ttdeci">wp_create_user($username, $password, $email= '')</div><div class="ttdoc">A simpler way of inserting a user into the database. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l01840">wp-includes/user.php:1840</a></div></div>
<div class="ttc" id="version_8php_html_a54d5b26d7b1ffa70fc22506a2cfedfea"><div class="ttname"><a href="version_8php.html#a54d5b26d7b1ffa70fc22506a2cfedfea">$wp_db_version</a></div><div class="ttdeci">$wp_db_version</div><div class="ttdoc">Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema...</div><div class="ttdef"><b>Definition:</b> <a href="version_8php_source.html#l00014">version.php:14</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a149ec7eac4fec633411ed814e4e43132"><div class="ttname"><a href="includes_2upgrade_8php.html#a149ec7eac4fec633411ed814e4e43132">upgrade_420</a></div><div class="ttdeci">upgrade_420()</div><div class="ttdoc">Execute changes made in WordPress 4.2.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01534">includes/upgrade.php:1534</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a149a4a6a39985eeb606346e7569b1a4e"><div class="ttname"><a href="includes_2upgrade_8php.html#a149a4a6a39985eeb606346e7569b1a4e">upgrade_370</a></div><div class="ttdeci">upgrade_370()</div><div class="ttdoc">Execute changes made in WordPress 3.7. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01468">includes/upgrade.php:1468</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ab30e0db0ffe1bede090b8e6b8f116db9"><div class="ttname"><a href="includes_2upgrade_8php.html#ab30e0db0ffe1bede090b8e6b8f116db9">upgrade_network</a></div><div class="ttdeci">upgrade_network()</div><div class="ttdoc">Executes network-level upgrade routines. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01687">includes/upgrade.php:1687</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a8bbabcdc52ae172d75e457cab5aed16b"><div class="ttname"><a href="includes_2upgrade_8php.html#a8bbabcdc52ae172d75e457cab5aed16b">upgrade_230_options_table</a></div><div class="ttdeci">upgrade_230_options_table()</div><div class="ttdoc">Remove old options from the database. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01116">includes/upgrade.php:1116</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a718607ec4fb72257807ec66ae24b503e"><div class="ttname"><a href="includes_2upgrade_8php.html#a718607ec4fb72257807ec66ae24b503e">upgrade_340</a></div><div class="ttdeci">upgrade_340()</div><div class="ttdoc">Execute changes made in WordPress 3.4. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01401">includes/upgrade.php:1401</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a6e6d4fb5df8f86dc0aafa740bf1dfe60"><div class="ttname"><a href="includes_2upgrade_8php.html#a6e6d4fb5df8f86dc0aafa740bf1dfe60">upgrade_101</a></div><div class="ttdeci">upgrade_101()</div><div class="ttdoc">Execute changes made in WordPress 1.0.1. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00630">includes/upgrade.php:630</a></div></div>
<div class="ttc" id="schema_8php_html_a9e635badc4aab288965ee64bd2a8a607"><div class="ttname"><a href="schema_8php.html#a9e635badc4aab288965ee64bd2a8a607">populate_roles_280</a></div><div class="ttdeci">populate_roles_280()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 2.8. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00840">schema.php:840</a></div></div>
<div class="ttc" id="noop_8php_html_a371846605f59defff0f8d8ef2bf0cc06"><div class="ttname"><a href="noop_8php.html#a371846605f59defff0f8d8ef2bf0cc06">wp_guess_url</a></div><div class="ttdeci">wp_guess_url()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00086">noop.php:86</a></div></div>
<div class="ttc" id="wp-includes_2widgets_8php_html_a0696ef1f645f9f4ab0b6b67023d21bba"><div class="ttname"><a href="wp-includes_2widgets_8php.html#a0696ef1f645f9f4ab0b6b67023d21bba">retrieve_widgets</a></div><div class="ttdeci">retrieve_widgets($theme_changed=false)</div><div class="ttdoc">Look for "lost" widgets, this has to run at least on each theme change. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2widgets_8php_source.html#l01112">wp-includes/widgets.php:1112</a></div></div>
<div class="ttc" id="schema_8php_html_a69d44db5129b85c08fa02666649039b1"><div class="ttname"><a href="schema_8php.html#a69d44db5129b85c08fa02666649039b1">wp_get_db_schema</a></div><div class="ttdeci">wp_get_db_schema($scope= 'all', $blog_id=null)</div><div class="ttdoc">Retrieve the SQL for creating database tables. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00036">schema.php:36</a></div></div>
<div class="ttc" id="options-permalink_8php_html_a1b46ea8949d396a93da5d6e63bdae52c"><div class="ttname"><a href="options-permalink_8php.html#a1b46ea8949d396a93da5d6e63bdae52c">$permalink_structure</a></div><div class="ttdeci">$permalink_structure</div><div class="ttdef"><b>Definition:</b> <a href="options-permalink_8php_source.html#l00053">options-permalink.php:53</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_afe18c72dcd93806bfefc8bde68fccd8a"><div class="ttname"><a href="includes_2upgrade_8php.html#afe18c72dcd93806bfefc8bde68fccd8a">upgrade_110</a></div><div class="ttdeci">upgrade_110()</div><div class="ttdoc">Execute changes made in WordPress 1.2. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00651">includes/upgrade.php:651</a></div></div>
<div class="ttc" id="wp-includes_2user_8php_html_a51c82c9257936dea066761047d2dddba"><div class="ttname"><a href="wp-includes_2user_8php.html#a51c82c9257936dea066761047d2dddba">update_user_option</a></div><div class="ttdeci">update_user_option($user_id, $option_name, $newvalue, $global=false)</div><div class="ttdoc">Update user option with global blog capability. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2user_8php_source.html#l00432">wp-includes/user.php:432</a></div></div>
<div class="ttc" id="wp-admin_2includes_2plugin_8php_html_a10a4cc7247cf0cb722062baf35784b8a"><div class="ttname"><a href="wp-admin_2includes_2plugin_8php.html#a10a4cc7247cf0cb722062baf35784b8a">deactivate_plugins</a></div><div class="ttdeci">deactivate_plugins($plugins, $silent=false, $network_wide=null)</div><div class="ttdoc">Deactivate a single plugin or multiple plugins. </div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2includes_2plugin_8php_source.html#l00628">wp-admin/includes/plugin.php:628</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_a46b3622ccc6d393dfd97e355b7bd0bd6"><div class="ttname"><a href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a></div><div class="ttdeci">if(current_theme_supports( 'post-formats')&amp;&amp;post_type_supports($post_type, 'post-formats')) add_meta_box( 'formatdiv' null</div><div class="ttdoc">When displaying the single entry we should always know to which View it belongs (the context is every...</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00244">edit-form-advanced.php:244</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_abf17cb2dba2ed17cb28aa5f37deb5293"><div class="ttname"><a href="edit-form-advanced_8php.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a></div><div class="ttdeci">$message</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00174">edit-form-advanced.php:174</a></div></div>
<div class="ttc" id="select-template_8php_html_a77c8faa27a630e0cfbe0fa5507c1a538"><div class="ttname"><a href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a></div><div class="ttdeci">global $post</div><div class="ttdef"><b>Definition:</b> <a href="select-template_8php_source.html#l00009">select-template.php:9</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aa067f5e7c95f1f875412140fc6c3b0c6"><div class="ttname"><a href="includes_2upgrade_8php.html#aa067f5e7c95f1f875412140fc6c3b0c6">upgrade_252</a></div><div class="ttdeci">upgrade_252()</div><div class="ttdoc">Execute changes made in WordPress 2.5.2. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01179">includes/upgrade.php:1179</a></div></div>
<div class="ttc" id="options-permalink_8php_html_ae6a00c5418f0bef00d8fc6e3eab08037"><div class="ttname"><a href="options-permalink_8php.html#ae6a00c5418f0bef00d8fc6e3eab08037">$home_path</a></div><div class="ttdeci">$home_path</div><div class="ttdef"><b>Definition:</b> <a href="options-permalink_8php_source.html#l00051">options-permalink.php:51</a></div></div>
<div class="ttc" id="noop_8php_html_a01815a0502df2442bbb063f4055c2194"><div class="ttname"><a href="noop_8php.html#a01815a0502df2442bbb063f4055c2194">admin_url</a></div><div class="ttdeci">admin_url()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00071">noop.php:71</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a1fb4ce36d884c19a927a8f6d0c9128a3"><div class="ttname"><a href="includes_2upgrade_8php.html#a1fb4ce36d884c19a927a8f6d0c9128a3">maybe_disable_automattic_widgets</a></div><div class="ttdeci">maybe_disable_automattic_widgets()</div><div class="ttdoc">Disables the Automattic widgets plugin, which was merged into core. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02619">includes/upgrade.php:2619</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a803e9c6735f71e763ab18bd8bdc630ab"><div class="ttname"><a href="includes_2upgrade_8php.html#a803e9c6735f71e763ab18bd8bdc630ab">drop_index</a></div><div class="ttdeci">drop_index($table, $index)</div><div class="ttdoc">Drops a specified index from a table. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01879">includes/upgrade.php:1879</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_aaabb0089dc684c60f65958a5cd928908"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#aaabb0089dc684c60f65958a5cd928908">is_blog_installed</a></div><div class="ttdeci">is_blog_installed()</div><div class="ttdoc">Test whether blog is already installed. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l01351">wordpress/wp-includes/functions.php:1351</a></div></div>
<div class="ttc" id="namespacefile_html"><div class="ttname"><a href="namespacefile.html">file</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ae2592de93ead8b5ad27d0c4881f04d4c"><div class="ttname"><a href="includes_2upgrade_8php.html#ae2592de93ead8b5ad27d0c4881f04d4c">upgrade_230</a></div><div class="ttdeci">upgrade_230()</div><div class="ttdoc">Execute changes made in WordPress 2.3. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00937">includes/upgrade.php:937</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_aad8d91e6a86c1c561f1ed66bc19e5a63"><div class="ttname"><a href="includes_2upgrade_8php.html#aad8d91e6a86c1c561f1ed66bc19e5a63">endif</a></div><div class="ttdeci">if(!function_exists('wp_install'))($blog_title, $user_name, $user_email, $public, $deprecated= '', $user_password= '', $language= '') endif</div><div class="ttdoc">WordPress Administration API. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00021">includes/upgrade.php:21</a></div></div>
<div class="ttc" id="namespacephp_html"><div class="ttname"><a href="namespacephp.html">php</a></div></div>
<div class="ttc" id="l10n_8php_html_a3b3d1cf3cd27c9b5225753297028b332"><div class="ttname"><a href="l10n_8php.html#a3b3d1cf3cd27c9b5225753297028b332">get_available_languages</a></div><div class="ttdeci">get_available_languages($dir=null)</div><div class="ttdoc">Get all available languages based on the presence of *.mo files in a given directory. </div><div class="ttdef"><b>Definition:</b> <a href="l10n_8php_source.html#l00849">l10n.php:849</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ab68f6b47e715e99c6e5664a41e4a2333"><div class="ttname"><a href="includes_2upgrade_8php.html#ab68f6b47e715e99c6e5664a41e4a2333">make_db_current</a></div><div class="ttdeci">make_db_current($tables= 'all')</div><div class="ttdoc">Updates the database tables to a new schema. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02350">includes/upgrade.php:2350</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_ac9f9f0f1c15e3c295fbe0eea4fcad01b"><div class="ttname"><a href="includes_2upgrade_8php.html#ac9f9f0f1c15e3c295fbe0eea4fcad01b">upgrade_100</a></div><div class="ttdeci">upgrade_100()</div><div class="ttdoc">Execute changes made in WordPress 1.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00571">includes/upgrade.php:571</a></div></div>
<div class="ttc" id="wp-includes_2widgets_8php_html_a24c1fc3a7e94da5ac9b3846b6d93f2a7"><div class="ttname"><a href="wp-includes_2widgets_8php.html#a24c1fc3a7e94da5ac9b3846b6d93f2a7">$wp_registered_widgets</a></div><div class="ttdeci">global $wp_registered_widgets</div><div class="ttdoc">Stores the registered widgets. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2widgets_8php_source.html#l00026">wp-includes/widgets.php:26</a></div></div>
<div class="ttc" id="option_8php_html_a44451bc2bc382b2c24f4baeef80a3714"><div class="ttname"><a href="option_8php.html#a44451bc2bc382b2c24f4baeef80a3714">delete_option</a></div><div class="ttdeci">delete_option($option)</div><div class="ttdoc">Removes option by name. </div><div class="ttdef"><b>Definition:</b> <a href="option_8php_source.html#l00491">option.php:491</a></div></div>
<div class="ttc" id="schema_8php_html_ad2ea188fe277219078755911b899cf78"><div class="ttname"><a href="schema_8php.html#ad2ea188fe277219078755911b899cf78">populate_roles_210</a></div><div class="ttdeci">populate_roles_210()</div><div class="ttdoc">Create and modify WordPress roles for WordPress 2.1. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00739">schema.php:739</a></div></div>
<div class="ttc" id="wp-includes_2theme_8php_html_ad028eec53a1a467937aedb9b38db9524"><div class="ttname"><a href="wp-includes_2theme_8php.html#ad028eec53a1a467937aedb9b38db9524">wp_get_themes</a></div><div class="ttdeci">wp_get_themes($args=array())</div><div class="ttdoc">Returns an array of WP_Theme objects based on the arguments. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2theme_8php_source.html#l00030">wp-includes/theme.php:30</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a0070e44c50c79d7fd455a3b1ea6f13d9"><div class="ttname"><a href="includes_2upgrade_8php.html#a0070e44c50c79d7fd455a3b1ea6f13d9">upgrade_280</a></div><div class="ttdeci">upgrade_280()</div><div class="ttdoc">Execute changes made in WordPress 2.8. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01229">includes/upgrade.php:1229</a></div></div>
<div class="ttc" id="plugins_8php_html_ada8a7130088351710bb02ed622d6bf65"><div class="ttname"><a href="plugins_8php.html#ada8a7130088351710bb02ed622d6bf65">$plugin</a></div><div class="ttdeci">$plugin</div><div class="ttdef"><b>Definition:</b> <a href="plugins_8php_source.html#l00020">plugins.php:20</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a8d099d53ff8846ac3d0e0ad7069b052b"><div class="ttname"><a href="includes_2upgrade_8php.html#a8d099d53ff8846ac3d0e0ad7069b052b">upgrade_350</a></div><div class="ttdeci">upgrade_350()</div><div class="ttdoc">Execute changes made in WordPress 3.5. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01438">includes/upgrade.php:1438</a></div></div>
<div class="ttc" id="schema_8php_html_aaac3ddf81d405fac59e1dceeca05b0a7"><div class="ttname"><a href="schema_8php.html#aaac3ddf81d405fac59e1dceeca05b0a7">$wpdb</a></div><div class="ttdeci">global $wpdb</div><div class="ttdoc">Declare these as global in case schema.php is included from a function. </div><div class="ttdef"><b>Definition:</b> <a href="schema_8php_source.html#l00018">schema.php:18</a></div></div>
<div class="ttc" id="class_w_p___user_html"><div class="ttname"><a href="class_w_p___user.html">WP_User</a></div><div class="ttdef"><b>Definition:</b> <a href="class-wp-user_8php_source.html#l00034">class-wp-user.php:34</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a3c69a81464e61cfafd41fc129b6df2d4"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a3c69a81464e61cfafd41fc129b6df2d4">maybe_unserialize</a></div><div class="ttdeci">maybe_unserialize($original)</div><div class="ttdoc">Unserialize value only if it was serialized. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l00322">wordpress/wp-includes/functions.php:322</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a13a6c748f12245d95d2139c388506b62"><div class="ttname"><a href="includes_2upgrade_8php.html#a13a6c748f12245d95d2139c388506b62">wp_install_maybe_enable_pretty_permalinks</a></div><div class="ttdeci">wp_install_maybe_enable_pretty_permalinks()</div><div class="ttdoc">Maybe enable pretty permalinks on install. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00290">includes/upgrade.php:290</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_af7ccbb4fe49b4877219cbdbddecd7f77"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#af7ccbb4fe49b4877219cbdbddecd7f77">mysql2date</a></div><div class="ttdeci">mysql2date($format, $date, $translate=true)</div><div class="ttdoc">Convert given date string into a different format. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l00026">wordpress/wp-includes/functions.php:26</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2http_8php_html_ae46c3829a8339ff06623dc1dcd0fc878"><div class="ttname"><a href="wordpress_2wp-includes_2http_8php.html#ae46c3829a8339ff06623dc1dcd0fc878">wp_remote_retrieve_header</a></div><div class="ttdeci">wp_remote_retrieve_header($response, $header)</div><div class="ttdoc">Retrieve a single header by name from the raw response. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2http_8php_source.html#l00231">wordpress/wp-includes/http.php:231</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a4123a7eed5c3db1e2e471e636e7f4019"><div class="ttname"><a href="includes_2upgrade_8php.html#a4123a7eed5c3db1e2e471e636e7f4019">pre_schema_upgrade</a></div><div class="ttdeci">pre_schema_upgrade()</div><div class="ttdoc">Runs before the schema is upgraded. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l02654">includes/upgrade.php:2654</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_a866e7f0f003101850a78f372dd07bd2a"><div class="ttname"><a href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a></div><div class="ttdeci">if(current_theme_supports( 'post-formats')&amp;&amp;post_type_supports($post_type, 'post-formats')) add_meta_box( 'formatdiv'foreach(get_object_taxonomies($post) as $tax_name) if($thumbnail_support &amp;&amp;current_user_can( 'upload_files')) add_meta_box('postimagediv'if(post_type_supports($post_type, 'excerpt')) add_meta_box('postexcerpt' __('Excerpt')</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00269">edit-form-advanced.php:269</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a3fb25174b5e402c9666da33248094bfe"><div class="ttname"><a href="includes_2upgrade_8php.html#a3fb25174b5e402c9666da33248094bfe">upgrade_160</a></div><div class="ttdeci">upgrade_160()</div><div class="ttdoc">Execute changes made in WordPress 2.0. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l00802">includes/upgrade.php:802</a></div></div>
<div class="ttc" id="wp-tests-config_8php_html_a40d0e1a61d6ee8d066bea2fcfcd2ff6c"><div class="ttname"><a href="wp-tests-config_8php.html#a40d0e1a61d6ee8d066bea2fcfcd2ff6c">WPLANG</a></div><div class="ttdeci">const WPLANG</div><div class="ttdef"><b>Definition:</b> <a href="wp-tests-config_8php_source.html#l00041">wp-tests-config.php:41</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a275458f4feb9c42264630702cb4cd532"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532">_deprecated_argument</a></div><div class="ttdeci">_deprecated_argument($function, $version, $message=null)</div><div class="ttdoc">Mark a function argument as deprecated and inform when it has been used. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l03737">wordpress/wp-includes/functions.php:3737</a></div></div>
<div class="ttc" id="includes_2upgrade_8php_html_a0a23ab0934c3f2e5618f931a4ea4c483"><div class="ttname"><a href="includes_2upgrade_8php.html#a0a23ab0934c3f2e5618f931a4ea4c483">get_alloptions_110</a></div><div class="ttdeci">get_alloptions_110()</div><div class="ttdoc">Retrieve all options as it was for 1.2. </div><div class="ttdef"><b>Definition:</b> <a href="includes_2upgrade_8php_source.html#l01993">includes/upgrade.php:1993</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript">
    jQuery( document ).ready( function( $ ) {
        $( 'a.anchor[id^=_filters],a.anchor[id^=_actions]' ).each( function() {
            $( this )
                .text('#')
                .attr( 'href', function() {
                    return '#' + $( this ).attr( 'id' );
                }).prependTo( $( this ).parent('dt' ).next('dd') );
        });
    });
</script>
</body>
</html>
