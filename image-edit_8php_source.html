<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>GravityView: image-edit.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom-doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GravityView
   &#160;<span id="projectnumber">1.16.1</span>
   </div>
   <div id="projectbrief">Beautifully display your Gravity Forms data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_f202f45fd139109afdc6cee542e9540d.html">tmp</a></li><li class="navelem"><a class="el" href="dir_bab4839c1ebfd97cab4362c92e1efb01.html">wordpress</a></li><li class="navelem"><a class="el" href="dir_6befe1ce5953e76db4cf235d50144e4d.html">wp-admin</a></li><li class="navelem"><a class="el" href="dir_5f7e0c6af6da142503046b2ffe3240cd.html">includes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">image-edit.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="image-edit_8php.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?<a class="code" href="namespacephp.html">php</a><span class="comment"></span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * WordPress Image Editor</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * @package WordPress</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * @subpackage Administration</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * Loads the WP image-editing interface.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * @param int         $post_id Post ID.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * @param bool|object $msg     Optional. Message to display for image editor updates or errors.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *                             Default false.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a4f00df01abc362e365954aaf6397788b">   16</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a4f00df01abc362e365954aaf6397788b">wp_image_editor</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a> = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    $nonce = wp_create_nonce(<span class="stringliteral">&quot;image_editor-$post_id&quot;</span>);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    $meta = <a class="code" href="wp-includes_2post_8php.html#a08a3d66142c2d31d6fdb95b1efac7185">wp_get_attachment_metadata</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    $thumb = <a class="code" href="wp-includes_2media_8php.html#a34f11f36b78c75646f34ee1579ebae3d">image_get_intermediate_size</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;thumbnail&#39;</span>);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    $sub_sizes = isset($meta[<span class="stringliteral">&#39;sizes&#39;</span>]) &amp;&amp; is_array($meta[<span class="stringliteral">&#39;sizes&#39;</span>]);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    $note = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> ( isset( $meta[<span class="stringliteral">&#39;width&#39;</span>], $meta[<span class="stringliteral">&#39;height&#39;</span>] ) )</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        $big = max( $meta[<span class="stringliteral">&#39;width&#39;</span>], $meta[<span class="stringliteral">&#39;height&#39;</span>] );</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        die( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Image data does not exist. Please re-upload the image.&#39;</span>) );</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    $sizer = $big &gt; 400 ? 400 / $big : 1;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    $backup_sizes = <a class="code" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;_wp_attachment_backup_sizes&#39;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    $can_restore = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> ( ! empty( $backup_sizes ) &amp;&amp; isset( $backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>], $meta[<span class="stringliteral">&#39;file&#39;</span>] ) )</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        $can_restore = $backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>] != basename( $meta[<span class="stringliteral">&#39;file&#39;</span>] );</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a> ) {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">if</span> ( isset(<a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>-&gt;error) )</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            $note = <span class="stringliteral">&quot;&lt;div class=&#39;error&#39;&gt;&lt;p&gt;$msg-&gt;error&lt;/p&gt;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( isset(<a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>-&gt;msg) )</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            $note = <span class="stringliteral">&quot;&lt;div class=&#39;updated&#39;&gt;&lt;p&gt;$msg-&gt;msg&lt;/p&gt;&lt;/div&gt;&quot;</span>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    ?&gt;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-wrap wp-clearfix&quot;</span>&gt;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    &lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-panel-&lt;?php echo $post_id; ?&gt;&quot;</span>&gt;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-settings&quot;</span>&gt;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group&quot;</span>&gt;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group-top&quot;</span>&gt;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        &lt;h2&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Scale Image&#39;</span> ); ?&gt;&lt;/h2&gt;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        &lt;<a class="code" href="namespacebutton.html">button</a> <a class="code" href="namespacetype.html">type</a>=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;dashicons dashicons-editor-help imgedit-help-toggle&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.toggleHelp(this);return false;&quot;</span> aria-expanded=<span class="stringliteral">&quot;false&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Scale Image Help&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-help&quot;</span>&gt;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;You can proportionally scale the original image. For best results, scaling should be done before you crop, flip, or rotate. Images can only be scaled down, not up.&#39;</span>); ?&gt;&lt;/<a class="code" href="namespacep.html">p</a>&gt;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <span class="keywordflow">if</span> ( isset( $meta[<span class="stringliteral">&#39;width&#39;</span>], $meta[<span class="stringliteral">&#39;height&#39;</span>] ) ): ?&gt;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> printf( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Original dimensions %s&#39;</span>), $meta[<span class="stringliteral">&#39;width&#39;</span>] . <span class="stringliteral">&#39; &amp;times; &#39;</span> . $meta[<span class="stringliteral">&#39;height&#39;</span>] ); ?&gt;&lt;/<a class="code" href="namespacep.html">p</a>&gt;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="api-core_2wp-includes_2compat_8php.html#a69ce1131cd2c65fd147aa7b1de9ed7ee">endif</a> ?&gt;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-submit&quot;</span>&gt;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        &lt;fieldset <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-scale&quot;</span>&gt;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        &lt;legend&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;New dimensions:&#39;</span> ); ?&gt;&lt;/legend&gt;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;nowrap&quot;</span>&gt;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;scale width&#39;</span> ); ?&gt;&lt;/span&gt;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-scale-width-&lt;?php echo $post_id; ?&gt;&quot;</span> onkeyup=<span class="stringliteral">&quot;imageEdit.scaleChanged(&lt;?php echo $post_id; ?&gt;, 1)&quot;</span> onblur=<span class="stringliteral">&quot;imageEdit.scaleChanged(&lt;?php echo $post_id; ?&gt;, 1)&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo isset( $meta[&#39;width&#39;] ) ? $meta[&#39;width&#39;] : 0; ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        &lt;/<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        &lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-separator&quot;</span>&gt;&amp;times;&lt;/span&gt;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;scale height&#39;</span> ); ?&gt;&lt;/span&gt;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-scale-height-&lt;?php echo $post_id; ?&gt;&quot;</span> onkeyup=<span class="stringliteral">&quot;imageEdit.scaleChanged(&lt;?php echo $post_id; ?&gt;, 0)&quot;</span> onblur=<span class="stringliteral">&quot;imageEdit.scaleChanged(&lt;?php echo $post_id; ?&gt;, 0)&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo isset( $meta[&#39;height&#39;] ) ? $meta[&#39;height&#39;] : 0; ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        &lt;/<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        &lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-scale-warn&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-scale-warn-&lt;?php echo $post_id; ?&gt;&quot;</span>&gt;!&lt;/span&gt;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-scale-button&quot;</span> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.action(&lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, &#39;scale&#39;)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;button button-primary&quot;</span> value=<span class="stringliteral">&quot;&lt;?php esc_attr_e( &#39;Scale&#39; ); ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        &lt;/fieldset&gt;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;&lt;?<a class="code" href="namespacephp.html">php</a> <span class="keywordflow">if</span> ( $can_restore ) { ?&gt;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group&quot;</span>&gt;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group-top&quot;</span>&gt;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        &lt;h2&gt;&lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.toggleHelp(this);&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;button-link&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Restore Original Image&#39;</span> ); ?&gt; &lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;dashicons dashicons-arrow-down imgedit-help-toggle&quot;</span>&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;&lt;/h2&gt;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-help&quot;</span>&gt;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;Discard any changes and restore the original image.&#39;</span>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">if</span> ( !defined(<span class="stringliteral">&#39;IMAGE_EDIT_OVERWRITE&#39;</span>) || !IMAGE_EDIT_OVERWRITE )</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            echo <span class="charliteral">&#39; &#39;</span>.__(<span class="stringliteral">&#39;Previously edited copies of the image will not be deleted.&#39;</span>);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        ?&gt;&lt;/<a class="code" href="namespacep.html">p</a>&gt;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-submit&quot;</span>&gt;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.action(&lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, &#39;restore&#39;)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;button button-primary&quot;</span> value=<span class="stringliteral">&quot;&lt;?php esc_attr_e( &#39;Restore image&#39; ); ?&gt;&quot;</span> &lt;?<a class="code" href="namespacephp.html">php</a> echo $can_restore; ?&gt; /&gt;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;&lt;?<a class="code" href="namespacephp.html">php</a> } ?&gt;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group&quot;</span>&gt;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group-top&quot;</span>&gt;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        &lt;h2&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Image Crop&#39;</span> ); ?&gt;&lt;/h2&gt;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;dashicons dashicons-editor-help imgedit-help-toggle&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.toggleHelp(this);return false;&quot;</span> aria-expanded=<span class="stringliteral">&quot;false&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Image Crop Help&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-help&quot;</span>&gt;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;To crop the image, click on it and drag to make your selection.&#39;</span>); ?&gt;&lt;/<a class="code" href="namespacep.html">p</a>&gt;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a>&gt;&lt;<a class="code" href="namespacestrong.html">strong</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;Crop Aspect Ratio&#39;</span>); ?&gt;&lt;/<a class="code" href="namespacestrong.html">strong</a>&gt;&lt;br /&gt;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;The aspect ratio is the relationship between the width and height. You can preserve the aspect ratio by holding down the shift key while resizing your selection. Use the input box to specify the aspect ratio, e.g. 1:1 (square), 4:3, 16:9, etc.&#39;</span>); ?&gt;&lt;/<a class="code" href="namespacep.html">p</a>&gt;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a>&gt;&lt;<a class="code" href="namespacestrong.html">strong</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;Crop Selection&#39;</span>); ?&gt;&lt;/<a class="code" href="namespacestrong.html">strong</a>&gt;&lt;br /&gt;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;Once you have made your selection, you can adjust it by entering the size in pixels. The minimum selection size is the thumbnail size as set in the Media settings.&#39;</span>); ?&gt;&lt;/<a class="code" href="namespacep.html">p</a>&gt;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    &lt;fieldset <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-crop-ratio&quot;</span>&gt;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        &lt;legend&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Aspect ratio:&#39;</span> ); ?&gt;&lt;/legend&gt;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;nowrap&quot;</span>&gt;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;crop ratio width&#39;</span> ); ?&gt;&lt;/span&gt;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-crop-width-&lt;?php echo $post_id; ?&gt;&quot;</span> onkeyup=<span class="stringliteral">&quot;imageEdit.setRatioSelection(&lt;?php echo $post_id; ?&gt;, 0, this)&quot;</span> /&gt;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        &lt;/<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        &lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-separator&quot;</span>&gt;:&lt;/span&gt;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;crop ratio height&#39;</span> ); ?&gt;&lt;/span&gt;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-crop-height-&lt;?php echo $post_id; ?&gt;&quot;</span> onkeyup=<span class="stringliteral">&quot;imageEdit.setRatioSelection(&lt;?php echo $post_id; ?&gt;, 1, this)&quot;</span> /&gt;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        &lt;/<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    &lt;/fieldset&gt;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    &lt;fieldset <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-crop-sel-&lt;?php echo $post_id; ?&gt;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-crop-sel&quot;</span>&gt;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        &lt;legend&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Selection:&#39;</span> ); ?&gt;&lt;/legend&gt;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;nowrap&quot;</span>&gt;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;selection width&#39;</span> ); ?&gt;&lt;/span&gt;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-sel-width-&lt;?php echo $post_id; ?&gt;&quot;</span> onkeyup=<span class="stringliteral">&quot;imageEdit.setNumSelection(&lt;?php echo $post_id; ?&gt;)&quot;</span> /&gt;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        &lt;/<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        &lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-separator&quot;</span>&gt;&amp;times;&lt;/span&gt;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;selection height&#39;</span> ); ?&gt;&lt;/span&gt;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;text&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-sel-height-&lt;?php echo $post_id; ?&gt;&quot;</span> onkeyup=<span class="stringliteral">&quot;imageEdit.setNumSelection(&lt;?php echo $post_id; ?&gt;)&quot;</span> /&gt;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        &lt;/<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a>&gt;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    &lt;/fieldset&gt;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    &lt;?<a class="code" href="namespacephp.html">php</a> <span class="keywordflow">if</span> ( $thumb &amp;&amp; $sub_sizes ) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        $thumb_img = <a class="code" href="wp-includes_2media_8php.html#a2bd093b9a01e6da239aef407b25be1f0">wp_constrain_dimensions</a>( $thumb[<span class="stringliteral">&#39;width&#39;</span>], $thumb[<span class="stringliteral">&#39;height&#39;</span>], 160, 120 );</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    ?&gt;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group imgedit-applyto&quot;</span>&gt;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-group-top&quot;</span>&gt;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        &lt;h2&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Thumbnail Settings&#39;</span> ); ?&gt;&lt;/h2&gt;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;dashicons dashicons-editor-help imgedit-help-toggle&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.toggleHelp(this);return false;&quot;</span> aria-expanded=<span class="stringliteral">&quot;false&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Thumbnail Settings Help&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        &lt;<a class="code" href="namespacep.html">p</a> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-help&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;You can edit the image while preserving the thumbnail. For example, you may wish to have a square thumbnail that displays just a section of the image.&#39;</span>); ?&gt;&lt;/p&gt;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    &lt;figure <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-thumbnail-preview&quot;</span>&gt;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        &lt;img src=<span class="stringliteral">&quot;&lt;?php echo $thumb[&#39;url&#39;]; ?&gt;&quot;</span> <a class="code" href="wp-content_2themes_2twentythirteen_2inc_2custom-header_8php.html#ab1b1d44a8c4dbcaeff449be6b5e19935">width</a>=<span class="stringliteral">&quot;&lt;?php echo $thumb_img[0]; ?&gt;&quot;</span> <a class="code" href="wordpress_2wp-content_2themes_2twentyeleven_2functions_8php.html#ad6d040b79093a1652d3e3a0f02172d83">height</a>=<span class="stringliteral">&quot;&lt;?php echo $thumb_img[1]; ?&gt;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-size-preview&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> draggable=<span class="stringliteral">&quot;false&quot;</span> /&gt;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        &lt;figcaption <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-thumbnail-preview-caption&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Current thumbnail&#39;</span> ); ?&gt;&lt;/figcaption&gt;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    &lt;/figure&gt;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    &lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-save-target-&lt;?php echo $post_id; ?&gt;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-save-target&quot;</span>&gt;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    &lt;fieldset&gt;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        &lt;legend&gt;&lt;<a class="code" href="namespacestrong.html">strong</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>( <span class="stringliteral">&#39;Apply changes to:&#39;</span> ); ?&gt;&lt;/<a class="code" href="namespacestrong.html">strong</a>&gt;&lt;/legend&gt;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-label&quot;</span>&gt;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;radio&quot;</span> <a class="code" href="edit-comments_8php.html#a01a5ac2afed3a262528186f4ba5f9693">name</a>=<span class="stringliteral">&quot;imgedit-target-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;all&quot;</span> <a class="code" href="general-template_8php.html#ac5a8cddc08f21085ba0939cda4f64766">checked</a>=<span class="stringliteral">&quot;checked&quot;</span> /&gt;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;All image sizes&#39;</span>); ?&gt;&lt;/label&gt;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        &lt;label <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-label&quot;</span>&gt;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;radio&quot;</span> <a class="code" href="edit-comments_8php.html#a01a5ac2afed3a262528186f4ba5f9693">name</a>=<span class="stringliteral">&quot;imgedit-target-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;thumbnail&quot;</span> /&gt;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;Thumbnail&#39;</span>); ?&gt;&lt;/label&gt;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        &lt;label <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-label&quot;</span>&gt;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;radio&quot;</span> <a class="code" href="edit-comments_8php.html#a01a5ac2afed3a262528186f4ba5f9693">name</a>=<span class="stringliteral">&quot;imgedit-target-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;nothumb&quot;</span> /&gt;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&#39;All sizes except thumbnail&#39;</span>); ?&gt;&lt;/label&gt;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    &lt;/fieldset&gt;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    &lt;?<a class="code" href="namespacephp.html">php</a> } ?&gt;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-panel-content wp-clearfix&quot;</span>&gt;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        &lt;?<a class="code" href="namespacephp.html">php</a> echo $note; ?&gt;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-menu wp-clearfix&quot;</span>&gt;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.crop(&lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-crop button disabled&quot;</span> <a class="code" href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Crop&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;&lt;?<a class="code" href="namespacephp.html">php</a></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// On some setups GD library does not provide imagerotate() - Ticket #11536</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="wp-includes_2media_8php.html#ac48a114db59e74b736a3fc795a62766b">wp_image_editor_supports</a>( array( <span class="stringliteral">&#39;mime_type&#39;</span> =&gt; <a class="code" href="wp-includes_2post_8php.html#a192bddf5a4999057d4330352533ffad1">get_post_mime_type</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> ), <span class="stringliteral">&#39;methods&#39;</span> =&gt; array( <span class="stringliteral">&#39;rotate&#39;</span> ) ) ) ) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            $note_no_rotate = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    ?&gt;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-rleft button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.rotate( 90, &lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Rotate counter-clockwise&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-rright button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.rotate(-90, &lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Rotate clockwise&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    &lt;?<a class="code" href="namespacephp.html">php</a> } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            $note_no_rotate = <span class="stringliteral">&#39;&lt;p class=&quot;note-no-rotate&quot;&gt;&lt;em&gt;&#39;</span> . <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;Image rotation is not supported by your web host.&#39;</span> ) . <span class="stringliteral">&#39;&lt;/em&gt;&lt;/p&gt;&#39;</span>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    ?&gt;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-rleft button disabled&quot;</span> <a class="code" href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a>&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-rright button disabled&quot;</span> <a class="code" href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a>&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    &lt;?<a class="code" href="namespacephp.html">php</a> } ?&gt;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.flip(1, &lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-flipv button&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Flip vertically&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.flip(2, &lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-fliph button&quot;</span>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Flip horizontally&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;image-undo-&lt;?php echo $post_id; ?&gt;&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.undo(&lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-undo button disabled&quot;</span> <a class="code" href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Undo&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            &lt;<a class="code" href="namespacebutton.html">button</a> type=<span class="stringliteral">&quot;button&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;image-redo-&lt;?php echo $post_id; ?&gt;&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.redo(&lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;, this)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-redo button disabled&quot;</span> <a class="code" href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a>&gt;&lt;span <span class="keyword">class</span>=<span class="stringliteral">&quot;screen-reader-text&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a>( <span class="stringliteral">&#39;Redo&#39;</span> ); ?&gt;&lt;/span&gt;&lt;/<a class="code" href="namespacebutton.html">button</a>&gt;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            &lt;?<a class="code" href="namespacephp.html">php</a> echo $note_no_rotate; ?&gt;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-sizer-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo $sizer; ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-history-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;&quot;</span> /&gt;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-undone-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-selection-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;&quot;</span> /&gt;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-x-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo isset( $meta[&#39;width&#39;] ) ? $meta[&#39;width&#39;] : 0; ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-y-&lt;?php echo $post_id; ?&gt;&quot;</span> value=<span class="stringliteral">&quot;&lt;?php echo isset( $meta[&#39;height&#39;] ) ? $meta[&#39;height&#39;] : 0; ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        &lt;div <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-crop-&lt;?php echo $post_id; ?&gt;&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-crop-wrap&quot;</span>&gt;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        &lt;img <span class="keywordtype">id</span>=<span class="stringliteral">&quot;image-preview-&lt;?php echo $post_id; ?&gt;&quot;</span> onload=<span class="stringliteral">&quot;imageEdit.imgLoaded(&#39;&lt;?php echo $post_id; ?&gt;&#39;)&quot;</span> src=<span class="stringliteral">&quot;&lt;?php echo admin_url( &#39;admin-ajax.php&#39;, &#39;relative&#39; ); ?&gt;?action=imgedit-preview&amp;amp;_ajax_nonce=&lt;?php echo $nonce; ?&gt;&amp;amp;postid=&lt;?php echo $post_id; ?&gt;&amp;amp;rand=&lt;?php echo rand(1, 99999); ?&gt;&quot;</span> alt=<span class="stringliteral">&quot;&quot;</span> /&gt;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-submit&quot;</span>&gt;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.close(&lt;?php echo $post_id; ?&gt;, 1)&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;button imgedit-cancel-btn&quot;</span> value=<span class="stringliteral">&quot;&lt;?php esc_attr_e( &#39;Cancel&#39; ); ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            &lt;<a class="code" href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a> type=<span class="stringliteral">&quot;button&quot;</span> onclick=<span class="stringliteral">&quot;imageEdit.save(&lt;?php echo &quot;</span><a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;$nonce&#39;</span><span class="stringliteral">&quot;; ?&gt;)&quot;</span> <a class="code" href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a>=<span class="stringliteral">&quot;disabled&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;button button-primary imgedit-submit-btn&quot;</span> value=<span class="stringliteral">&quot;&lt;?php esc_attr_e( &#39;Save&#39; ); ?&gt;&quot;</span> /&gt;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        &lt;/div&gt;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;imgedit-wait&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-wait-&lt;?php echo $post_id; ?&gt;&quot;</span>&gt;&lt;/div&gt;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    &lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;jQuery( <span class="keyword">function</span>() { imageEdit.init(&lt;?<a class="code" href="namespacephp.html">php</a> echo <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>; ?&gt;); });&lt;/script&gt;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    &lt;div <span class="keyword">class</span>=<span class="stringliteral">&quot;hidden&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;imgedit-leaving-&lt;?php echo $post_id; ?&gt;&quot;</span>&gt;&lt;?<a class="code" href="namespacephp.html">php</a> <a class="code" href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a>(<span class="stringliteral">&quot;There are unsaved changes that will be lost. &#39;OK&#39; to continue, &#39;Cancel&#39; to return to the Image Editor.&quot;</span>); ?&gt;&lt;/div&gt;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    &lt;/div&gt;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;&lt;?<a class="code" href="namespacephp.html">php</a></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> * Streams image in WP_Image_Editor to browser.</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"> * Provided for backcompat reasons</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment"> * @param WP_Image_Editor $image</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment"> * @param string $mime_type</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"> * @param int $post_id</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment"> * @return bool</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a2d7c26f10bb6beeaf70f864877583aeb">  242</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a2d7c26f10bb6beeaf70f864877583aeb">wp_stream_image</a>( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $mime_type, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> ) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> instanceof <a class="code" href="class_w_p___image___editor.html">WP_Image_Editor</a> ) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">         * Filter the WP_Image_Editor instance for the image to be streamed to the browser.</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">         * @since 3.5.0</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">         * @param WP_Image_Editor $image   WP_Image_Editor instance.</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">         * @param int             $post_id Post ID.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;image_editor_save_pre&#39;</span>, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>-&gt;stream( $mime_type ) ) )</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532">_deprecated_argument</a>( __FUNCTION__, <span class="stringliteral">&#39;3.5&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;$image needs to be an WP_Image_Editor object&#39;</span> ) );</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">         * Filter the GD image resource to be streamed to the browser.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">         * @since 2.9.0</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">         * @deprecated 3.5.0 Use image_editor_save_pre instead.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">         * @param resource $image   Image resource to be streamed.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">         * @param int      $post_id Post ID.</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;image_save_pre&#39;</span>, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">switch</span> ( $mime_type ) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/jpeg&#39;</span>:</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                header( <span class="stringliteral">&#39;Content-Type: image/jpeg&#39;</span> );</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="keywordflow">return</span> imagejpeg( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a>, 90 );</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/png&#39;</span>:</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                header( <span class="stringliteral">&#39;Content-Type: image/png&#39;</span> );</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="keywordflow">return</span> imagepng( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> );</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/gif&#39;</span>:</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                header( <span class="stringliteral">&#39;Content-Type: image/gif&#39;</span> );</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">return</span> imagegif( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> );</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment"> * Saves Image to File</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment"> * @param string $filename</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"> * @param WP_Image_Editor $image</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"> * @param string $mime_type</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment"> * @param int $post_id</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment"> * @return bool</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a704b727a1591c5aa2e85d3dfc73e982c">  298</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a704b727a1591c5aa2e85d3dfc73e982c">wp_save_image_file</a>( $filename, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $mime_type, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> ) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> instanceof <a class="code" href="class_w_p___image___editor.html">WP_Image_Editor</a> ) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">        /** This filter is documented in wp-admin/includes/image-edit.php */</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;image_editor_save_pre&#39;</span>, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">         * Filter whether to skip saving the image file.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">         * Returning a non-null value will short-circuit the save method,</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">         * returning that value instead.</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">         * @since 3.5.0</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">         * @param mixed           $override  Value to return instead of saving. Default null.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">         * @param string          $filename  Name of the file to be saved.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">         * @param WP_Image_Editor $image     WP_Image_Editor instance.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">         * @param string          $mime_type Image mime type.</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">         * @param int             $post_id   Post ID.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        $saved = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;wp_save_image_editor_file&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a>, $filename, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $mime_type, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a> !== $saved )</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">return</span> $saved;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>-&gt;save( $filename, $mime_type );</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532">_deprecated_argument</a>( __FUNCTION__, <span class="stringliteral">&#39;3.5&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;$image needs to be an WP_Image_Editor object&#39;</span> ) );</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">        /** This filter is documented in wp-admin/includes/image-edit.php */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;image_save_pre&#39;</span>, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">         * Filter whether to skip saving the image file.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">         * Returning a non-null value will short-circuit the save method,</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">         * returning that value instead.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">         * @since 2.9.0</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">         * @deprecated 3.5.0 Use wp_save_image_editor_file instead.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">         * @param mixed           $override  Value to return instead of saving. Default null.</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">         * @param string          $filename  Name of the file to be saved.</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">         * @param WP_Image_Editor $image     WP_Image_Editor instance.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">         * @param string          $mime_type Image mime type.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">         * @param int             $post_id   Post ID.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        $saved = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;wp_save_image_file&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a>, $filename, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $mime_type, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a> !== $saved )</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">return</span> $saved;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">switch</span> ( $mime_type ) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/jpeg&#39;</span>:</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">                /** This filter is documented in wp-includes/class-wp-image-editor.php */</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                <span class="keywordflow">return</span> imagejpeg( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $filename, <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;jpeg_quality&#39;</span>, 90, <span class="stringliteral">&#39;edit_image&#39;</span> ) );</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/png&#39;</span>:</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                <span class="keywordflow">return</span> imagepng( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $filename );</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/gif&#39;</span>:</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="keywordflow">return</span> imagegif( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $filename );</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;}</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> * Image preview ratio. Internal use only.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"> * @param int $w Image width in pixels.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> * @param int $h Image height in pixels.</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"> * @return float|int Image preview ratio.</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00375"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a781ab0e1d8353db5d474dd56fe7c4d15">  375</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a781ab0e1d8353db5d474dd56fe7c4d15">_image_get_preview_ratio</a>($w, $h) {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    $max = max($w, $h);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">return</span> $max &gt; 400 ? (400 / $max) : 1;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;}</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> * Returns an image resource. Internal use only.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> * @param resource  $img   Image resource.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> * @param float|int $angle Image rotation angle, in degrees.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> * @return resource|false GD image resource, false otherwise.</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="image-edit_8php.html#ad3df2d7e23d402174d31f084f06f49f4">  390</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#ad3df2d7e23d402174d31f084f06f49f4">_rotate_image_resource</a>($img, $angle) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a5fa64d49f59b259090dd3b907ef3f369">_deprecated_function</a>( __FUNCTION__, <span class="stringliteral">&#39;3.5&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;Use WP_Image_Editor::rotate&#39;</span> ) );</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> ( function_exists(<span class="stringliteral">&#39;imagerotate&#39;</span>) ) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        $rotated = imagerotate($img, $angle, 0);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">if</span> ( is_resource($rotated) ) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            imagedestroy($img);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            $img = $rotated;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">return</span> $img;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"> * Flips an image resource. Internal use only.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment"> * @param resource $img  Image resource.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment"> * @param bool     $horz Whether to flip horizontally.</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment"> * @param bool     $vert Whether to flip vertically.</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"> * @return resource (maybe) flipped image resource.</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a9e79c1d4ef5a6be599f348c680e875ac">  413</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a9e79c1d4ef5a6be599f348c680e875ac">_flip_image_resource</a>($img, $horz, $vert) {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a5fa64d49f59b259090dd3b907ef3f369">_deprecated_function</a>( __FUNCTION__, <span class="stringliteral">&#39;3.5&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;Use WP_Image_Editor::flip&#39;</span> ) );</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    $w = imagesx($img);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    $h = imagesy($img);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    $dst = <a class="code" href="wp-includes_2media_8php.html#a0a2098f702713e7ed08e8f25a98b6f55">wp_imagecreatetruecolor</a>($w, $h);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> ( is_resource($dst) ) {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        $sx = $vert ? ($w - 1) : 0;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        $sy = $horz ? ($h - 1) : 0;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        $sw = $vert ? -$w : $w;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        $sh = $horz ? -$h : $h;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="keywordflow">if</span> ( imagecopyresampled($dst, $img, 0, 0, $sx, $sy, $w, $h, $sw, $sh) ) {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            imagedestroy($img);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            $img = $dst;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">return</span> $img;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;}</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"> * Crops an image resource. Internal use only.</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> * @ignore</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> * @param resource $img Image resource.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> * @param float    $x   Source point x-coordinate.</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment"> * @param float    $y   Source point y-cooredinate.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment"> * @param float    $w   Source width.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"> * @param float    $h   Source height.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment"> * @return resource (maybe) cropped image resource.</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a45e188e83ba3c9d94c5b1bc63ca01af3">  445</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a45e188e83ba3c9d94c5b1bc63ca01af3">_crop_image_resource</a>($img, $x, $y, $w, $h) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    $dst = <a class="code" href="wp-includes_2media_8php.html#a0a2098f702713e7ed08e8f25a98b6f55">wp_imagecreatetruecolor</a>($w, $h);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> ( is_resource($dst) ) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span> ( imagecopy($dst, $img, 0, 0, $x, $y, $w, $h) ) {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            imagedestroy($img);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            $img = $dst;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">return</span> $img;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment"> * Performs group of changes on Editor specified.</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"> * @param WP_Image_Editor $image   {@see WP_Image_Editor} instance.</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> * @param array           $changes Array of change operations.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> * @return WP_Image_Editor {@see WP_Image_Editor} instance with changes applied.</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a0bd3382f7f1183bcfdbaf9e1d2a93116">  465</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a0bd3382f7f1183bcfdbaf9e1d2a93116">image_edit_apply_changes</a>( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $changes ) {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> ( is_resource( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> ) )</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532">_deprecated_argument</a>( __FUNCTION__, <span class="stringliteral">&#39;3.5&#39;</span>, <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>( <span class="stringliteral">&#39;$image needs to be an WP_Image_Editor object&#39;</span> ) );</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> ( !is_array($changes) )</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// Expand change operations.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">foreach</span> ( $changes as $key =&gt; $obj ) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordflow">if</span> ( isset($obj-&gt;r) ) {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            $obj-&gt;type = <span class="stringliteral">&#39;rotate&#39;</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            $obj-&gt;angle = $obj-&gt;r;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            unset($obj-&gt;r);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( isset($obj-&gt;f) ) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            $obj-&gt;type = <span class="stringliteral">&#39;flip&#39;</span>;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            $obj-&gt;axis = $obj-&gt;f;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            unset($obj-&gt;f);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( isset($obj-&gt;c) ) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            $obj-&gt;type = <span class="stringliteral">&#39;crop&#39;</span>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            $obj-&gt;sel = $obj-&gt;c;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            unset($obj-&gt;c);</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        $changes[$key] = $obj;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="comment">// Combine operations.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> ( count($changes) &gt; 1 ) {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        $filtered = array($changes[0]);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">for</span> ( <a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0, $j = 1, $c = count( $changes ); $j &lt; $c; $j++ ) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            $combined = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">if</span> ( $filtered[<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>]-&gt;<a class="code" href="namespacetype.html">type</a> == $changes[$j]-&gt;<a class="code" href="namespacetype.html">type</a> ) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="keywordflow">switch</span> ( $filtered[<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>]-&gt;<a class="code" href="namespacetype.html">type</a> ) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;rotate&#39;</span>:</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        $filtered[<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>]-&gt;angle += $changes[$j]-&gt;angle;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                        $combined = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;flip&#39;</span>:</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                        $filtered[<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>]-&gt;axis ^= $changes[$j]-&gt;axis;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                        $combined = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">if</span> ( !$combined )</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                $filtered[++<a class="code" href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $changes[$j];</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        $changes = $filtered;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        unset($filtered);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">// Image resource before applying the changes.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> instanceof <a class="code" href="class_w_p___image___editor.html">WP_Image_Editor</a> ) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">         * Filter the WP_Image_Editor instance before applying changes to the image.</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">         * @since 3.5.0</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">         * @param WP_Image_Editor $image   WP_Image_Editor instance.</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">         * @param array           $changes Array of change operations.</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;wp_image_editor_before_change&#39;</span>, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $changes );</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( is_resource( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> ) ) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">         * Filter the GD image resource before applying changes to the image.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">         * @since 2.9.0</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">         * @deprecated 3.5.0 Use wp_image_editor_before_change instead.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">         * @param resource $image   GD image resource.</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">         * @param array    $changes Array of change operations.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;image_edit_before_change&#39;</span>, <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $changes );</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">foreach</span> ( $changes as $operation ) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">switch</span> ( $operation-&gt;type ) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;rotate&#39;</span>:</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                <span class="keywordflow">if</span> ( $operation-&gt;angle != 0 ) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                    <span class="keywordflow">if</span> ( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> instanceof WP_Image_Editor )</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>-&gt;rotate( $operation-&gt;angle );</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="image-edit_8php.html#ad3df2d7e23d402174d31f084f06f49f4">_rotate_image_resource</a>( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $operation-&gt;angle );</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;flip&#39;</span>:</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keywordflow">if</span> ( $operation-&gt;axis != 0 )</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                    <span class="keywordflow">if</span> ( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> instanceof WP_Image_Editor )</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>-&gt;flip( ($operation-&gt;axis &amp; 1) != 0, ($operation-&gt;axis &amp; 2) != 0 );</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                        <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="image-edit_8php.html#a9e79c1d4ef5a6be599f348c680e875ac">_flip_image_resource</a>( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, ( $operation-&gt;axis &amp; 1 ) != 0, ( $operation-&gt;axis &amp; 2 ) != 0 );</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">case</span> <span class="stringliteral">&#39;crop&#39;</span>:</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                $sel = $operation-&gt;sel;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> instanceof WP_Image_Editor ) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                    <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a> = <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>-&gt;get_size();</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    $w = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;width&#39;</span>];</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    $h = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;height&#39;</span>];</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    $scale = 1 / <a class="code" href="image-edit_8php.html#a781ab0e1d8353db5d474dd56fe7c4d15">_image_get_preview_ratio</a>( $w, $h ); <span class="comment">// discard preview scaling</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                    <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>-&gt;crop( $sel-&gt;x * $scale, $sel-&gt;y * $scale, $sel-&gt;w * $scale, $sel-&gt;h * $scale );</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    $scale = 1 / <a class="code" href="image-edit_8php.html#a781ab0e1d8353db5d474dd56fe7c4d15">_image_get_preview_ratio</a>( imagesx( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> ), imagesy( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> ) ); <span class="comment">// discard preview scaling</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a> = <a class="code" href="image-edit_8php.html#a45e188e83ba3c9d94c5b1bc63ca01af3">_crop_image_resource</a>( <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>, $sel-&gt;x * $scale, $sel-&gt;y * $scale, $sel-&gt;w * $scale, $sel-&gt;h * $scale );</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a>;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;}</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"> * Streams image in post to browser, along with enqueued changes</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment"> * in $_REQUEST[&#39;history&#39;]</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"> * @param int $post_id</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment"> * @return bool</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a092f70ecf7f6a44955b2aee867851b5f">  586</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a092f70ecf7f6a44955b2aee867851b5f">stream_preview_image</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> ) {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a> = <a class="code" href="wp-includes_2post_8php.html#a39e30b5bbefa3b21d828591673150b89">get_post</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">    /** This filter is documented in wp-admin/admin.php */</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    @ini_set( <span class="stringliteral">&#39;memory_limit&#39;</span>, <a class="code" href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a>( <span class="stringliteral">&#39;admin_memory_limit&#39;</span>, <a class="code" href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php.html#ab447bcc6e77b6401946097a5a5a1374f">WP_MAX_MEMORY_LIMIT</a> ) );</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    $img = <a class="code" href="wp-includes_2media_8php.html#ad63d4869ffd43e6603aee98b35f2bf3d">wp_get_image_editor</a>( <a class="code" href="wp-admin_2includes_2image_8php.html#af91516b2627cdd5d1f4d0a756655f09a">_load_image_to_edit_path</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> ) );</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( $img ) ) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    $changes = !empty($_REQUEST[<span class="stringliteral">&#39;history&#39;</span>]) ? json_decode( <a class="code" href="formatting_8php.html#a6dba609f82ebf662ef06615fac81a032">wp_unslash</a>($_REQUEST[<span class="stringliteral">&#39;history&#39;</span>]) ) : <a class="code" href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> ( $changes )</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        $img = <a class="code" href="image-edit_8php.html#a0bd3382f7f1183bcfdbaf9e1d2a93116">image_edit_apply_changes</a>( $img, $changes );</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// Scale the image.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a> = $img-&gt;get_size();</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    $w = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;width&#39;</span>];</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    $h = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;height&#39;</span>];</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    $ratio = <a class="code" href="image-edit_8php.html#a781ab0e1d8353db5d474dd56fe7c4d15">_image_get_preview_ratio</a>( $w, $h );</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    $w2 = max ( 1, $w * $ratio );</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    $h2 = max ( 1, $h * $ratio );</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( $img-&gt;resize( $w2, $h2 ) ) )</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="image-edit_8php.html#a2d7c26f10bb6beeaf70f864877583aeb">wp_stream_image</a>( $img, <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>-&gt;post_mime_type, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"> * Restores the metadata for a given attachment.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"> * @since 2.9.0</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"> * @param int $post_id Attachment post ID.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * @return stdClass Image restoration message object.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="image-edit_8php.html#a909439c3768827180429b08c32e6771f">  625</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#a909439c3768827180429b08c32e6771f">wp_restore_image</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>) {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    $meta = <a class="code" href="wp-includes_2post_8php.html#a08a3d66142c2d31d6fdb95b1efac7185">wp_get_attachment_metadata</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="plugin-editor_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a> = <a class="code" href="wp-includes_2post_8php.html#a2fbf261bc95d1c62b001c630e19c07d8">get_attached_file</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    $backup_sizes = $old_backup_sizes = <a class="code" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;_wp_attachment_backup_sizes&#39;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    $restored = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a> = <span class="keyword">new</span> stdClass;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> ( !is_array($backup_sizes) ) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>-&gt;error = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Cannot load image metadata.&#39;</span>);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    $parts = pathinfo(<a class="code" href="plugin-editor_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a>);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    $suffix = time() . rand(100, 999);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    $default_sizes = <a class="code" href="wp-includes_2media_8php.html#ac36cc22c8051b5b41332adafa0066b5d">get_intermediate_image_sizes</a>();</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> ( isset($backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>]) &amp;&amp; is_array($backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>]) ) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        $data = $backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>];</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="keywordflow">if</span> ( $parts[<span class="stringliteral">&#39;basename&#39;</span>] != $data[<span class="stringliteral">&#39;file&#39;</span>] ) {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordflow">if</span> ( defined(<span class="stringliteral">&#39;IMAGE_EDIT_OVERWRITE&#39;</span>) &amp;&amp; IMAGE_EDIT_OVERWRITE ) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                <span class="comment">// Delete only if it&#39;s an edited image.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/-e[0-9]{13}\./&#39;</span>, $parts[<span class="stringliteral">&#39;basename&#39;</span>]) ) {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                    <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a716e6d165f72c602db1cd5a7b4698f4d">wp_delete_file</a>( <a class="code" href="plugin-editor_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a> );</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( isset( $meta[<span class="stringliteral">&#39;width&#39;</span>], $meta[<span class="stringliteral">&#39;height&#39;</span>] ) ) {</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                $backup_sizes[<span class="stringliteral">&quot;full-$suffix&quot;</span>] = array(<span class="stringliteral">&#39;width&#39;</span> =&gt; $meta[<span class="stringliteral">&#39;width&#39;</span>], <span class="stringliteral">&#39;height&#39;</span> =&gt; $meta[<span class="stringliteral">&#39;height&#39;</span>], <span class="stringliteral">&#39;file&#39;</span> =&gt; $parts[<span class="stringliteral">&#39;basename&#39;</span>]);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        $restored_file = <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a8a71f9902193fd3868160d28e04027c8">path_join</a>($parts[<span class="stringliteral">&#39;dirname&#39;</span>], $data[<span class="stringliteral">&#39;file&#39;</span>]);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        $restored = <a class="code" href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, $restored_file);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        $meta[<span class="stringliteral">&#39;file&#39;</span>] = <a class="code" href="wp-includes_2post_8php.html#ae3d90994c47372fb9ebdd7c48f862d5c">_wp_relative_upload_path</a>( $restored_file );</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        $meta[<span class="stringliteral">&#39;width&#39;</span>] = $data[<span class="stringliteral">&#39;width&#39;</span>];</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        $meta[<span class="stringliteral">&#39;height&#39;</span>] = $data[<span class="stringliteral">&#39;height&#39;</span>];</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">foreach</span> ( $default_sizes as $default_size ) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">if</span> ( isset($backup_sizes[<span class="stringliteral">&quot;$default_size-orig&quot;</span>]) ) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            $data = $backup_sizes[<span class="stringliteral">&quot;$default_size-orig&quot;</span>];</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            <span class="keywordflow">if</span> ( isset($meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size]) &amp;&amp; $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size][<span class="stringliteral">&#39;file&#39;</span>] != $data[<span class="stringliteral">&#39;file&#39;</span>] ) {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                <span class="keywordflow">if</span> ( defined(<span class="stringliteral">&#39;IMAGE_EDIT_OVERWRITE&#39;</span>) &amp;&amp; IMAGE_EDIT_OVERWRITE ) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                    <span class="comment">// Delete only if it&#39;s an edited image.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                    <span class="keywordflow">if</span> ( preg_match(<span class="stringliteral">&#39;/-e[0-9]{13}-/&#39;</span>, $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size][<span class="stringliteral">&#39;file&#39;</span>]) ) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                        $delete_file = <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a8a71f9902193fd3868160d28e04027c8">path_join</a>( $parts[<span class="stringliteral">&#39;dirname&#39;</span>], $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size][<span class="stringliteral">&#39;file&#39;</span>] );</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a716e6d165f72c602db1cd5a7b4698f4d">wp_delete_file</a>( $delete_file );</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    $backup_sizes[<span class="stringliteral">&quot;$default_size-{$suffix}&quot;</span>] = $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size];</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size] = $data;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            unset($meta[<span class="stringliteral">&#39;sizes&#39;</span>][$default_size]);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">if</span> ( ! <a class="code" href="wp-includes_2post_8php.html#a563b1dd3f65d7fc81701c99ea3f4d575">wp_update_attachment_metadata</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, $meta ) ||</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        ( $old_backup_sizes !== $backup_sizes &amp;&amp; ! <a class="code" href="wp-includes_2post_8php.html#ac984a204e35272d1a897fedce9a92847">update_post_meta</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;_wp_attachment_backup_sizes&#39;</span>, $backup_sizes ) ) ) {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>-&gt;error = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Cannot save image metadata.&#39;</span>);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">if</span> ( !$restored )</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>-&gt;error = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Image metadata is inconsistent.&#39;</span>);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>-&gt;msg = <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Image restored successfully.&#39;</span>);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;}</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment"> * Saves image to post along with enqueued changes</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment"> * in $_REQUEST[&#39;history&#39;]</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment"> * @global array $_wp_additional_image_sizes</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment"> * @param int $post_id</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"> * @return \stdClass</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="image-edit_8php.html#ac1283964ab0299f759c15831ef16c4c6">  710</a></span>&#160;<span class="keyword">function</span> <a class="code" href="image-edit_8php.html#ac1283964ab0299f759c15831ef16c4c6">wp_save_image</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> ) {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    global $_wp_additional_image_sizes;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    $return = <span class="keyword">new</span> stdClass;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    $success = $delete = $scaled = $nocrop = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a> = <a class="code" href="wp-includes_2post_8php.html#a39e30b5bbefa3b21d828591673150b89">get_post</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a> );</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    $img = <a class="code" href="wp-includes_2media_8php.html#ad63d4869ffd43e6603aee98b35f2bf3d">wp_get_image_editor</a>( <a class="code" href="wp-admin_2includes_2image_8php.html#af91516b2627cdd5d1f4d0a756655f09a">_load_image_to_edit_path</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;full&#39;</span> ) );</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a>( $img ) ) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        $return-&gt;error = <a class="code" href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a>( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Unable to create new image.&#39;</span>) );</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <span class="keywordflow">return</span> $return;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    $fwidth = !empty($_REQUEST[<span class="stringliteral">&#39;fwidth&#39;</span>]) ? intval($_REQUEST[<span class="stringliteral">&#39;fwidth&#39;</span>]) : 0;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    $fheight = !empty($_REQUEST[<span class="stringliteral">&#39;fheight&#39;</span>]) ? intval($_REQUEST[<span class="stringliteral">&#39;fheight&#39;</span>]) : 0;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    $target = !empty($_REQUEST[<span class="stringliteral">&#39;target&#39;</span>]) ? preg_replace(<span class="stringliteral">&#39;/[^a-z0-9_-]+/i&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $_REQUEST[<span class="stringliteral">&#39;target&#39;</span>]) : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    $scale = !empty($_REQUEST[<span class="stringliteral">&#39;do&#39;</span>]) &amp;&amp; <span class="stringliteral">&#39;scale&#39;</span> == $_REQUEST[<span class="stringliteral">&#39;do&#39;</span>];</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">if</span> ( $scale &amp;&amp; $fwidth &gt; 0 &amp;&amp; $fheight &gt; 0 ) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a> = $img-&gt;get_size();</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        $sX = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;width&#39;</span>];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        $sY = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;height&#39;</span>];</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="comment">// Check if it has roughly the same w / h ratio.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        $diff = round($sX / $sY, 2) - round($fwidth / $fheight, 2);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keywordflow">if</span> ( -0.1 &lt; $diff &amp;&amp; $diff &lt; 0.1 ) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="comment">// Scale the full size image.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="keywordflow">if</span> ( $img-&gt;resize( $fwidth, $fheight ) )</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                $scaled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordflow">if</span> ( !$scaled ) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            $return-&gt;error = <a class="code" href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a>( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Error while saving the scaled image. Please reload the page and try again.&#39;</span>) );</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keywordflow">return</span> $return;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( !empty($_REQUEST[<span class="stringliteral">&#39;history&#39;</span>]) ) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        $changes = json_decode( <a class="code" href="formatting_8php.html#a6dba609f82ebf662ef06615fac81a032">wp_unslash</a>($_REQUEST[<span class="stringliteral">&#39;history&#39;</span>]) );</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="keywordflow">if</span> ( $changes )</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            $img = <a class="code" href="image-edit_8php.html#a0bd3382f7f1183bcfdbaf9e1d2a93116">image_edit_apply_changes</a>($img, $changes);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        $return-&gt;error = <a class="code" href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a>( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Nothing to save, the image has not changed.&#39;</span>) );</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">return</span> $return;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    $meta = <a class="code" href="wp-includes_2post_8php.html#a08a3d66142c2d31d6fdb95b1efac7185">wp_get_attachment_metadata</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    $backup_sizes = <a class="code" href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a>( <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>-&gt;ID, <span class="stringliteral">&#39;_wp_attachment_backup_sizes&#39;</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">if</span> ( !is_array($meta) ) {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        $return-&gt;error = <a class="code" href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a>( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Image data does not exist. Please re-upload the image.&#39;</span>) );</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">return</span> $return;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">if</span> ( !is_array($backup_sizes) )</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        $backup_sizes = array();</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// Generate new filename.</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="wp-load_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> = <a class="code" href="wp-includes_2post_8php.html#a2fbf261bc95d1c62b001c630e19c07d8">get_attached_file</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    $path_parts = pathinfo( <a class="code" href="wp-load_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> );</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    $filename = $path_parts[<span class="stringliteral">&#39;filename&#39;</span>];</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    $suffix = time() . rand(100, 999);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">if</span> ( defined(<span class="stringliteral">&#39;IMAGE_EDIT_OVERWRITE&#39;</span>) &amp;&amp; IMAGE_EDIT_OVERWRITE &amp;&amp;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        isset($backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>]) &amp;&amp; $backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>] != $path_parts[<span class="stringliteral">&#39;basename&#39;</span>] ) {</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;thumbnail&#39;</span> == $target )</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            $new_path = <span class="stringliteral">&quot;{$path_parts[&#39;dirname&#39;]}/{$filename}-temp.{$path_parts[&#39;extension&#39;]}&quot;</span>;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            $new_path = <a class="code" href="wp-load_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">while</span>( <span class="keyword">true</span> ) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            $filename = preg_replace( <span class="stringliteral">&#39;/-e([0-9]+)$/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $filename );</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            $filename .= <span class="stringliteral">&quot;-e{$suffix}&quot;</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            $new_filename = <span class="stringliteral">&quot;{$filename}.{$path_parts[&#39;extension&#39;]}&quot;</span>;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            $new_path = <span class="stringliteral">&quot;{$path_parts[&#39;dirname&#39;]}/$new_filename&quot;</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="keywordflow">if</span> ( file_exists($new_path) )</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                $suffix++;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        }</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// Save the full-size file, also needed to create sub-sizes.</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">if</span> ( !<a class="code" href="image-edit_8php.html#a704b727a1591c5aa2e85d3dfc73e982c">wp_save_image_file</a>($new_path, $img, <a class="code" href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a>-&gt;post_mime_type, <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>) ) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        $return-&gt;error = <a class="code" href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a>( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Unable to save the image.&#39;</span>) );</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordflow">return</span> $return;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;nothumb&#39;</span> == $target || <span class="stringliteral">&#39;all&#39;</span> == $target || <span class="stringliteral">&#39;full&#39;</span> == $target || $scaled ) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        $tag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span> ( isset($backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>]) ) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="keywordflow">if</span> ( ( !defined(<span class="stringliteral">&#39;IMAGE_EDIT_OVERWRITE&#39;</span>) || !IMAGE_EDIT_OVERWRITE ) &amp;&amp; $backup_sizes[<span class="stringliteral">&#39;full-orig&#39;</span>][<span class="stringliteral">&#39;file&#39;</span>] != $path_parts[<span class="stringliteral">&#39;basename&#39;</span>] )</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                $tag = <span class="stringliteral">&quot;full-$suffix&quot;</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            $tag = <span class="stringliteral">&#39;full-orig&#39;</span>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">if</span> ( $tag )</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            $backup_sizes[$tag] = array(<span class="stringliteral">&#39;width&#39;</span> =&gt; $meta[<span class="stringliteral">&#39;width&#39;</span>], <span class="stringliteral">&#39;height&#39;</span> =&gt; $meta[<span class="stringliteral">&#39;height&#39;</span>], <span class="stringliteral">&#39;file&#39;</span> =&gt; $path_parts[<span class="stringliteral">&#39;basename&#39;</span>]);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        $success = ( <a class="code" href="wp-load_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a> === $new_path ) || <a class="code" href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, $new_path );</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        $meta[<span class="stringliteral">&#39;file&#39;</span>] = <a class="code" href="wp-includes_2post_8php.html#ae3d90994c47372fb9ebdd7c48f862d5c">_wp_relative_upload_path</a>( $new_path );</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a> = $img-&gt;get_size();</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        $meta[<span class="stringliteral">&#39;width&#39;</span>] = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;width&#39;</span>];</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        $meta[<span class="stringliteral">&#39;height&#39;</span>] = <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>[<span class="stringliteral">&#39;height&#39;</span>];</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">if</span> ( $success &amp;&amp; (<span class="stringliteral">&#39;nothumb&#39;</span> == $target || <span class="stringliteral">&#39;all&#39;</span> == $target) ) {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            $sizes = <a class="code" href="wp-includes_2media_8php.html#ac36cc22c8051b5b41332adafa0066b5d">get_intermediate_image_sizes</a>();</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;nothumb&#39;</span> == $target )</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                $sizes = array_diff( $sizes, array(<span class="stringliteral">&#39;thumbnail&#39;</span>) );</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        $return-&gt;fw = $meta[<span class="stringliteral">&#39;width&#39;</span>];</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        $return-&gt;fh = $meta[<span class="stringliteral">&#39;height&#39;</span>];</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    } <a class="code" href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a> ( <span class="stringliteral">&#39;thumbnail&#39;</span> == $target ) {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        $sizes = array( <span class="stringliteral">&#39;thumbnail&#39;</span> );</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        $success = $delete = $nocrop = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">if</span> ( isset( $sizes ) ) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        $_sizes = array();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">foreach</span> ( $sizes as <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a> ) {</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            $tag = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="keywordflow">if</span> ( isset( $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$size] ) ) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                <span class="keywordflow">if</span> ( isset($backup_sizes[<span class="stringliteral">&quot;$size-orig&quot;</span>]) ) {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                    <span class="keywordflow">if</span> ( ( !defined(<span class="stringliteral">&#39;IMAGE_EDIT_OVERWRITE&#39;</span>) || !IMAGE_EDIT_OVERWRITE ) &amp;&amp; $backup_sizes[<span class="stringliteral">&quot;$size-orig&quot;</span>][<span class="stringliteral">&#39;file&#39;</span>] != $meta[<span class="stringliteral">&#39;sizes&#39;</span>][$size][<span class="stringliteral">&#39;file&#39;</span>] )</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                        $tag = <span class="stringliteral">&quot;$size-$suffix&quot;</span>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                    $tag = <span class="stringliteral">&quot;$size-orig&quot;</span>;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                <span class="keywordflow">if</span> ( $tag )</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                    $backup_sizes[$tag] = $meta[<span class="stringliteral">&#39;sizes&#39;</span>][<a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a>];</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            }</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="keywordflow">if</span> ( isset( $_wp_additional_image_sizes[ $size ] ) ) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                $width  = intval( $_wp_additional_image_sizes[ $size ][<span class="stringliteral">&#39;width&#39;</span>] );</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                $height = intval( $_wp_additional_image_sizes[ $size ][<span class="stringliteral">&#39;height&#39;</span>] );</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                $crop   = ( $nocrop ) ? <span class="keyword">false</span> : $_wp_additional_image_sizes[ $size ][<span class="stringliteral">&#39;crop&#39;</span>];</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                $height = <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&quot;{$size}_size_h&quot;</span> );</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                $width  = <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&quot;{$size}_size_w&quot;</span> );</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                $crop   = ( $nocrop ) ? <span class="keyword">false</span> : <a class="code" href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a>( <span class="stringliteral">&quot;{$size}_crop&quot;</span> );</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            $_sizes[ <a class="code" href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a> ] = array( <span class="stringliteral">&#39;width&#39;</span> =&gt; $width, <span class="stringliteral">&#39;height&#39;</span> =&gt; $height, <span class="stringliteral">&#39;crop&#39;</span> =&gt; $crop );</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        $meta[<span class="stringliteral">&#39;sizes&#39;</span>] = array_merge( $meta[<span class="stringliteral">&#39;sizes&#39;</span>], $img-&gt;multi_resize( $_sizes ) );</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    unset( $img );</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> ( $success ) {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <a class="code" href="wp-includes_2post_8php.html#a563b1dd3f65d7fc81701c99ea3f4d575">wp_update_attachment_metadata</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, $meta );</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <a class="code" href="wp-includes_2post_8php.html#ac984a204e35272d1a897fedce9a92847">update_post_meta</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, <span class="stringliteral">&#39;_wp_attachment_backup_sizes&#39;</span>, $backup_sizes);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keywordflow">if</span> ( $target == <span class="stringliteral">&#39;thumbnail&#39;</span> || $target == <span class="stringliteral">&#39;all&#39;</span> || $target == <span class="stringliteral">&#39;full&#39;</span> ) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <span class="comment">// Check if it&#39;s an image edit from attachment edit screen</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            <span class="keywordflow">if</span> ( ! empty( $_REQUEST[<span class="stringliteral">&#39;context&#39;</span>] ) &amp;&amp; <span class="stringliteral">&#39;edit-attachment&#39;</span> == $_REQUEST[<span class="stringliteral">&#39;context&#39;</span>] ) {</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                $thumb_url = <a class="code" href="wp-includes_2media_8php.html#adc3e512380a7336cfc8dd3417892a65b">wp_get_attachment_image_src</a>( <a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>, array( 900, 600 ), <span class="keyword">true</span> );</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                $return-&gt;thumbnail = $thumb_url[0];</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                $file_url = <a class="code" href="wp-includes_2post_8php.html#a4178b3d59d8ab3a058de6e24fa056697">wp_get_attachment_url</a>(<a class="code" href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a>);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                <span class="keywordflow">if</span> ( ! empty( $meta[<span class="stringliteral">&#39;sizes&#39;</span>][<span class="stringliteral">&#39;thumbnail&#39;</span>] ) &amp;&amp; $thumb = $meta[<span class="stringliteral">&#39;sizes&#39;</span>][<span class="stringliteral">&#39;thumbnail&#39;</span>] ) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                    $return-&gt;thumbnail = <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a8a71f9902193fd3868160d28e04027c8">path_join</a>( dirname($file_url), $thumb[<span class="stringliteral">&#39;file&#39;</span>] );</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                    $return-&gt;thumbnail = <span class="stringliteral">&quot;$file_url?w=128&amp;h=128&quot;</span>;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        $delete = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">if</span> ( $delete ) {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <a class="code" href="wordpress_2wp-includes_2functions_8php.html#a716e6d165f72c602db1cd5a7b4698f4d">wp_delete_file</a>( $new_path );</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    $return-&gt;msg = <a class="code" href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a>( <a class="code" href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a>(<span class="stringliteral">&#39;Image saved&#39;</span>) );</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">return</span> $return;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;}</div>
<div class="ttc" id="formatting_8php_html_a0fe22f477c9eafcf9d3805461f249393"><div class="ttname"><a href="formatting_8php.html#a0fe22f477c9eafcf9d3805461f249393">esc_js</a></div><div class="ttdeci">esc_js($text)</div><div class="ttdoc">Escape single quotes, htmlspecialchar " < > &, and fix line endings. </div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l03500">formatting.php:3500</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a4178b3d59d8ab3a058de6e24fa056697"><div class="ttname"><a href="wp-includes_2post_8php.html#a4178b3d59d8ab3a058de6e24fa056697">wp_get_attachment_url</a></div><div class="ttdeci">wp_get_attachment_url($post_id=0)</div><div class="ttdoc">Retrieve the URL for an attachment. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l04866">wp-includes/post.php:4866</a></div></div>
<div class="ttc" id="post__image_8php_html_aac6146b4cdec66c94263ddb55afd5946"><div class="ttname"><a href="post__image_8php.html#aac6146b4cdec66c94263ddb55afd5946">$image</a></div><div class="ttdeci">$image</div><div class="ttdef"><b>Definition:</b> <a href="post__image_8php_source.html#l00099">post_image.php:99</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_ac984a204e35272d1a897fedce9a92847"><div class="ttname"><a href="wp-includes_2post_8php.html#ac984a204e35272d1a897fedce9a92847">update_post_meta</a></div><div class="ttdeci">update_post_meta($post_id, $meta_key, $meta_value, $prev_value= '')</div><div class="ttdoc">Update post meta field based on post ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l01733">wp-includes/post.php:1733</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a08a3d66142c2d31d6fdb95b1efac7185"><div class="ttname"><a href="wp-includes_2post_8php.html#a08a3d66142c2d31d6fdb95b1efac7185">wp_get_attachment_metadata</a></div><div class="ttdeci">wp_get_attachment_metadata($post_id=0, $unfiltered=false)</div><div class="ttdoc">Retrieve attachment meta field for attachment ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l04806">wp-includes/post.php:4806</a></div></div>
<div class="ttc" id="image-edit_8php_html_ac1283964ab0299f759c15831ef16c4c6"><div class="ttname"><a href="image-edit_8php.html#ac1283964ab0299f759c15831ef16c4c6">wp_save_image</a></div><div class="ttdeci">wp_save_image($post_id)</div><div class="ttdoc">Saves image to post along with enqueued changes in $_REQUEST[&#39;history&#39;]. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00710">image-edit.php:710</a></div></div>
<div class="ttc" id="preview_8php_html_a21eed5208524a2f33323eabc88f8dcdd"><div class="ttname"><a href="preview_8php.html#a21eed5208524a2f33323eabc88f8dcdd">esc_html_e</a></div><div class="ttdeci">esc_html_e( 'Form Preview', 'gravityforms')?&gt;&lt;/title &gt;&lt; link rel</div><div class="ttdef"><b>Definition:</b> <a href="preview_8php_source.html#l00033">preview.php:33</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_a2bd093b9a01e6da239aef407b25be1f0"><div class="ttname"><a href="wp-includes_2media_8php.html#a2bd093b9a01e6da239aef407b25be1f0">wp_constrain_dimensions</a></div><div class="ttdeci">wp_constrain_dimensions($current_width, $current_height, $max_width=0, $max_height=0)</div><div class="ttdoc">Calculates the new dimensions for a down-sampled image. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l00386">wp-includes/media.php:386</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_a34f11f36b78c75646f34ee1579ebae3d"><div class="ttname"><a href="wp-includes_2media_8php.html#a34f11f36b78c75646f34ee1579ebae3d">image_get_intermediate_size</a></div><div class="ttdeci">image_get_intermediate_size($post_id, $size= 'thumbnail')</div><div class="ttdoc">Retrieves the image&#39;s intermediate size (resized) path, width, and height. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l00632">wp-includes/media.php:632</a></div></div>
<div class="ttc" id="menu_8php_html_a83018d9153d17d91fbcf3bc10158d34f"><div class="ttname"><a href="menu_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a></div><div class="ttdeci">$i</div><div class="ttdef"><b>Definition:</b> <a href="menu_8php_source.html#l00053">menu.php:53</a></div></div>
<div class="ttc" id="wp-content_2themes_2twentythirteen_2inc_2custom-header_8php_html_ab1b1d44a8c4dbcaeff449be6b5e19935"><div class="ttname"><a href="wp-content_2themes_2twentythirteen_2inc_2custom-header_8php.html#ab1b1d44a8c4dbcaeff449be6b5e19935">width</a></div><div class="ttdeci">max width</div><div class="ttdef"><b>Definition:</b> <a href="wp-content_2themes_2twentythirteen_2inc_2custom-header_8php_source.html#l00172">wp-content/themes/twentythirteen/inc/custom-header.php:172</a></div></div>
<div class="ttc" id="image-edit_8php_html_a4f00df01abc362e365954aaf6397788b"><div class="ttname"><a href="image-edit_8php.html#a4f00df01abc362e365954aaf6397788b">wp_image_editor</a></div><div class="ttdeci">wp_image_editor($post_id, $msg=false)</div><div class="ttdoc">Loads the WP image-editing interface. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00016">image-edit.php:16</a></div></div>
<div class="ttc" id="async-upload_8php_html_a2717aea9720d8d0b37b32fede52333b6"><div class="ttname"><a href="async-upload_8php.html#a2717aea9720d8d0b37b32fede52333b6">$post_id</a></div><div class="ttdeci">$post_id</div><div class="ttdef"><b>Definition:</b> <a href="async-upload_8php_source.html#l00084">async-upload.php:84</a></div></div>
<div class="ttc" id="image-edit_8php_html_a909439c3768827180429b08c32e6771f"><div class="ttname"><a href="image-edit_8php.html#a909439c3768827180429b08c32e6771f">wp_restore_image</a></div><div class="ttdeci">wp_restore_image($post_id)</div><div class="ttdoc">Restores the metadata for a given attachment. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00625">image-edit.php:625</a></div></div>
<div class="ttc" id="image-edit_8php_html_a45e188e83ba3c9d94c5b1bc63ca01af3"><div class="ttname"><a href="image-edit_8php.html#a45e188e83ba3c9d94c5b1bc63ca01af3">_crop_image_resource</a></div><div class="ttdeci">_crop_image_resource($img, $x, $y, $w, $h)</div><div class="ttdoc">Crops an image resource. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00445">image-edit.php:445</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a1a4ddf27527646308447391e3ac4dce3"><div class="ttname"><a href="wp-includes_2post_8php.html#a1a4ddf27527646308447391e3ac4dce3">update_attached_file</a></div><div class="ttdeci">update_attached_file($attachment_id, $file)</div><div class="ttdoc">Update attachment file path based on attachment ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00218">wp-includes/post.php:218</a></div></div>
<div class="ttc" id="admin_8php_html_af1c9ecf26c0cfd247c0760dd4b594a6d"><div class="ttname"><a href="admin_8php.html#af1c9ecf26c0cfd247c0760dd4b594a6d">elseif</a></div><div class="ttdeci">if(get_option('db_upgraded')) elseif(get_option('db_version')!=$wp_db_version &amp;&amp;empty($_POST))</div><div class="ttdef"><b>Definition:</b> <a href="admin_8php_source.html#l00045">admin.php:45</a></div></div>
<div class="ttc" id="image-edit_8php_html_a0bd3382f7f1183bcfdbaf9e1d2a93116"><div class="ttname"><a href="image-edit_8php.html#a0bd3382f7f1183bcfdbaf9e1d2a93116">image_edit_apply_changes</a></div><div class="ttdeci">image_edit_apply_changes($image, $changes)</div><div class="ttdoc">Performs group of changes on Editor specified. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00465">image-edit.php:465</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a192bddf5a4999057d4330352533ffad1"><div class="ttname"><a href="wp-includes_2post_8php.html#a192bddf5a4999057d4330352533ffad1">get_post_mime_type</a></div><div class="ttdeci">get_post_mime_type($ID= '')</div><div class="ttdoc">Retrieve the mime type of an attachment based on the ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00529">wp-includes/post.php:529</a></div></div>
<div class="ttc" id="namespacestrong_html"><div class="ttname"><a href="namespacestrong.html">strong</a></div></div>
<div class="ttc" id="namespacep_html"><div class="ttname"><a href="namespacep.html">p</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a563b1dd3f65d7fc81701c99ea3f4d575"><div class="ttname"><a href="wp-includes_2post_8php.html#a563b1dd3f65d7fc81701c99ea3f4d575">wp_update_attachment_metadata</a></div><div class="ttdeci">wp_update_attachment_metadata($post_id, $data)</div><div class="ttdoc">Update metadata for an attachment. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l04837">wp-includes/post.php:4837</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_ae3d90994c47372fb9ebdd7c48f862d5c"><div class="ttname"><a href="wp-includes_2post_8php.html#ae3d90994c47372fb9ebdd7c48f862d5c">_wp_relative_upload_path</a></div><div class="ttdeci">_wp_relative_upload_path($path)</div><div class="ttdoc">Return relative path to an uploaded file. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00248">wp-includes/post.php:248</a></div></div>
<div class="ttc" id="image-edit_8php_html_a781ab0e1d8353db5d474dd56fe7c4d15"><div class="ttname"><a href="image-edit_8php.html#a781ab0e1d8353db5d474dd56fe7c4d15">_image_get_preview_ratio</a></div><div class="ttdeci">_image_get_preview_ratio($w, $h)</div><div class="ttdoc">Image preview ratio. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00375">image-edit.php:375</a></div></div>
<div class="ttc" id="noop_8php_html_a54639394aa645a2277ea41f3cbd23247"><div class="ttname"><a href="noop_8php.html#a54639394aa645a2277ea41f3cbd23247">apply_filters</a></div><div class="ttdeci">apply_filters()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00026">noop.php:26</a></div></div>
<div class="ttc" id="noop_8php_html_aaf1220eff85fdd291725eabf743b2ed3"><div class="ttname"><a href="noop_8php.html#aaf1220eff85fdd291725eabf743b2ed3">get_option</a></div><div class="ttdeci">get_option()</div><div class="ttdef"><b>Definition:</b> <a href="noop_8php_source.html#l00031">noop.php:31</a></div></div>
<div class="ttc" id="wp-load_8php_html_a0a4baf0b22973c07685c3981f0d17fc4"><div class="ttname"><a href="wp-load_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a></div><div class="ttdeci">$path</div><div class="ttdef"><b>Definition:</b> <a href="wp-load_8php_source.html#l00056">wp-load.php:56</a></div></div>
<div class="ttc" id="class-wp-error_8php_html_a741b5ec807dbba8d2a0851e32e7d926c"><div class="ttname"><a href="class-wp-error_8php.html#a741b5ec807dbba8d2a0851e32e7d926c">is_wp_error</a></div><div class="ttdeci">is_wp_error($thing)</div><div class="ttdoc">Check whether variable is a WordPress Error. </div><div class="ttdef"><b>Definition:</b> <a href="class-wp-error_8php_source.html#l00216">class-wp-error.php:216</a></div></div>
<div class="ttc" id="wordpress_2wp-content_2themes_2twentyeleven_2functions_8php_html_ad6d040b79093a1652d3e3a0f02172d83"><div class="ttname"><a href="wordpress_2wp-content_2themes_2twentyeleven_2functions_8php.html#ad6d040b79093a1652d3e3a0f02172d83">height</a></div><div class="ttdeci">line height</div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-content_2themes_2twentyeleven_2functions_8php_source.html#l00295">wordpress/wp-content/themes/twentyeleven/functions.php:295</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a39e30b5bbefa3b21d828591673150b89"><div class="ttname"><a href="wp-includes_2post_8php.html#a39e30b5bbefa3b21d828591673150b89">get_post</a></div><div class="ttdeci">get_post($post=null, $output=OBJECT, $filter= 'raw')</div><div class="ttdoc">Retrieves post data given a post ID or post object. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00426">wp-includes/post.php:426</a></div></div>
<div class="ttc" id="form__list_8php_html_a37ec3c0e38c16262d3ff05971a91c276"><div class="ttname"><a href="form__list_8php.html#a37ec3c0e38c16262d3ff05971a91c276">input</a></div><div class="ttdeci">gf_new_form_modal_container setting row input</div><div class="ttdef"><b>Definition:</b> <a href="form__list_8php_source.html#l00157">form_list.php:157</a></div></div>
<div class="ttc" id="general-template_8php_html_a1ca941104709dc012a22d68c50b20b2e"><div class="ttname"><a href="general-template_8php.html#a1ca941104709dc012a22d68c50b20b2e">disabled</a></div><div class="ttdeci">disabled($disabled, $current=true, $echo=true)</div><div class="ttdoc">Outputs the html disabled attribute. </div><div class="ttdef"><b>Definition:</b> <a href="general-template_8php_source.html#l03428">general-template.php:3428</a></div></div>
<div class="ttc" id="wordpress_2wp-admin_2network_2settings_8php_html_af850206ec47fb9a5348fb5b666662c18"><div class="ttname"><a href="wordpress_2wp-admin_2network_2settings_8php.html#af850206ec47fb9a5348fb5b666662c18">_e</a></div><div class="ttdeci">_e( 'Network Title')?&gt;&lt;/label &gt;&lt;/th &gt;&lt; td &gt;&lt; input name</div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-admin_2network_2settings_8php_source.html#l00107">wordpress/wp-admin/network/settings.php:107</a></div></div>
<div class="ttc" id="options-discussion_8php_html_af594986e4618a8d6a5d7566617f583c6"><div class="ttname"><a href="options-discussion_8php.html#af594986e4618a8d6a5d7566617f583c6">$size</a></div><div class="ttdeci">$size</div><div class="ttdef"><b>Definition:</b> <a href="options-discussion_8php_source.html#l00243">options-discussion.php:243</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_ac48a114db59e74b736a3fc795a62766b"><div class="ttname"><a href="wp-includes_2media_8php.html#ac48a114db59e74b736a3fc795a62766b">wp_image_editor_supports</a></div><div class="ttdeci">wp_image_editor_supports($args=array())</div><div class="ttdoc">Tests whether there is an editor that supports a given mime type or methods. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l02873">wp-includes/media.php:2873</a></div></div>
<div class="ttc" id="image-edit_8php_html_a2d7c26f10bb6beeaf70f864877583aeb"><div class="ttname"><a href="image-edit_8php.html#a2d7c26f10bb6beeaf70f864877583aeb">wp_stream_image</a></div><div class="ttdeci">wp_stream_image($image, $mime_type, $post_id)</div><div class="ttdoc">Streams image in WP_Image_Editor to browser. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00242">image-edit.php:242</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a2fbf261bc95d1c62b001c630e19c07d8"><div class="ttname"><a href="wp-includes_2post_8php.html#a2fbf261bc95d1c62b001c630e19c07d8">get_attached_file</a></div><div class="ttdeci">get_attached_file($attachment_id, $unfiltered=false)</div><div class="ttdoc">Retrieve attached file path based on attachment ID. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l00187">wp-includes/post.php:187</a></div></div>
<div class="ttc" id="wp-includes_2post_8php_html_a5ac8d9eefeeb2ac8b45650a335971b81"><div class="ttname"><a href="wp-includes_2post_8php.html#a5ac8d9eefeeb2ac8b45650a335971b81">get_post_meta</a></div><div class="ttdeci">get_post_meta($post_id, $key= '', $single=false)</div><div class="ttdoc">Retrieve post meta field for a post. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2post_8php_source.html#l01711">wp-includes/post.php:1711</a></div></div>
<div class="ttc" id="plugin-editor_8php_html_aa1bfbd27060176201b271918dff57e8f"><div class="ttname"><a href="plugin-editor_8php.html#aa1bfbd27060176201b271918dff57e8f">$file</a></div><div class="ttdeci">$file</div><div class="ttdef"><b>Definition:</b> <a href="plugin-editor_8php_source.html#l00051">plugin-editor.php:51</a></div></div>
<div class="ttc" id="general-template_8php_html_ac5a8cddc08f21085ba0939cda4f64766"><div class="ttname"><a href="general-template_8php.html#ac5a8cddc08f21085ba0939cda4f64766">checked</a></div><div class="ttdeci">checked($checked, $current=true, $echo=true)</div><div class="ttdoc">Outputs the html checked attribute. </div><div class="ttdef"><b>Definition:</b> <a href="general-template_8php_source.html#l03396">general-template.php:3396</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_adc3e512380a7336cfc8dd3417892a65b"><div class="ttname"><a href="wp-includes_2media_8php.html#adc3e512380a7336cfc8dd3417892a65b">wp_get_attachment_image_src</a></div><div class="ttdeci">wp_get_attachment_image_src($attachment_id, $size= 'thumbnail', $icon=false)</div><div class="ttdoc">Retrieve an image to represent an attachment. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l00751">wp-includes/media.php:751</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_ac36cc22c8051b5b41332adafa0066b5d"><div class="ttname"><a href="wp-includes_2media_8php.html#ac36cc22c8051b5b41332adafa0066b5d">get_intermediate_image_sizes</a></div><div class="ttdeci">get_intermediate_image_sizes()</div><div class="ttdoc">Gets the available intermediate image sizes. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l00716">wp-includes/media.php:716</a></div></div>
<div class="ttc" id="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php_html_ab447bcc6e77b6401946097a5a5a1374f"><div class="ttname"><a href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php.html#ab447bcc6e77b6401946097a5a5a1374f">WP_MAX_MEMORY_LIMIT</a></div><div class="ttdeci">const WP_MAX_MEMORY_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="tmp_2wordpress-tests-lib_2includes_2bootstrap_8php_source.html#l00036">tmp/wordpress-tests-lib/includes/bootstrap.php:36</a></div></div>
<div class="ttc" id="api-core_2wp-includes_2compat_8php_html_a69ce1131cd2c65fd147aa7b1de9ed7ee"><div class="ttname"><a href="api-core_2wp-includes_2compat_8php.html#a69ce1131cd2c65fd147aa7b1de9ed7ee">endif</a></div><div class="ttdeci">if(!function_exists( 'json_last_error_msg'))() endif</div><div class="ttdef"><b>Definition:</b> <a href="api-core_2wp-includes_2compat_8php_source.html#l00011">api-core/wp-includes/compat.php:11</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_a0a2098f702713e7ed08e8f25a98b6f55"><div class="ttname"><a href="wp-includes_2media_8php.html#a0a2098f702713e7ed08e8f25a98b6f55">wp_imagecreatetruecolor</a></div><div class="ttdeci">wp_imagecreatetruecolor($width, $height)</div><div class="ttdoc">Create new GD image resource with transparency support. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l02752">wp-includes/media.php:2752</a></div></div>
<div class="ttc" id="image-edit_8php_html_a704b727a1591c5aa2e85d3dfc73e982c"><div class="ttname"><a href="image-edit_8php.html#a704b727a1591c5aa2e85d3dfc73e982c">wp_save_image_file</a></div><div class="ttdeci">wp_save_image_file($filename, $image, $mime_type, $post_id)</div><div class="ttdoc">Saves Image to File. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00298">image-edit.php:298</a></div></div>
<div class="ttc" id="edit-comments_8php_html_a01a5ac2afed3a262528186f4ba5f9693"><div class="ttname"><a href="edit-comments_8php.html#a01a5ac2afed3a262528186f4ba5f9693">name</a></div><div class="ttdeci">s name</div><div class="ttdef"><b>Definition:</b> <a href="edit-comments_8php_source.html#l00156">edit-comments.php:156</a></div></div>
<div class="ttc" id="sites_8php_html_a7403ae1dd22aabdfaf1c54375a124754"><div class="ttname"><a href="sites_8php.html#a7403ae1dd22aabdfaf1c54375a124754">$msg</a></div><div class="ttdeci">if(isset($_GET['action'])) $msg</div><div class="ttdef"><b>Definition:</b> <a href="sites_8php_source.html#l00224">sites.php:224</a></div></div>
<div class="ttc" id="wp-includes_2media_8php_html_ad63d4869ffd43e6603aee98b35f2bf3d"><div class="ttname"><a href="wp-includes_2media_8php.html#ad63d4869ffd43e6603aee98b35f2bf3d">wp_get_image_editor</a></div><div class="ttdeci">wp_get_image_editor($path, $args=array())</div><div class="ttdoc">Returns a WP_Image_Editor instance and loads file into it. </div><div class="ttdef"><b>Definition:</b> <a href="wp-includes_2media_8php_source.html#l02837">wp-includes/media.php:2837</a></div></div>
<div class="ttc" id="formatting_8php_html_a6dba609f82ebf662ef06615fac81a032"><div class="ttname"><a href="formatting_8php.html#a6dba609f82ebf662ef06615fac81a032">wp_unslash</a></div><div class="ttdeci">wp_unslash($value)</div><div class="ttdoc">Remove slashes from a string or array of strings. </div><div class="ttdef"><b>Definition:</b> <a href="formatting_8php_source.html#l04420">formatting.php:4420</a></div></div>
<div class="ttc" id="form__list_8php_html_a75c7d6fef8f2fc1b14944df043dd5690"><div class="ttname"><a href="form__list_8php.html#a75c7d6fef8f2fc1b14944df043dd5690">label</a></div><div class="ttdeci">gf_new_form_modal_container setting row label</div><div class="ttdef"><b>Definition:</b> <a href="form__list_8php_source.html#l00153">form_list.php:153</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_a46b3622ccc6d393dfd97e355b7bd0bd6"><div class="ttname"><a href="edit-form-advanced_8php.html#a46b3622ccc6d393dfd97e355b7bd0bd6">null</a></div><div class="ttdeci">if(current_theme_supports( 'post-formats')&amp;&amp;post_type_supports($post_type, 'post-formats')) add_meta_box( 'formatdiv' null</div><div class="ttdoc">When displaying the single entry we should always know to which View it belongs (the context is every...</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00244">edit-form-advanced.php:244</a></div></div>
<div class="ttc" id="select-template_8php_html_a77c8faa27a630e0cfbe0fa5507c1a538"><div class="ttname"><a href="select-template_8php.html#a77c8faa27a630e0cfbe0fa5507c1a538">$post</a></div><div class="ttdeci">global $post</div><div class="ttdef"><b>Definition:</b> <a href="select-template_8php_source.html#l00009">select-template.php:9</a></div></div>
<div class="ttc" id="class_w_p___image___editor_html"><div class="ttname"><a href="class_w_p___image___editor.html">WP_Image_Editor</a></div><div class="ttdoc">Base image editor class from which implementations extend. </div><div class="ttdef"><b>Definition:</b> <a href="class-wp-image-editor_8php_source.html#l00014">class-wp-image-editor.php:14</a></div></div>
<div class="ttc" id="image-edit_8php_html_a092f70ecf7f6a44955b2aee867851b5f"><div class="ttname"><a href="image-edit_8php.html#a092f70ecf7f6a44955b2aee867851b5f">stream_preview_image</a></div><div class="ttdeci">stream_preview_image($post_id)</div><div class="ttdoc">Streams image in post to browser, along with enqueued changes in $_REQUEST[&#39;history&#39;]. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00586">image-edit.php:586</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a716e6d165f72c602db1cd5a7b4698f4d"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a716e6d165f72c602db1cd5a7b4698f4d">wp_delete_file</a></div><div class="ttdeci">wp_delete_file($file)</div><div class="ttdoc">Delete a file. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l05132">wordpress/wp-includes/functions.php:5132</a></div></div>
<div class="ttc" id="namespacephp_html"><div class="ttname"><a href="namespacephp.html">php</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a8a71f9902193fd3868160d28e04027c8"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a8a71f9902193fd3868160d28e04027c8">path_join</a></div><div class="ttdeci">path_join($base, $path)</div><div class="ttdoc">Join two filesystem paths together. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l01678">wordpress/wp-includes/functions.php:1678</a></div></div>
<div class="ttc" id="namespacebutton_html"><div class="ttname"><a href="namespacebutton.html">button</a></div></div>
<div class="ttc" id="image-edit_8php_html_a9e79c1d4ef5a6be599f348c680e875ac"><div class="ttname"><a href="image-edit_8php.html#a9e79c1d4ef5a6be599f348c680e875ac">_flip_image_resource</a></div><div class="ttdeci">_flip_image_resource($img, $horz, $vert)</div><div class="ttdoc">Flips an image resource. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00413">image-edit.php:413</a></div></div>
<div class="ttc" id="image-edit_8php_html_ad3df2d7e23d402174d31f084f06f49f4"><div class="ttname"><a href="image-edit_8php.html#ad3df2d7e23d402174d31f084f06f49f4">_rotate_image_resource</a></div><div class="ttdeci">_rotate_image_resource($img, $angle)</div><div class="ttdoc">Returns an image resource. </div><div class="ttdef"><b>Definition:</b> <a href="image-edit_8php_source.html#l00390">image-edit.php:390</a></div></div>
<div class="ttc" id="wp-admin_2includes_2image_8php_html_af91516b2627cdd5d1f4d0a756655f09a"><div class="ttname"><a href="wp-admin_2includes_2image_8php.html#af91516b2627cdd5d1f4d0a756655f09a">_load_image_to_edit_path</a></div><div class="ttdeci">_load_image_to_edit_path($attachment_id, $size= 'full')</div><div class="ttdoc">Retrieve the path or url of an attachment&#39;s attached file. </div><div class="ttdef"><b>Definition:</b> <a href="wp-admin_2includes_2image_8php_source.html#l00537">wp-admin/includes/image.php:537</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a5fa64d49f59b259090dd3b907ef3f369"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a5fa64d49f59b259090dd3b907ef3f369">_deprecated_function</a></div><div class="ttdeci">_deprecated_function($function, $version, $replacement=null)</div><div class="ttdoc">Mark a function as deprecated and inform when it has been used. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l03573">wordpress/wp-includes/functions.php:3573</a></div></div>
<div class="ttc" id="namespacetype_html"><div class="ttname"><a href="namespacetype.html">type</a></div></div>
<div class="ttc" id="edit-form-advanced_8php_html_a866e7f0f003101850a78f372dd07bd2a"><div class="ttname"><a href="edit-form-advanced_8php.html#a866e7f0f003101850a78f372dd07bd2a">__</a></div><div class="ttdeci">if(current_theme_supports( 'post-formats')&amp;&amp;post_type_supports($post_type, 'post-formats')) add_meta_box( 'formatdiv'foreach(get_object_taxonomies($post) as $tax_name) if($thumbnail_support &amp;&amp;current_user_can( 'upload_files')) add_meta_box('postimagediv'if(post_type_supports($post_type, 'excerpt')) add_meta_box('postexcerpt' __('Excerpt')</div><div class="ttdef"><b>Definition:</b> <a href="edit-form-advanced_8php_source.html#l00269">edit-form-advanced.php:269</a></div></div>
<div class="ttc" id="wordpress_2wp-includes_2functions_8php_html_a275458f4feb9c42264630702cb4cd532"><div class="ttname"><a href="wordpress_2wp-includes_2functions_8php.html#a275458f4feb9c42264630702cb4cd532">_deprecated_argument</a></div><div class="ttdeci">_deprecated_argument($function, $version, $message=null)</div><div class="ttdoc">Mark a function argument as deprecated and inform when it has been used. </div><div class="ttdef"><b>Definition:</b> <a href="wordpress_2wp-includes_2functions_8php_source.html#l03737">wordpress/wp-includes/functions.php:3737</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/>
<script type="text/javascript">
    jQuery( document ).ready( function( $ ) {
        $( 'a.anchor[id^=_filters],a.anchor[id^=_actions]' ).each( function() {
            $( this )
                .text('#')
                .attr( 'href', function() {
                    return '#' + $( this ).attr( 'id' );
                }).prependTo( $( this ).parent('dt' ).next('dd') );
        });
    });
</script>
</body>
</html>
